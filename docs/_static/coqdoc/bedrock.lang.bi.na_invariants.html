<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
-- Copyright (c) 2020 BedRock Systems, Inc.
-- This software is distributed under the terms of the BedRock Open-Source License.
-- See the LICENSE-BedRock file in the repository root for details.
-->

<!--
-- SPDX-LIcense-Identifier:BSD-2-Clause
-->
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="../css/coqdocjs/coqdoc.css" rel="stylesheet" type="text/css" />
<link href="../css/coqdocjs/coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../js/coqdocjs/config.js"></script>
<script type="text/javascript" src="../js/coqdocjs/coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <!-- NOTE: These are displayed right to left on the page -->
    <span class="right">
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> `theories/` </a>
      <a href="../../index.html"> Toplevel </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">bedrock.lang.bi.na_invariants</h1>

<div class="code">
<span class="comment">(*<br/>
&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2021&nbsp;BedRock&nbsp;Systems,&nbsp;Inc.<br/>
&nbsp;*&nbsp;This&nbsp;software&nbsp;is&nbsp;distributed&nbsp;under&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;BedRock&nbsp;Open-Source&nbsp;License.<br/>
&nbsp;*&nbsp;See&nbsp;the&nbsp;LICENSE-BedRock&nbsp;file&nbsp;in&nbsp;the&nbsp;repository&nbsp;root&nbsp;for&nbsp;details.<br/>
&nbsp;*<br/>
&nbsp;*&nbsp;This&nbsp;file&nbsp;is&nbsp;derived&nbsp;from&nbsp;code&nbsp;original&nbsp;to&nbsp;the&nbsp;Iris&nbsp;project.&nbsp;That<br/>
&nbsp;*&nbsp;original&nbsp;code&nbsp;is<br/>
&nbsp;*<br/>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Copyright&nbsp;Iris&nbsp;developers&nbsp;and&nbsp;contributors<br/>
&nbsp;*<br/>
&nbsp;*&nbsp;and&nbsp;used&nbsp;according&nbsp;to&nbsp;the&nbsp;following&nbsp;license.<br/>
&nbsp;*<br/>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SPDX-License-Identifier:&nbsp;BSD-3-Clause<br/>
&nbsp;*<br/>
&nbsp;*&nbsp;Original&nbsp;Code:<br/>
&nbsp;*&nbsp;https://gitlab.mpi-sws.org/iris/iris/-/blob/90b6007faea2b61546aed01fe0ed9936b55468d1/iris/base_logic/lib/na_invariants.v<br/>
&nbsp;*<br/>
&nbsp;*&nbsp;Original&nbsp;Iris&nbsp;License:<br/>
&nbsp;*&nbsp;https://gitlab.mpi-sws.org/iris/iris/-/blob/90b6007faea2b61546aed01fe0ed9936b55468d1/LICENSE-CODE<br/>
&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">iris.algebra.gset</span> <span class="id" title="library">iris.algebra.coPset</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="library">iris.base_logic.lib.na_invariants</span>. <span class="comment">(*&nbsp;&lt;&lt;&nbsp;exporting&nbsp;<span class="inlinecode"><span class="id" title="var">na_inv_pool_name</span></span>,&nbsp;<span class="inlinecode"><span class="id" title="var">na_invG</span></span>&nbsp;*)</span><br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">iris.bi.bi</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">iris.proofmode.proofmode</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="bedrock.lang.bi.invariants.html#"><span class="id" title="library">bedrock.lang.bi.invariants</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="bedrock.lang.bi.own.html#"><span class="id" title="library">bedrock.lang.bi.own</span></a>.<br/>

<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Default</span> <span class="id" title="keyword">Proof</span> <span class="id" title="var">Using</span> "Type".<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Suggest</span> <span class="id" title="keyword">Proof</span> <span class="id" title="var">Using</span>.<br/>

<br/>
</div>

<div class="doc">
Extraction of non-atomic invariants that is general w.r.t HasOwn,
  and not tied to iProp.

<div class="paragraph"> </div>

  Most proofs in this file generalize those of Iris, see the link above.
  In many cases, the proofs are unchanged and are exact duplicates of those in
  Iris. But their types did change and become more general.

<div class="paragraph"> </div>

  TODO: These should be upstreamed to Iris. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Local Notation</span> <a id="na_ownR" class="idref" href="#na_ownR"><span class="id" title="abbreviation">na_ownR</span></a> :=<br/>
&nbsp;&nbsp;(<span class="id" title="definition">prodR</span> <span class="id" title="definition">coPset_disjR</span> (<span class="id" title="definition">gset_disjR</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Numbers.BinNums.html#positive"><span class="id" title="inductive">positive</span></a>)) (<span class="id" title="var">only</span> <span class="id" title="var">parsing</span>).<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="defs" class="idref" href="#defs"><span class="id" title="section">defs</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<a id="BiFUpd0:2" class="idref" href="#BiFUpd0:2"><span class="id" title="binder">!</span></a><a id="BiFUpd0:2" class="idref" href="#BiFUpd0:2"><span class="id" title="binder">BiFUpd</span></a> <a id="PROP:1" class="idref" href="#PROP:1"><span class="id" title="binder"><span id="BiFUpd0:2" class="id">PROP</span></span></a>} `{<a id="HasOwn0:3" class="idref" href="#HasOwn0:3"><span class="id" title="binder">!</span></a><a id="HasOwn0:3" class="idref" href="#HasOwn0:3"><span class="id" title="binder">HasOwn</span></a> <a id="HasOwn0:3" class="idref" href="#HasOwn0:3"><span class="id" title="binder">PROP</span></a> <a id="HasOwn0:3" class="idref" href="#HasOwn0:3"><span class="id" title="binder">na_ownR</span></a>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="na_own" class="idref" href="#na_own"><span class="id" title="definition">na_own</span></a> (<a id="p:4" class="idref" href="#p:4"><span class="id" title="binder">p</span></a> : <span class="id" title="definition">na_inv_pool_name</span>) (<a id="E:5" class="idref" href="#E:5"><span class="id" title="binder">E</span></a> : <span class="id" title="definition">coPset</span>) : <a class="idref" href="bedrock.lang.bi.na_invariants.html#defs.PROP"><span class="id" title="variable">PROP</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.own.html#own"><span class="id" title="method">own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:4"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="constructor">CoPset</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E:5"><span class="id" title="variable">E</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="constructor">GSet</span> <span class="id" title="notation">∅</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="na_inv" class="idref" href="#na_inv"><span class="id" title="definition">na_inv</span></a> (<a id="p:6" class="idref" href="#p:6"><span class="id" title="binder">p</span></a> : <span class="id" title="definition">na_inv_pool_name</span>) (<a id="N:7" class="idref" href="#N:7"><span class="id" title="binder">N</span></a> : <span class="id" title="definition">namespace</span>) (<a id="P:8" class="idref" href="#P:8"><span class="id" title="binder">P</span></a> : <a class="idref" href="bedrock.lang.bi.na_invariants.html#defs.PROP"><span class="id" title="variable">PROP</span></a>) : <a class="idref" href="bedrock.lang.bi.na_invariants.html#defs.PROP"><span class="id" title="variable">PROP</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Note:&nbsp;Building&nbsp;on&nbsp;atomic&nbsp;invariants&nbsp;in&nbsp;this&nbsp;way&nbsp;leads&nbsp;to,&nbsp;under<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">PROP</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">monPredI</span></span>,&nbsp;a&nbsp;side-condition&nbsp;something&nbsp;like&nbsp;<span class="inlinecode"><span class="id" title="var">Objective</span></span> <span class="inlinecode"><span class="id" title="var">P</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="notation">∃</span> <a id="i:9" class="idref" href="#i:9"><span class="id" title="binder">i</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">⌜</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#i:9"><span class="id" title="variable">i</span></a> <span class="id" title="notation">∈</span> <span class="id" title="notation">(</span><span class="id" title="notation">↑</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#N:7"><span class="id" title="variable">N</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::core_scope:x_':'_x"><span class="id" title="notation">:</span></a><span class="id" title="definition">coPset</span><span class="id" title="notation">)</span><span class="id" title="notation">⌝</span> <span class="id" title="notation">∧</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.invariants.html#inv"><span class="id" title="definition">inv</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#N:7"><span class="id" title="variable">N</span></a> (<a class="idref" href="bedrock.lang.bi.na_invariants.html#P:8"><span class="id" title="variable">P</span></a> <span class="id" title="notation">∗</span> <a class="idref" href="bedrock.lang.bi.own.html#own"><span class="id" title="method">own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:6"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="constructor">CoPset</span> <span class="id" title="notation">∅</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="constructor">GSet</span> <span class="id" title="notation">{[</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#i:9"><span class="id" title="variable">i</span></a><span class="id" title="notation">]}</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <span class="id" title="notation">∨</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:6"><span class="id" title="variable">p</span></a> <span class="id" title="notation">{[</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#i:9"><span class="id" title="variable">i</span></a><span class="id" title="notation">]}</span>))%<span class="id" title="var">I</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#defs"><span class="id" title="section">defs</span></a>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span>: <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Classes.Morphisms.html#Params"><span class="id" title="class">Params</span></a> (@<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv"><span class="id" title="definition">na_inv</span></a>) 5 := {}.<br/>
#[<span class="id" title="var">global</span>] <span class="id" title="keyword">Typeclasses</span> <span class="id" title="keyword">Opaque</span> <span class="id" title="var">na_own</span> <span class="id" title="var">na_inv</span>.<br/>

<br/>
<span class="comment">(*&nbsp;TODO:&nbsp;allocation&nbsp;rules&nbsp;are&nbsp;missing.&nbsp;These&nbsp;rely&nbsp;on&nbsp;the&nbsp;specific&nbsp;model&nbsp;of&nbsp;PROP,<br/>
&nbsp;&nbsp;so&nbsp;the&nbsp;client&nbsp;of&nbsp;this&nbsp;library&nbsp;needs&nbsp;the&nbsp;provide&nbsp;the&nbsp;corresponding&nbsp;model&nbsp;of<br/>
&nbsp;&nbsp;invariants&nbsp;for&nbsp;their&nbsp;PROP,&nbsp;and&nbsp;then&nbsp;prove&nbsp;the&nbsp;allocation&nbsp;rules.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Such&nbsp;a&nbsp;model&nbsp;exists&nbsp;for&nbsp;iProp,&nbsp;see<br/>
&nbsp;&nbsp;https://gitlab.mpi-sws.org/iris/iris/-/blob/90b6007faea2b61546aed01fe0ed9936b55468d1/iris/base_logic/lib/invariants.vL27 *)</span><br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="proofs" class="idref" href="#proofs"><span class="id" title="section">proofs</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<a id="BiEmbed0:11" class="idref" href="#BiEmbed0:11"><span class="id" title="binder">!</span></a><a id="BiEmbed0:11" class="idref" href="#BiEmbed0:11"><span class="id" title="binder">BiEmbed</span></a> <a id="BiEmbed0:11" class="idref" href="#BiEmbed0:11"><span class="id" title="binder">siPropI</span></a> <a id="PROP:10" class="idref" href="#PROP:10"><span class="id" title="binder"><span id="BiEmbed0:11" class="id">PROP</span></span></a>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<a id="BiBUpd0:12" class="idref" href="#BiBUpd0:12"><span class="id" title="binder">!</span></a><a id="BiBUpd0:12" class="idref" href="#BiBUpd0:12"><span class="id" title="binder">BiBUpd</span></a> <a id="BiBUpd0:12" class="idref" href="#BiBUpd0:12"><span class="id" title="binder">PROP</span></a>, <a id="BiFUpd0:13" class="idref" href="#BiFUpd0:13"><span class="id" title="binder">!</span></a><a id="BiFUpd0:13" class="idref" href="#BiFUpd0:13"><span class="id" title="binder">BiFUpd</span></a> <a id="BiFUpd0:13" class="idref" href="#BiFUpd0:13"><span class="id" title="binder">PROP</span></a>, <a id="BiBUpdFUpd0:14" class="idref" href="#BiBUpdFUpd0:14"><span class="id" title="binder">!</span></a><a id="BiBUpdFUpd0:14" class="idref" href="#BiBUpdFUpd0:14"><span class="id" title="binder">BiBUpdFUpd</span></a> <a id="BiBUpdFUpd0:14" class="idref" href="#BiBUpdFUpd0:14"><span class="id" title="binder">PROP</span></a>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<a id="BiLaterContractive0:15" class="idref" href="#BiLaterContractive0:15"><span class="id" title="binder">!</span></a><a id="BiLaterContractive0:15" class="idref" href="#BiLaterContractive0:15"><span class="id" title="binder">BiLaterContractive</span></a> <a id="BiLaterContractive0:15" class="idref" href="#BiLaterContractive0:15"><span class="id" title="binder">PROP</span></a>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<a id="HasOwn0:16" class="idref" href="#HasOwn0:16"><span class="id" title="binder">!</span></a><a id="HasOwn0:16" class="idref" href="#HasOwn0:16"><span class="id" title="binder">HasOwn</span></a> <a id="HasOwn0:16" class="idref" href="#HasOwn0:16"><span class="id" title="binder">PROP</span></a> <a id="HasOwn0:16" class="idref" href="#HasOwn0:16"><span class="id" title="binder">na_ownR</span></a>, <a id="HasOwnValid0:17" class="idref" href="#HasOwnValid0:17"><span class="id" title="binder">!</span></a><a id="HasOwnValid0:17" class="idref" href="#HasOwnValid0:17"><span class="id" title="binder">HasOwnValid</span></a> <a id="HasOwnValid0:17" class="idref" href="#HasOwnValid0:17"><span class="id" title="binder">PROP</span></a> <a id="HasOwnValid0:17" class="idref" href="#HasOwnValid0:17"><span class="id" title="binder">na_ownR</span></a>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<a id="HasOwnUpd0:18" class="idref" href="#HasOwnUpd0:18"><span class="id" title="binder">!</span></a><a id="HasOwnUpd0:18" class="idref" href="#HasOwnUpd0:18"><span class="id" title="binder">HasOwnUpd</span></a> <a id="HasOwnUpd0:18" class="idref" href="#HasOwnUpd0:18"><span class="id" title="binder">PROP</span></a> <a id="HasOwnUpd0:18" class="idref" href="#HasOwnUpd0:18"><span class="id" title="binder">na_ownR</span></a>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="module">bi</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local</span> <span class="id" title="keyword">Set</span> <span class="id" title="var">Default</span> <span class="id" title="keyword">Proof</span> <span class="id" title="var">Using</span> "Type*".<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Duplicates&nbsp;from&nbsp;Iris,&nbsp;but&nbsp;do&nbsp;not&nbsp;tie&nbsp;to&nbsp;iProp&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;These&nbsp;statements&nbsp;and&nbsp;proofs&nbsp;are&nbsp;the&nbsp;same,&nbsp;except&nbsp;where&nbsp;required<br/>
&nbsp;&nbsp;for&nbsp;non-affine&nbsp;BIs.&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a id="na_own_timeless" class="idref" href="#na_own_timeless"><span class="id" title="instance">na_own_timeless</span></a> <a id="p:19" class="idref" href="#p:19"><span class="id" title="binder">p</span></a> <a id="E:20" class="idref" href="#E:20"><span class="id" title="binder">E</span></a> : <span class="id" title="class">Timeless</span> (<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:19"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E:20"><span class="id" title="variable">E</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> /<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a>; <span class="id" title="tactic">apply</span> <span class="id" title="var">_</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a id="na_inv_contractive" class="idref" href="#na_inv_contractive"><span class="id" title="instance">na_inv_contractive</span></a> <a id="p:21" class="idref" href="#p:21"><span class="id" title="binder">p</span></a> <a id="N:22" class="idref" href="#N:22"><span class="id" title="binder">N</span></a> : <span class="id" title="abbreviation">Contractive</span> (<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv"><span class="id" title="definition">na_inv</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:21"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#N:22"><span class="id" title="variable">N</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> /<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv"><span class="id" title="definition">na_inv</span></a>. <span class="id" title="var">solve_contractive</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a id="na_inv_ne" class="idref" href="#na_inv_ne"><span class="id" title="instance">na_inv_ne</span></a> <a id="p:23" class="idref" href="#p:23"><span class="id" title="binder">p</span></a> <a id="N:24" class="idref" href="#N:24"><span class="id" title="binder">N</span></a> : <span class="id" title="abbreviation">NonExpansive</span> (<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv"><span class="id" title="definition">na_inv</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:23"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#N:24"><span class="id" title="variable">N</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="instance">contractive_ne</span> <span class="id" title="var">_</span>). <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a id="na_inv_proper" class="idref" href="#na_inv_proper"><span class="id" title="instance">na_inv_proper</span></a> <a id="p:25" class="idref" href="#p:25"><span class="id" title="binder">p</span></a> <a id="N:26" class="idref" href="#N:26"><span class="id" title="binder">N</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Classes.Morphisms.html#Proper"><span class="id" title="class">Proper</span></a> (<span class="id" title="notation">(≡)</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Classes.Morphisms.html#8dc5652698a6e16f72dd37bd17d3b973"><span class="id" title="notation">==&gt;</span></a> <span class="id" title="notation">(≡)</span>) (<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv"><span class="id" title="definition">na_inv</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:25"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#N:26"><span class="id" title="variable">N</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="lemma">ne_proper</span> <span class="id" title="var">_</span>). <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a id="na_inv_persistent" class="idref" href="#na_inv_persistent"><span class="id" title="instance">na_inv_persistent</span></a> <a id="p:27" class="idref" href="#p:27"><span class="id" title="binder">p</span></a> <a id="N:28" class="idref" href="#N:28"><span class="id" title="binder">N</span></a> <a id="P:29" class="idref" href="#P:29"><span class="id" title="binder">P</span></a> : <span class="id" title="class">Persistent</span> (<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv"><span class="id" title="definition">na_inv</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:27"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#N:28"><span class="id" title="variable">N</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#P:29"><span class="id" title="variable">P</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> /<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv"><span class="id" title="definition">na_inv</span></a>; <span class="id" title="tactic">apply</span> <span class="id" title="var">_</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a id="na_inv_affine" class="idref" href="#na_inv_affine"><span class="id" title="instance">na_inv_affine</span></a> <a id="p:30" class="idref" href="#p:30"><span class="id" title="binder">p</span></a> <a id="N:31" class="idref" href="#N:31"><span class="id" title="binder">N</span></a> <a id="P:32" class="idref" href="#P:32"><span class="id" title="binder">P</span></a> : <span class="id" title="class">Affine</span> (<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv"><span class="id" title="definition">na_inv</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:30"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#N:31"><span class="id" title="variable">N</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#P:32"><span class="id" title="variable">P</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> /<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv"><span class="id" title="definition">na_inv</span></a>; <span class="id" title="tactic">apply</span> <span class="id" title="var">_</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="na_inv_iff" class="idref" href="#na_inv_iff"><span class="id" title="lemma">na_inv_iff</span></a> <a id="p:33" class="idref" href="#p:33"><span class="id" title="binder">p</span></a> <a id="N:34" class="idref" href="#N:34"><span class="id" title="binder">N</span></a> <a id="P:35" class="idref" href="#P:35"><span class="id" title="binder">P</span></a> <a id="Q:36" class="idref" href="#Q:36"><span class="id" title="binder">Q</span></a> : <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv"><span class="id" title="definition">na_inv</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:33"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#N:34"><span class="id" title="variable">N</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#P:35"><span class="id" title="variable">P</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">□</span> <span class="id" title="notation">▷</span> <span class="id" title="notation">(</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#P:35"><span class="id" title="variable">P</span></a> <span class="id" title="notation">∗-∗</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#Q:36"><span class="id" title="variable">Q</span></a><span class="id" title="notation">)</span> <span class="id" title="notation">-∗</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv"><span class="id" title="definition">na_inv</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:33"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#N:34"><span class="id" title="variable">N</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#Q:36"><span class="id" title="variable">Q</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "HI #HPQ". <span class="id" title="tactic">rewrite</span> /<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv"><span class="id" title="definition">na_inv</span></a>. <span class="id" title="var">iDestruct</span> "HI" <span class="id" title="keyword">as</span> (<span class="id" title="var">i</span> ?) "HI".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iExists</span> <span class="id" title="var">i</span>. <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>. <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="bedrock.lang.bi.invariants.html#inv_iff"><span class="id" title="lemma">inv_iff</span></a> <span class="id" title="notation">with</span> "HI"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!&gt; !&gt;".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iSplit</span>; <span class="id" title="tactic">by</span> <span class="id" title="var">iIntros</span> "[[? Ho]|?]"; [| <span class="id" title="tactic">by</span> <span class="id" title="var">iRight</span>]; <span class="id" title="var">iLeft</span>; <span class="id" title="var">iFrame</span> "Ho"; <span class="id" title="var">iApply</span> "HPQ".<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="na_alloc_strong" class="idref" href="#na_alloc_strong"><span class="id" title="lemma">na_alloc_strong</span></a> (<a id="P:37" class="idref" href="#P:37"><span class="id" title="binder">P</span></a> : <span class="id" title="definition">na_inv_pool_name</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">pred_infinite</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#P:37"><span class="id" title="variable">P</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="notation">⊢</span> <span class="id" title="notation">|==&gt;</span> <span class="id" title="notation">∃</span> <a id="p:38" class="idref" href="#p:38"><span class="id" title="binder">p</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">⌜</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#P:37"><span class="id" title="variable">P</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:38"><span class="id" title="variable">p</span></a><span class="id" title="notation">⌝</span> <span class="id" title="notation">∗</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:38"><span class="id" title="variable">p</span></a> <span class="id" title="notation">⊤</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">by</span> <span class="id" title="var">iMod</span> (<a class="idref" href="bedrock.lang.bi.own.html#own_alloc_strong"><span class="id" title="lemma">own_alloc_strong</span></a> <span class="id" title="var">_</span> <span class="id" title="var">P</span>) <span class="id" title="keyword">as</span> (<span class="id" title="var">p</span> ?) "?"; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="na_alloc" class="idref" href="#na_alloc"><span class="id" title="lemma">na_alloc</span></a> : <span class="id" title="notation">⊢</span> <span class="id" title="notation">|==&gt;</span> <span class="id" title="notation">∃</span> <a id="p:39" class="idref" href="#p:39"><span class="id" title="binder">p</span></a><span class="id" title="notation">,</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:39"><span class="id" title="variable">p</span></a> <span class="id" title="notation">⊤</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <a class="idref" href="bedrock.lang.bi.own.html#own_alloc"><span class="id" title="lemma">own_alloc</span></a>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="na_own_disjoint" class="idref" href="#na_own_disjoint"><span class="id" title="lemma">na_own_disjoint</span></a> <a id="p:40" class="idref" href="#p:40"><span class="id" title="binder">p</span></a> <a id="E1:41" class="idref" href="#E1:41"><span class="id" title="binder">E1</span></a> <a id="E2:42" class="idref" href="#E2:42"><span class="id" title="binder">E2</span></a> : <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:40"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E1:41"><span class="id" title="variable">E1</span></a> <span class="id" title="notation">⊢</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:40"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E2:42"><span class="id" title="variable">E2</span></a> <span class="id" title="notation">-∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#E1:41"><span class="id" title="variable">E1</span></a> <span class="id" title="notation">##</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E2:42"><span class="id" title="variable">E2</span></a><span class="id" title="notation">⌝</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">wand_intro_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> -<a class="idref" href="bedrock.lang.bi.own.html#own_op"><span class="id" title="method">own_op</span></a> <a class="idref" href="bedrock.lang.bi.own.html#own_valid"><span class="id" title="method">own_valid</span></a> -<span class="id" title="lemma">coPset_disj_valid_op</span>. <span class="id" title="tactic">by</span> <span class="id" title="var">iIntros</span> ([? <span class="id" title="var">_</span>]).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="na_own_union" class="idref" href="#na_own_union"><span class="id" title="lemma">na_own_union</span></a> <a id="p:43" class="idref" href="#p:43"><span class="id" title="binder">p</span></a> <a id="E1:44" class="idref" href="#E1:44"><span class="id" title="binder">E1</span></a> <a id="E2:45" class="idref" href="#E2:45"><span class="id" title="binder">E2</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.na_invariants.html#E1:44"><span class="id" title="variable">E1</span></a> <span class="id" title="notation">##</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E2:45"><span class="id" title="variable">E2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:43"><span class="id" title="variable">p</span></a> (<a class="idref" href="bedrock.lang.bi.na_invariants.html#E1:44"><span class="id" title="variable">E1</span></a> <span class="id" title="notation">∪</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E2:45"><span class="id" title="variable">E2</span></a>) <span class="id" title="notation">⊣⊢</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:43"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E1:44"><span class="id" title="variable">E1</span></a> <span class="id" title="notation">∗</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:43"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E2:45"><span class="id" title="variable">E2</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ?. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> /<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> -<a class="idref" href="bedrock.lang.bi.own.html#own_op"><span class="id" title="method">own_op</span></a> -<span class="id" title="lemma">pair_op</span> <span class="id" title="definition">left_id</span> <span class="id" title="lemma">coPset_disj_union</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="na_own_acc" class="idref" href="#na_own_acc"><span class="id" title="lemma">na_own_acc</span></a> <a id="E2:46" class="idref" href="#E2:46"><span class="id" title="binder">E2</span></a> <a id="E1:47" class="idref" href="#E1:47"><span class="id" title="binder">E1</span></a> <a id="tid:48" class="idref" href="#tid:48"><span class="id" title="binder">tid</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.na_invariants.html#E2:46"><span class="id" title="variable">E2</span></a> <span class="id" title="notation">⊆</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E1:47"><span class="id" title="variable">E1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#tid:48"><span class="id" title="variable">tid</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E1:47"><span class="id" title="variable">E1</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#tid:48"><span class="id" title="variable">tid</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E2:46"><span class="id" title="variable">E2</span></a> <span class="id" title="notation">∗</span> <span class="id" title="notation">(</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#tid:48"><span class="id" title="variable">tid</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E2:46"><span class="id" title="variable">E2</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#tid:48"><span class="id" title="variable">tid</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E1:47"><span class="id" title="variable">E1</span></a><span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">HF</span>. <span class="id" title="tactic">assert</span> (<span class="id" title="var">E1</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">E2</span> <span class="id" title="notation">∪</span> <span class="id" title="notation">(</span><span class="id" title="var">E1</span> <span class="id" title="notation">∖</span> <span class="id" title="var">E2</span><span class="id" title="notation">)</span>) <span class="id" title="keyword">as</span> -&gt; <span class="id" title="tactic">by</span> <span class="id" title="tactic">exact</span>: <span class="id" title="lemma">union_difference_L</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own_union"><span class="id" title="lemma">na_own_union</span></a>; <span class="id" title="var">last</span> <span class="id" title="tactic">by</span> <span class="id" title="var">set_solver</span>+. <span class="id" title="var">iIntros</span> "[$ $]". <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="na_inv_acc" class="idref" href="#na_inv_acc"><span class="id" title="lemma">na_inv_acc</span></a> <a id="p:49" class="idref" href="#p:49"><span class="id" title="binder">p</span></a> <a id="E:50" class="idref" href="#E:50"><span class="id" title="binder">E</span></a> <a id="F:51" class="idref" href="#F:51"><span class="id" title="binder">F</span></a> <a id="N:52" class="idref" href="#N:52"><span class="id" title="binder">N</span></a> <a id="P:53" class="idref" href="#P:53"><span class="id" title="binder">P</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">↑</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#N:52"><span class="id" title="variable">N</span></a> <span class="id" title="notation">⊆</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E:50"><span class="id" title="variable">E</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="notation">↑</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#N:52"><span class="id" title="variable">N</span></a> <span class="id" title="notation">⊆</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#F:51"><span class="id" title="variable">F</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv"><span class="id" title="definition">na_inv</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:49"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#N:52"><span class="id" title="variable">N</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#P:53"><span class="id" title="variable">P</span></a> <span class="id" title="notation">-∗</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:49"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#F:51"><span class="id" title="variable">F</span></a> <span class="id" title="notation">={</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#E:50"><span class="id" title="variable">E</span></a><span class="id" title="notation">}=∗</span> <span class="id" title="notation">▷</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#P:53"><span class="id" title="variable">P</span></a> <span class="id" title="notation">∗</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:49"><span class="id" title="variable">p</span></a> (<a class="idref" href="bedrock.lang.bi.na_invariants.html#F:51"><span class="id" title="variable">F</span></a><span class="id" title="notation">∖</span><span class="id" title="notation">↑</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#N:52"><span class="id" title="variable">N</span></a>) <span class="id" title="notation">∗</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="notation">▷</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#P:53"><span class="id" title="variable">P</span></a> <span class="id" title="notation">∗</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:49"><span class="id" title="variable">p</span></a> (<a class="idref" href="bedrock.lang.bi.na_invariants.html#F:51"><span class="id" title="variable">F</span></a><span class="id" title="notation">∖</span><span class="id" title="notation">↑</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#N:52"><span class="id" title="variable">N</span></a>) <span class="id" title="notation">={</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#E:50"><span class="id" title="variable">E</span></a><span class="id" title="notation">}=∗</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:49"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#F:51"><span class="id" title="variable">F</span></a><span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv"><span class="id" title="definition">na_inv</span></a>. <span class="id" title="var">iIntros</span> (??) "#Hnainv Htoks".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "Hnainv" <span class="id" title="keyword">as</span> (<span class="id" title="var">i</span>) "[% Hinv]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> [<span class="id" title="var">F</span> <span class="id" title="keyword">as</span> <span class="id" title="var">X</span> <span class="id" title="tactic">in</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <span class="id" title="var">p</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#X:54"><span class="id" title="variable">X</span></a>](<span class="id" title="lemma">union_difference_L</span> (<span class="id" title="notation">↑</span><span class="id" title="var">N</span>) <span class="id" title="var">F</span>) //.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> [<span class="id" title="var">X</span> <span class="id" title="tactic">in</span> (<a class="idref" href="bedrock.lang.bi.na_invariants.html#X:55"><span class="id" title="variable">X</span></a> <span class="id" title="notation">∪</span> <span class="id" title="var">_</span>)](<span class="id" title="lemma">union_difference_L</span> <span class="id" title="notation">{[</span><span class="id" title="var">i</span><span class="id" title="notation">]}</span> (<span class="id" title="notation">↑</span><span class="id" title="var">N</span>)) ?<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own_union"><span class="id" title="lemma">na_own_union</span></a>; [|<span class="id" title="var">set_solver</span>..].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "Htoks" <span class="id" title="keyword">as</span> "[[Htoki $] $]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iInv</span> "Hinv" <span class="id" title="keyword">as</span> "[[$ &gt;Hdis]|&gt;Htoki2]" "Hclose".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iMod</span> <span class="id" title="notation">(</span>"Hclose" <span class="id" title="notation">with</span> "[Htoki]"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "_"; <span class="id" title="tactic">first</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!&gt; [HP $]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iInv</span> <span class="id" title="var">N</span> <span class="id" title="keyword">as</span> "[[? &gt;Hdis2]|&gt;Hitok]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="bedrock.lang.bi.own.html#own_valid_2"><span class="id" title="lemma">own_valid_2</span></a> <span class="id" title="notation">with</span> "Hdis Hdis2"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %[<span class="id" title="var">_</span> <span class="id" title="var">Hval</span>%<span class="id" title="lemma">gset_disj_valid_op</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">set_solver</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">iSplitR</span> "Hitok"; <span class="id" title="var">last</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>. <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own_disjoint"><span class="id" title="lemma">na_own_disjoint</span></a> <span class="id" title="notation">with</span> "Htoki Htoki2"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> %?. <span class="id" title="var">set_solver</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a id="into_inv_na" class="idref" href="#into_inv_na"><span class="id" title="instance">into_inv_na</span></a> <a id="p:56" class="idref" href="#p:56"><span class="id" title="binder">p</span></a> <a id="N:57" class="idref" href="#N:57"><span class="id" title="binder">N</span></a> <a id="P:58" class="idref" href="#P:58"><span class="id" title="binder">P</span></a> : <span class="id" title="class">IntoInv</span> (<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv"><span class="id" title="definition">na_inv</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:56"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#N:57"><span class="id" title="variable">N</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#P:58"><span class="id" title="variable">P</span></a>) <a class="idref" href="bedrock.lang.bi.na_invariants.html#N:57"><span class="id" title="variable">N</span></a> := {}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a id="into_acc_na" class="idref" href="#into_acc_na"><span class="id" title="instance">into_acc_na</span></a> <a id="p:59" class="idref" href="#p:59"><span class="id" title="binder">p</span></a> <a id="F:60" class="idref" href="#F:60"><span class="id" title="binder">F</span></a> <a id="E:61" class="idref" href="#E:61"><span class="id" title="binder">E</span></a> <a id="N:62" class="idref" href="#N:62"><span class="id" title="binder">N</span></a> <a id="P:63" class="idref" href="#P:63"><span class="id" title="binder">P</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="class">IntoAcc</span> (<span class="id" title="var">X</span>:=<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#unit"><span class="id" title="inductive">unit</span></a>) (<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv"><span class="id" title="definition">na_inv</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:59"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#N:62"><span class="id" title="variable">N</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#P:63"><span class="id" title="variable">P</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="notation">↑</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#N:62"><span class="id" title="variable">N</span></a> <span class="id" title="notation">⊆</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E:61"><span class="id" title="variable">E</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#3668992ecc3e95973d304a75a28051a2"><span class="id" title="notation">∧</span></a> <span class="id" title="notation">↑</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#N:62"><span class="id" title="variable">N</span></a> <span class="id" title="notation">⊆</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#F:60"><span class="id" title="variable">F</span></a>) (<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:59"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#F:60"><span class="id" title="variable">F</span></a>) (<span class="id" title="definition">fupd</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E:61"><span class="id" title="variable">E</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E:61"><span class="id" title="variable">E</span></a>) (<span class="id" title="definition">fupd</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E:61"><span class="id" title="variable">E</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#E:61"><span class="id" title="variable">E</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <span class="id" title="notation">▷</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#P:63"><span class="id" title="variable">P</span></a> <span class="id" title="notation">∗</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:59"><span class="id" title="variable">p</span></a> (<a class="idref" href="bedrock.lang.bi.na_invariants.html#F:60"><span class="id" title="variable">F</span></a><span class="id" title="notation">∖</span><span class="id" title="notation">↑</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#N:62"><span class="id" title="variable">N</span></a>))%<span class="id" title="var">I</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <span class="id" title="notation">▷</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#P:63"><span class="id" title="variable">P</span></a> <span class="id" title="notation">∗</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:59"><span class="id" title="variable">p</span></a> (<a class="idref" href="bedrock.lang.bi.na_invariants.html#F:60"><span class="id" title="variable">F</span></a><span class="id" title="notation">∖</span><span class="id" title="notation">↑</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#N:62"><span class="id" title="variable">N</span></a>))%<span class="id" title="var">I</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="bedrock.lang.bi.na_invariants.html#na_own"><span class="id" title="definition">na_own</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#p:59"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.bi.na_invariants.html#F:60"><span class="id" title="variable">F</span></a>))%<span class="id" title="var">I</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<span class="id" title="class">IntoAcc</span> /<span class="id" title="definition">accessor</span>. <span class="id" title="var">iIntros</span> ((?&amp;?)) "#Hinv Hown".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">exist_unit</span> -<span class="id" title="definition">assoc</span> /=.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="bedrock.lang.bi.na_invariants.html#na_inv_acc"><span class="id" title="lemma">na_inv_acc</span></a> <span class="id" title="notation">with</span> "Hinv"<span class="id" title="notation">)</span>; <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="bedrock.lang.bi.na_invariants.html#proofs"><span class="id" title="section">proofs</span></a>.<br/>
</div>
<!--
-- Copyright (c) 2020 BedRock Systems, Inc.
-- This software is distributed under the terms of the BedRock Open-Source License.
-- See the LICENSE-BedRock file in the repository root for details.
-->

<!--
-- SPDX-LIcense-Identifier:BSD-2-Clause
-->
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
