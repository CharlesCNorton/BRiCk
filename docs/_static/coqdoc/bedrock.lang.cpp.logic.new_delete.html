<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
-- Copyright (c) 2020 BedRock Systems, Inc.
-- This software is distributed under the terms of the BedRock Open-Source License.
-- See the LICENSE-BedRock file in the repository root for details.
-->

<!--
-- SPDX-LIcense-Identifier:BSD-2-Clause
-->
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="../css/coqdocjs/coqdoc.css" rel="stylesheet" type="text/css" />
<link href="../css/coqdocjs/coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../js/coqdocjs/config.js"></script>
<script type="text/javascript" src="../js/coqdocjs/coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <!-- NOTE: These are displayed right to left on the page -->
    <span class="right">
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> `theories/` </a>
      <a href="../../index.html"> Toplevel </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">bedrock.lang.cpp.logic.new_delete</h1>

<div class="code">
<span class="comment">(*<br/>
&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2021-2023&nbsp;BedRock&nbsp;Systems,&nbsp;Inc.<br/>
&nbsp;*&nbsp;This&nbsp;software&nbsp;is&nbsp;distributed&nbsp;under&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;BedRock&nbsp;Open-Source&nbsp;License.<br/>
&nbsp;*&nbsp;See&nbsp;the&nbsp;LICENSE-BedRock&nbsp;file&nbsp;in&nbsp;the&nbsp;repository&nbsp;root&nbsp;for&nbsp;details.<br/>
&nbsp;*)</span><br/>
</div>

<div class="doc">
<a id="lab225"></a><h1 class="section">Semantics of <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.new"><span class="id" title="section">new</span></a></span> and <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.delete"><span class="id" title="section">delete</span></a></span> expressions</h1>

<a id="lab226"></a><h1 class="section">(expressed in weakest pre-condition style)</h1>

 
</div>
<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">iris.bi.lib.fractional</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">iris.proofmode.proofmode</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">bedrock.lang.cpp</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="bedrock.lang.cpp.ast.html#"><span class="id" title="library">ast</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.html#"><span class="id" title="library">semantics</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">bedrock.lang.cpp.logic</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.pred.html#"><span class="id" title="library">pred</span></a> <a class="idref" href="bedrock.lang.cpp.logic.path_pred.html#"><span class="id" title="library">path_pred</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#"><span class="id" title="library">heap_pred</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.destroy.html#"><span class="id" title="library">destroy</span></a> <a class="idref" href="bedrock.lang.cpp.logic.initializers.html#"><span class="id" title="library">initializers</span></a> <a class="idref" href="bedrock.lang.cpp.logic.dispatch.html#"><span class="id" title="library">dispatch</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.wp.html#"><span class="id" title="library">wp</span></a> <a class="idref" href="bedrock.lang.cpp.logic.call.html#"><span class="id" title="library">call</span></a> <a class="idref" href="bedrock.lang.cpp.logic.translation_unit.html#"><span class="id" title="library">translation_unit</span></a>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="keyword">Type</span> <a id="Expr__newdelete" class="idref" href="#Expr__newdelete"><span class="id" title="module">Expr__newdelete</span></a>.<br/>

<br/>
&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">free_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab227"></a><h1 class="section">Weakest pre-condition for <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.new"><span class="id" title="section">new</span></a></span> and <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.delete"><span class="id" title="section">delete</span></a></span> expressions</h1>

   *
<a id="lab228"></a><h1 class="section">NOTE It is important that these rules are sound, but less important that</h1>

<a id="lab229"></a><h1 class="section">they are complete. When in doubt, we err on the side of caution and under-specify</h1>

<a id="lab230"></a><h1 class="section">the behavior of various constructs.</h1>

   *
<a id="lab231"></a><h1 class="section">If you run into code that requires addditional semantic specification, please file</h1>

<a id="lab232"></a><h1 class="section">an issue.</h1>

   
<div class="paragraph"> </div>

 Dynamic Typing at <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.delete"><span class="id" title="section">delete</span></a></span>-Time

<div class="paragraph"> </div>

      The C++ Standard ascribes undefined behavior to any <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.delete"><span class="id" title="section">delete</span></a></span>-calls which
      have a Static Type which differs from the Dynamic Type that was associated
      with the pointer when it was initially created via <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.new"><span class="id" title="section">new</span></a></span>
      &lt;https://eel.is/c++draft/expr.delete3>:
      | (3) In a single-object delete expression, if the static type of the object to be
      |     deleted is not similar ([conv.qual]) to its dynamic type and the selected
      |     deallocation function (see below) is not a destroying operator delete, the
      |     static type shall be a base class of the dynamic type of the object to be
      |     deleted and the static type shall have a virtual destructor or the behavior is
      |     undefined. In an array delete expression, if the dynamic type of the object to
      |     be deleted is not similar to its static type, the behavior is undefined.
      [new_tokenR q allocation_type] tracks this Dynamic Type information.
   
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <a id="Expr__newdelete.new_tokenR" class="idref" href="#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> : <span class="id" title="notation">forall</span> <span class="id" title="notation">`{</span><a id="eb9571817dd417966f307c3a9de8fe7f" class="idref" href="#eb9571817dd417966f307c3a9de8fe7f"><span class="id" title="binder">Σ</span></a> : <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.cpp_logic"><span class="id" title="class">cpp_logic</span></a>} (<a id="q:4" class="idref" href="#q:4"><span class="id" title="binder">q</span></a> : <span class="id" title="record">Qp</span>) (<a id="ty:5" class="idref" href="#ty:5"><span class="id" title="binder">ty</span></a> : <a class="idref" href="bedrock.lang.cpp.syntax.types.html#type"><span class="id" title="inductive">type</span></a><span class="id" title="notation">),</span> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#Rep"><span class="id" title="definition">Rep</span></a>.<br/>
&nbsp;&nbsp;#[<span class="id" title="var">global</span>] <span class="id" title="var">Declare</span> <span class="id" title="keyword">Instance</span> <a id="Expr__newdelete.new_tokenR_timeless" class="idref" href="#Expr__newdelete.new_tokenR_timeless"><span class="id" title="instance">new_tokenR_timeless</span></a> `{<a id="2ff76d4cddec082cd899c55bae9fabf3" class="idref" href="#2ff76d4cddec082cd899c55bae9fabf3"><span class="id" title="binder">Σ</span></a> : <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.cpp_logic"><span class="id" title="class">cpp_logic</span></a>} <a id="q:10" class="idref" href="#q:10"><span class="id" title="binder">q</span></a> <a id="ty:11" class="idref" href="#ty:11"><span class="id" title="binder">ty</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="class">Timeless</span> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#q:10"><span class="id" title="variable">q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:11"><span class="id" title="variable">ty</span></a>).<br/>
&nbsp;&nbsp;#[<span class="id" title="var">global</span>] <span class="id" title="var">Declare</span> <span class="id" title="keyword">Instance</span> <a id="Expr__newdelete.new_tokenR_fractional" class="idref" href="#Expr__newdelete.new_tokenR_fractional"><span class="id" title="instance">new_tokenR_fractional</span></a> `{<a id="08441172cd4c14450ee9e66c55932a87" class="idref" href="#08441172cd4c14450ee9e66c55932a87"><span class="id" title="binder">Σ</span></a> : <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.cpp_logic"><span class="id" title="class">cpp_logic</span></a>} <a id="ty:15" class="idref" href="#ty:15"><span class="id" title="binder">ty</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="class">Fractional</span> (<span class="id" title="keyword">fun</span> <a id="q:16" class="idref" href="#q:16"><span class="id" title="binder">q</span></a> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#q:16"><span class="id" title="variable">q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:15"><span class="id" title="variable">ty</span></a>).<br/>
&nbsp;&nbsp;#[<span class="id" title="var">global</span>] <span class="id" title="var">Declare</span> <span class="id" title="keyword">Instance</span> <a id="Expr__newdelete.new_tokenR_agree" class="idref" href="#Expr__newdelete.new_tokenR_agree"><span class="id" title="instance">new_tokenR_agree</span></a> `{<a id="957e39afe9f7f3b3133a35f49f47db88" class="idref" href="#957e39afe9f7f3b3133a35f49f47db88"><span class="id" title="binder">Σ</span></a> : <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.cpp_logic"><span class="id" title="class">cpp_logic</span></a>} <a id="q:20" class="idref" href="#q:20"><span class="id" title="binder">q</span></a> <a id="ty1:21" class="idref" href="#ty1:21"><span class="id" title="binder">ty1</span></a> <a id="ty2:22" class="idref" href="#ty2:22"><span class="id" title="binder">ty2</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.observe.html#Observe2"><span class="id" title="class">Observe2</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty1:21"><span class="id" title="variable">ty1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty2:22"><span class="id" title="variable">ty2</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#q:20"><span class="id" title="variable">q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty1:21"><span class="id" title="variable">ty1</span></a>) (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#q:20"><span class="id" title="variable">q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty2:22"><span class="id" title="variable">ty2</span></a>).<br/>
&nbsp;&nbsp;#[<span class="id" title="var">global</span>] <span class="id" title="keyword">Instance</span> <a id="Expr__newdelete.new_tokenR_as_fractional" class="idref" href="#Expr__newdelete.new_tokenR_as_fractional"><span class="id" title="instance">new_tokenR_as_fractional</span></a> `{<a id="7fd4a516bfc23c1706437f236b640793" class="idref" href="#7fd4a516bfc23c1706437f236b640793"><span class="id" title="binder">Σ</span></a> : <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.cpp_logic"><span class="id" title="class">cpp_logic</span></a>} <a id="q:26" class="idref" href="#q:26"><span class="id" title="binder">q</span></a> <a id="ty:27" class="idref" href="#ty:27"><span class="id" title="binder">ty</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="class">AsFractional</span> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#q:26"><span class="id" title="variable">q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:27"><span class="id" title="variable">ty</span></a>) (<span class="id" title="keyword">fun</span> <a id="q:28" class="idref" href="#q:28"><span class="id" title="binder">q</span></a> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#q:28"><span class="id" title="variable">q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:27"><span class="id" title="variable">ty</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#q:26"><span class="id" title="variable">q</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">exact</span>: <span class="id" title="constructor">Build_AsFractional</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Expr__newdelete.with_cpp_logic" class="idref" href="#Expr__newdelete.with_cpp_logic"><span class="id" title="section">with_cpp_logic</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<a id="7374d4818eab9c7e7a123322e5aab0bf" class="idref" href="#7374d4818eab9c7e7a123322e5aab0bf"><span class="id" title="binder">Σ</span></a> : <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.cpp_logic"><span class="id" title="class">cpp_logic</span></a>}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Expr__newdelete.with_cpp_logic.with_resolve" class="idref" href="#Expr__newdelete.with_cpp_logic.with_resolve"><span class="id" title="section">with_resolve</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="06b43d5b33f680f1c997e1fdb8d32e12" class="idref" href="#06b43d5b33f680f1c997e1fdb8d32e12"><span class="id" title="binder">σ</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.genv.html#genv"><span class="id" title="class">genv</span></a>} (<a id="2ac343aedf3913c18cd669588c9853ef" class="idref" href="#2ac343aedf3913c18cd669588c9853ef"><span class="id" title="binder">ρ</span></a> : <a class="idref" href="bedrock.lang.cpp.logic.wp.html#region"><span class="id" title="inductive">region</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> (<a id="Expr__newdelete.with_cpp_logic.with_resolve.tu" class="idref" href="#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> : <a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#translation_unit"><span class="id" title="record">translation_unit</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.wp_init" class="idref" href="#Expr__newdelete.wp_init"><span class="id" title="abbreviation">wp_init</span></a> := (<a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_init"><span class="id" title="axiom">wp_init</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#70cf4ae13e57eff91798dfc327124f70"><span class="id" title="variable">ρ</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.wp_initialize" class="idref" href="#Expr__newdelete.wp_initialize"><span class="id" title="abbreviation">wp_initialize</span></a> := (<a class="idref" href="bedrock.lang.cpp.logic.initializers.html#wp_initialize"><span class="id" title="definition">wp_initialize</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#70cf4ae13e57eff91798dfc327124f70"><span class="id" title="variable">ρ</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.default_initialize" class="idref" href="#Expr__newdelete.default_initialize"><span class="id" title="abbreviation">default_initialize</span></a> := (<a class="idref" href="bedrock.lang.cpp.logic.initializers.html#default_initialize"><span class="id" title="abbreviation">default_initialize</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.wp_operand" class="idref" href="#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> := (<a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_operand"><span class="id" title="axiom">wp_operand</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#70cf4ae13e57eff91798dfc327124f70"><span class="id" title="variable">ρ</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.wp_args" class="idref" href="#Expr__newdelete.wp_args"><span class="id" title="abbreviation">wp_args</span></a> := (<a class="idref" href="bedrock.lang.cpp.logic.call.html#wp_args"><span class="id" title="definition">wp_args</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#70cf4ae13e57eff91798dfc327124f70"><span class="id" title="variable">ρ</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.size_of" class="idref" href="#Expr__newdelete.size_of"><span class="id" title="abbreviation">size_of</span></a> := (@<a class="idref" href="bedrock.lang.cpp.semantics.types.html#size_of"><span class="id" title="definition">size_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#c157a35e1ba5c2498b77741f718b9a1b"><span class="id" title="variable">σ</span></a>) (<span class="id" title="var">only</span> <span class="id" title="var">parsing</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.Tsize_t" class="idref" href="#Expr__newdelete.Tsize_t"><span class="id" title="abbreviation">Tsize_t</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tu64"><span class="id" title="abbreviation">Tu64</span></a> (<span class="id" title="var">only</span> <span class="id" title="var">parsing</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.Tbyte" class="idref" href="#Expr__newdelete.Tbyte"><span class="id" title="abbreviation">Tbyte</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tuchar"><span class="id" title="abbreviation">Tuchar</span></a> (<span class="id" title="var">only</span> <span class="id" title="var">parsing</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Expr__newdelete.alloc_size_t" class="idref" href="#Expr__newdelete.alloc_size_t"><span class="id" title="definition">alloc_size_t</span></a> (<a id="sz:35" class="idref" href="#sz:35"><span class="id" title="binder">sz</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>) (<a id="Q:36" class="idref" href="#Q:36"><span class="id" title="binder">Q</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.base_logic.mpred.html#mpred"><span class="id" title="definition">mpred</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="bedrock.lang.base_logic.mpred.html#mpred"><span class="id" title="definition">mpred</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="bedrock.lang.base_logic.mpred.html#mpred"><span class="id" title="definition">mpred</span></a>) : <a class="idref" href="bedrock.lang.base_logic.mpred.html#mpred"><span class="id" title="definition">mpred</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a id="p:37" class="idref" href="#p:37"><span class="id" title="binder">p</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:37"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#primR"><span class="id" title="abbreviation">primR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.Tsize_t"><span class="id" title="abbreviation">Tsize_t</span></a> (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.mut"><span class="id" title="abbreviation">cQp.mut</span></a> 1) (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vn"><span class="id" title="definition">Vn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:35"><span class="id" title="variable">sz</span></a>) <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:36"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:37"><span class="id" title="variable">p</span></a> (<span class="id" title="keyword">fun</span> <a id="Q:38" class="idref" href="#Q:38"><span class="id" title="binder">Q</span></a> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:37"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#anyR"><span class="id" title="abbreviation">anyR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.Tsize_t"><span class="id" title="abbreviation">Tsize_t</span></a> (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.mut"><span class="id" title="abbreviation">cQp.mut</span></a> 1) <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:38"><span class="id" title="variable">Q</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Expr__newdelete.with_cpp_logic.with_resolve.new" class="idref" href="#Expr__newdelete.with_cpp_logic.with_resolve.new"><span class="id" title="section">new</span></a>.<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.new"><span class="id" title="section">new</span></a></span> <span class="inlinecode">(...)</span> <span class="inlinecode"><a class="idref" href="bedrock.lang.algebra.coGset.html#C"><span class="id" title="abbreviation">C</span></a>(...)</span> &lt;https://eel.is/c++draft/expr.new&gt;
<ul class="doclist">
<li> invokes a C++ new operator <span class="inlinecode"><span class="id" title="var">new_fn</span></span>, which returns a storage pointer <span class="inlinecode"><span class="id" title="var">storage_ptr</span></span>;
              <span class="inlinecode"><span class="id" title="var">new_fn</span></span> <i>might</i> allocate memory
              (https://eel.is/c++draft/expr.new10), or return an argument
              address for some forms of placement new;
            - constructs an object pointer [obj_ptr], which shares the address of [storage_ptr];
            - invokes the constructor C over [obj_ptr].

            Furthermore <https://eel.is/c++draft/expr.new22&gt;:

</li>
</ul>
            | (22) A new-expression that creates an object of type T initializes that
            |      object as follows:
            | (22.1) If the new-initializer is omitted, the object is default-initialized
            |        (<span class="inlinecode"><span class="id" title="var">dcl.init</span></span>).
            |        <span class="inlinecode"><span class="id" title="var">Note</span></span> <span class="inlinecode">12:</span> <span class="inlinecode"><span class="id" title="var">If</span></span> <span class="inlinecode"><span class="id" title="keyword">no</span></span> <span class="inlinecode"><span class="id" title="var">initialization</span></span> <span class="inlinecode"><span class="id" title="keyword">is</span></span> <span class="inlinecode"><span class="id" title="var">performed</span>,</span> <span class="inlinecode"><span class="id" title="var">the</span></span> <span class="inlinecode"><span class="id" title="var">object</span></span> <span class="inlinecode"><span class="id" title="var">has</span></span> <span class="inlinecode"><span class="id" title="var">an</span></span>
            <span class="inlinecode">|</span>         <span class="inlinecode"><span class="id" title="var">indeterminate</span></span> <span class="inlinecode"><span class="id" title="var">value</span>.</span> <span class="inlinecode">—</span> <span class="inlinecode"><span class="id" title="keyword">end</span></span> <span class="inlinecode"><span class="id" title="var">note</span></span>
            | (22.2) Otherwise, the new-initializer is interpreted according to the
            |        initialization rules of <span class="inlinecode"><span class="id" title="var">dcl.init</span></span> for direct-initialization.
            We use <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.stmt.html#Stmt.default_initialize"><span class="id" title="abbreviation">default_initialize</span></a></span> for default ininitialization as it is defined in the
            C++ Standard and we use <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_init"><span class="id" title="abbreviation">wp_init</span></a></span> for direct-initialization as defined
            by the C++ Standard.

<div class="paragraph"> </div>

            ~~~ Implementation Details ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

<div class="paragraph"> </div>

<ul class="doclist">
<li> This axiom assumes that <span class="inlinecode"><span class="id" title="var">storage_ptr</span></span> points to a character array that will
              <i>provide storage</i> for a new <i>complete object</i> <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.pred_paradoxes.html#with_cpp.type_ptr_object_representation_full_is_unsound.o"><span class="id" title="variable">o</span></a></span>
              (http://eel.is/c++draft/intro.objectdef:provides_storage).

              In that case, the C++ abstract machine can choose to make [obj_ptr
              <> storage_ptr] (while keeping the same address), so that the old
              pointer [storage_ptr] cannot be used to access the new object.
              Inspired by Cerberus, we model this by _allowing_ [obj_ptr] to have
              a different allocation ID.

            - The created object might be a subobject of an existing object
              (pointed to by some pointer [p])
              (https://eel.is/c++draft/basic.memobjintro.object-2).
              It is unclear whether that requires <span class="inlinecode"><span class="id" title="var">storage_ptr</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.pred_paradoxes.html#with_cpp.type_ptr_object_representation_full_is_unsound.p"><span class="id" title="variable">p</span></a></span> or just
              <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.model.simple_pred.html#SimpleCPP.provides_storage"><span class="id" title="definition">provides_storage</span></a></span> <span class="inlinecode"><span class="id" title="var">storage_ptr</span></span> <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.pred_paradoxes.html#with_cpp.type_ptr_object_representation_full_is_unsound.p"><span class="id" title="variable">p</span></a></span>.
              In that case, we plan to allow proving that <span class="inlinecode"><span class="id" title="var">obj_ptr</span></span> = <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.pred_paradoxes.html#with_cpp.type_ptr_object_representation_full_is_unsound.p"><span class="id" title="variable">p</span></a></span> <span class="inlinecode">.,</span> <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.pred_paradoxes.html#with_cpp.type_ptr_object_representation_full_is_unsound.o"><span class="id" title="variable">o</span></a></span>; we
              offer no such support at present; we account for this case by not specifying that
              <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.model.inductive_pointers.html#PTRS_IMPL.ptr_alloc_id"><span class="id" title="definition">ptr_alloc_id</span></a></span> <span class="inlinecode"><span class="id" title="var">obj_ptr</span></span> <span class="inlinecode">&lt;&gt;</span> <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.model.inductive_pointers.html#PTRS_IMPL.ptr_alloc_id"><span class="id" title="definition">ptr_alloc_id</span></a></span> <span class="inlinecode"><span class="id" title="var">storage_ptr</span></span>.

</li>
<li> Currently, we do not model coalescing of multiple allocations
              (https://eel.is/c++draft/expr.new14).
         

</li>
</ul>
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Expr__newdelete.wp_opt_initialize" class="idref" href="#Expr__newdelete.wp_opt_initialize"><span class="id" title="definition">wp_opt_initialize</span></a> (<a id="oinit:39" class="idref" href="#oinit:39"><span class="id" title="binder">oinit</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Expr"><span class="id" title="inductive">Expr</span></a>) <a id="aty:40" class="idref" href="#aty:40"><span class="id" title="binder">aty</span></a> <a id="obj_ptr:41" class="idref" href="#obj_ptr:41"><span class="id" title="binder">obj_ptr</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#oinit:39"><span class="id" title="variable">oinit</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="comment">(*&nbsp;default_initialize&nbsp;the&nbsp;memory&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.default_initialize"><span class="id" title="abbreviation">default_initialize</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:40"><span class="id" title="variable">aty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:41"><span class="id" title="variable">obj_ptr</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">init</span> =&gt; <span class="comment">(*&nbsp;Use&nbsp;<span class="inlinecode"><span class="id" title="var">init</span></span>&nbsp;to&nbsp;initialize&nbsp;the&nbsp;memory&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_initialize"><span class="id" title="abbreviation">wp_initialize</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:40"><span class="id" title="variable">aty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:41"><span class="id" title="variable">obj_ptr</span></a> <span class="id" title="var">init</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">global</span>] <span class="id" title="var">Arguments</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_opt_initialize"><span class="id" title="definition">wp_opt_initialize</span></a> !<span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> /.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Expr__newdelete.wp_operand_new" class="idref" href="#Expr__newdelete.wp_operand_new"><span class="id" title="axiom">wp_operand_new</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">forall</span> <span class="id" title="notation">(</span><a id="oinit:43" class="idref" href="#oinit:43"><span class="id" title="binder">oinit</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Expr"><span class="id" title="inductive">Expr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="new_fn:44" class="idref" href="#new_fn:44"><span class="id" title="binder">new_fn</span></a> <a id="new_args:45" class="idref" href="#new_args:45"><span class="id" title="binder">new_args</span></a> <a id="aty:46" class="idref" href="#aty:46"><span class="id" title="binder">aty</span></a> <a id="Q:47" class="idref" href="#Q:47"><span class="id" title="binder">Q</span></a> <a id="targs:48" class="idref" href="#targs:48"><span class="id" title="binder">targs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="nfty:49" class="idref" href="#nfty:49"><span class="id" title="binder">nfty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#normalize_type"><span class="id" title="definition">normalize_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:44"><span class="id" title="variable">new_fn</span></a><span class="id" title="notation">.2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">_</span> : <a class="idref" href="bedrock.lang.cpp.logic.call.html#arg_types"><span class="id" title="definition">arg_types</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#nfty:49"><span class="id" title="variable">nfty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.Tsize_t"><span class="id" title="abbreviation">Tsize_t</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#targs:48"><span class="id" title="variable">targs</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">),</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">letI</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">*</span></a> <span class="id" title="var">_</span>, <a id="vs:50" class="idref" href="#vs:50"><span class="id" title="binder">vs</span></a>, <a id="ifree:51" class="idref" href="#ifree:51"><span class="id" title="binder">ifree</span></a>, <a id="free:52" class="idref" href="#free:52"><span class="id" title="binder">free</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">:=</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_args"><span class="id" title="abbreviation">wp_args</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.expr.html#evaluation_order.nd"><span class="id" title="constructor">evaluation_order.nd</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#targs:48"><span class="id" title="variable">targs</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_args:45"><span class="id" title="variable">new_args</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="alloc_sz:53" class="idref" href="#alloc_sz:53"><span class="id" title="binder">alloc_sz</span></a> <a id="alloc_al:54" class="idref" href="#alloc_al:54"><span class="id" title="binder">alloc_al</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.size_of"><span class="id" title="abbreviation">size_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:46"><span class="id" title="variable">aty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:53"><span class="id" title="variable">alloc_sz</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.has_type_prop"><span class="id" title="axiom">has_type_prop</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:53"><span class="id" title="variable">alloc_sz</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.Tsize_t"><span class="id" title="abbreviation">Tsize_t</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.types.html#align_of"><span class="id" title="axiom">align_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:46"><span class="id" title="variable">aty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_al:54"><span class="id" title="variable">alloc_al</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a>  </div>

<div class="doc">
&lt;-- TODO FM-975 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.prelude.base.html#Reduce"><span class="id" title="abbreviation">Reduce</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_size_t"><span class="id" title="definition">alloc_size_t</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:53"><span class="id" title="variable">alloc_sz</span></a> (<span class="id" title="keyword">fun</span> <a id="p:55" class="idref" href="#p:55"><span class="id" title="binder">p</span></a> <a id="FR:56" class="idref" href="#FR:56"><span class="id" title="binder">FR</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3100380cbf7f520075624a1979df30b0"><span class="id" title="notation">|&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_fptr"><span class="id" title="axiom">wp_fptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a>.(<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#types"><span class="id" title="projection">types</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#nfty:49"><span class="id" title="variable">nfty</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.path_pred.html#_global"><span class="id" title="definition">_global</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:44"><span class="id" title="variable">new_fn</span></a><span class="id" title="notation">.1</span>) (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:55"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#vs:50"><span class="id" title="variable">vs</span></a>) (<span class="id" title="keyword">fun</span> <a id="res:57" class="idref" href="#res:57"><span class="id" title="binder">res</span></a> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#FR:56"><span class="id" title="variable">FR</span></a> <span class="id" title="notation">$</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#f9d3e3a67e261f7f954c4cd8a90ae26c"><span class="id" title="notation">letI</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#f9d3e3a67e261f7f954c4cd8a90ae26c"><span class="id" title="notation">*</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#f9d3e3a67e261f7f954c4cd8a90ae26c"><span class="id" title="notation">:=</span></a> <a class="idref" href="bedrock.lang.cpp.logic.destroy.html#interp"><span class="id" title="abbreviation">interp</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ifree:51"><span class="id" title="variable">ifree</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#f9d3e3a67e261f7f954c4cd8a90ae26c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="storage_ptr:58" class="idref" href="#storage_ptr:58"><span class="id" title="binder">storage_ptr</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#res:57"><span class="id" title="variable">res</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#primR"><span class="id" title="abbreviation">primR</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a>) (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.mut"><span class="id" title="abbreviation">cQp.mut</span></a> 1) (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:58"><span class="id" title="variable">storage_ptr</span></a>) <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <span class="id" title="definition">bool_decide</span> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:58"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.nullptr"><span class="id" title="axiom">nullptr</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_args:45"><span class="id" title="variable">new_args</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:47"><span class="id" title="variable">Q</span></a> (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:58"><span class="id" title="variable">storage_ptr</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:52"><span class="id" title="variable">free</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">blockR</span></span> <span class="inlinecode"><span class="id" title="var">sz</span></span> <span class="inlinecode">-|-</span> <span class="inlinecode"><span class="id" title="var">tblockR</span></span> <span class="inlinecode"><span class="id" title="var">aty</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:58"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.heap_pred.block.html#blockR"><span class="id" title="definition">blockR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:53"><span class="id" title="variable">alloc_sz</span></a> (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.m"><span class="id" title="abbreviation">cQp.m</span></a> 1) <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.simple.html#alignedR"><span class="id" title="abbreviation">alignedR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_al:54"><span class="id" title="variable">alloc_al</span></a><a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">)</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
TODO: ^ This misses a condition that <span class="inlinecode"><span class="id" title="var">storage_ptr</span></span>
                            is suitably aligned, accounting for
                            <i>_STDCPP_DEFAULT_NEW_ALIGNMENT_</i> (issue 149; FM-975) 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">(</span></a><a id="obj_ptr:59" class="idref" href="#obj_ptr:59"><span class="id" title="binder">obj_ptr</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;also&nbsp;ensures&nbsp;these&nbsp;pointers&nbsp;share&nbsp;their<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;address&nbsp;(see&nbsp;<span class="inlinecode"><span class="id" title="var">provides_storage_same_address</span></span>)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.pred.html#L.provides_storage"><span class="id" title="axiom">provides_storage</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:58"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:59"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:46"><span class="id" title="variable">aty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_opt_initialize"><span class="id" title="definition">wp_opt_initialize</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#oinit:43"><span class="id" title="variable">oinit</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:46"><span class="id" title="variable">aty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:59"><span class="id" title="variable">obj_ptr</span></a> (<span class="id" title="keyword">fun</span> <a id="free':60" class="idref" href="#free':60"><span class="id" title="binder">free'</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Track&nbsp;the&nbsp;type&nbsp;we&nbsp;are&nbsp;allocating<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;checked&nbsp;at&nbsp;<span class="inlinecode"><span class="id" title="var">delete</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;It&nbsp;is&nbsp;important&nbsp;that&nbsp;this&nbsp;preseves<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`const`ness&nbsp;of&nbsp;the&nbsp;type.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:59"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.mut"><span class="id" title="abbreviation">cQp.mut</span></a> 1) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:46"><span class="id" title="variable">aty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:47"><span class="id" title="variable">Q</span></a> (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:59"><span class="id" title="variable">obj_ptr</span></a>) (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free':60"><span class="id" title="variable">free'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#3661e58f765c638206576597ccc57486"><span class="id" title="notation">&gt;*&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:52"><span class="id" title="variable">free</span></a>))<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">)</span></a>)))<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Enew"><span class="id" title="constructor">Enew</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:44"><span class="id" title="variable">new_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_args:45"><span class="id" title="variable">new_args</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:46"><span class="id" title="variable">aty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#oinit:43"><span class="id" title="variable">oinit</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:47"><span class="id" title="variable">Q</span></a>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand_placement_new"><span class="id" title="lemma">wp_operand_placement_new</span></a></span> specializes <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand_new"><span class="id" title="axiom">wp_operand_new</span></a></span> for invocations of
<a id="lab233"></a><h1 class="section">the form <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.new"><span class="id" title="section">new</span></a></span> <span class="inlinecode">(<a class="idref" href="bedrock.lang.cpp.logic.pred_paradoxes.html#with_cpp.type_ptr_object_representation_full_is_unsound.p"><span class="id" title="variable">p</span></a>)</span> <span class="inlinecode"><a class="idref" href="bedrock.lang.algebra.coGset.html#C"><span class="id" title="abbreviation">C</span></a>(...);</span> - where <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.pred_paradoxes.html#with_cpp.type_ptr_object_representation_full_is_unsound.p"><span class="id" title="variable">p</span></a></span> is a pointer to some memory with</h1>

<a id="lab234"></a><h1 class="section">the appropriate size and alignment constraints.</h1>

         *
<a id="lab235"></a><h1 class="section">Notes:</h1>

<a id="lab236"></a><h1 class="section">1) this rule /only/ covers uses of the library function placement new</h1>

<a id="lab237"></a><h1 class="section"><span class="inlinecode"><span class="id" title="library">operator</span></span> <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.new"><span class="id" title="section">new</span></a>[](<span class="id" title="var">std</span>​::​<span class="id" title="var">size_t</span>,</span> <span class="inlinecode"><span class="id" title="var">void</span>*</span> <span class="inlinecode">)</span> - although other user-defined variants</h1>

<a id="lab238"></a><h1 class="section">are possible to construct (cf. &lt;https://eel.is/c++draft/expr.new20>)</h1>

<a id="lab239"></a><h1 class="section">2) cf. &lt;https://eel.is/c++draft/expr.new21></h1>

<a id="lab240"></a><h1 class="section">| ...</h1>

<a id="lab241"></a><h1 class="section">|</h1>

<a id="lab242"></a><h1 class="section">| If the allocation function is a non-allocating form</h1>

<a id="lab243"></a><h1 class="section">| (<span class="inlinecode"><span class="id" title="var">new.delete.placement</span></span>) that returns null, the behavior</h1>

<a id="lab244"></a><h1 class="section">| is undefined. ...</h1>

         
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="Expr__newdelete.wp_operand_placement_new" class="idref" href="#Expr__newdelete.wp_operand_placement_new"><span class="id" title="lemma">wp_operand_placement_new</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">forall</span> <span class="id" title="notation">(</span><a id="oinit:62" class="idref" href="#oinit:62"><span class="id" title="binder">oinit</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Expr"><span class="id" title="inductive">Expr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="new_fn:63" class="idref" href="#new_fn:63"><span class="id" title="binder">new_fn</span></a> <a id="storage_expr:64" class="idref" href="#storage_expr:64"><span class="id" title="binder">storage_expr</span></a> <a id="aty:65" class="idref" href="#aty:65"><span class="id" title="binder">aty</span></a> <a id="Q:66" class="idref" href="#Q:66"><span class="id" title="binder">Q</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="nfty:67" class="idref" href="#nfty:67"><span class="id" title="binder">nfty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#normalize_type"><span class="id" title="definition">normalize_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:63"><span class="id" title="variable">new_fn</span></a><span class="id" title="notation">.2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">_</span> : <a class="idref" href="bedrock.lang.cpp.syntax.typing.html#type_of"><span class="id" title="definition">type_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_expr:64"><span class="id" title="variable">storage_expr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">_</span> : <a class="idref" href="bedrock.lang.cpp.logic.call.html#arg_types"><span class="id" title="definition">arg_types</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#nfty:67"><span class="id" title="variable">nfty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.Tsize_t"><span class="id" title="abbreviation">Tsize_t</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">),</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">letI</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">*</span></a> <span class="id" title="var">_</span>, <a id="vs:68" class="idref" href="#vs:68"><span class="id" title="binder">vs</span></a>, <a id="ifree:69" class="idref" href="#ifree:69"><span class="id" title="binder">ifree</span></a>, <a id="free:70" class="idref" href="#free:70"><span class="id" title="binder">free</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_args"><span class="id" title="abbreviation">wp_args</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.expr.html#evaluation_order.nd"><span class="id" title="constructor">evaluation_order.nd</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_expr:64"><span class="id" title="variable">storage_expr</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="alloc_sz:71" class="idref" href="#alloc_sz:71"><span class="id" title="binder">alloc_sz</span></a> <a id="alloc_al:72" class="idref" href="#alloc_al:72"><span class="id" title="binder">alloc_al</span></a> <a id="storage_ptr:73" class="idref" href="#storage_ptr:73"><span class="id" title="binder">storage_ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#vs:68"><span class="id" title="variable">vs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:73"><span class="id" title="variable">storage_ptr</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:73"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.nullptr"><span class="id" title="axiom">nullptr</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.size_of"><span class="id" title="abbreviation">size_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:65"><span class="id" title="variable">aty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:71"><span class="id" title="variable">alloc_sz</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.has_type_prop"><span class="id" title="axiom">has_type_prop</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:71"><span class="id" title="variable">alloc_sz</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.Tsize_t"><span class="id" title="abbreviation">Tsize_t</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.types.html#align_of"><span class="id" title="axiom">align_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:65"><span class="id" title="variable">aty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_al:72"><span class="id" title="variable">alloc_al</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> </div>

<div class="doc">
&lt;-- TODO FM-975 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.prelude.base.html#Reduce"><span class="id" title="abbreviation">Reduce</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_size_t"><span class="id" title="definition">alloc_size_t</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:71"><span class="id" title="variable">alloc_sz</span></a> (<span class="id" title="keyword">fun</span> <a id="p:74" class="idref" href="#p:74"><span class="id" title="binder">p</span></a> <a id="FR:75" class="idref" href="#FR:75"><span class="id" title="binder">FR</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3100380cbf7f520075624a1979df30b0"><span class="id" title="notation">|&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_fptr"><span class="id" title="axiom">wp_fptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a>.(<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#types"><span class="id" title="projection">types</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#nfty:67"><span class="id" title="variable">nfty</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.path_pred.html#_global"><span class="id" title="definition">_global</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:63"><span class="id" title="variable">new_fn</span></a><span class="id" title="notation">.1</span>) (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:74"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#vs:68"><span class="id" title="variable">vs</span></a>) (<span class="id" title="keyword">fun</span> <a id="res:76" class="idref" href="#res:76"><span class="id" title="binder">res</span></a> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#FR:75"><span class="id" title="variable">FR</span></a> <span class="id" title="notation">$</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#f9d3e3a67e261f7f954c4cd8a90ae26c"><span class="id" title="notation">letI</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#f9d3e3a67e261f7f954c4cd8a90ae26c"><span class="id" title="notation">*</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#f9d3e3a67e261f7f954c4cd8a90ae26c"><span class="id" title="notation">:=</span></a> <a class="idref" href="bedrock.lang.cpp.logic.destroy.html#interp"><span class="id" title="abbreviation">interp</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ifree:69"><span class="id" title="variable">ifree</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#f9d3e3a67e261f7f954c4cd8a90ae26c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#res:76"><span class="id" title="variable">res</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#primR"><span class="id" title="abbreviation">primR</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a>) (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.mut"><span class="id" title="abbreviation">cQp.mut</span></a> 1) (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:73"><span class="id" title="variable">storage_ptr</span></a>) <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">blockR</span></span> <span class="inlinecode"><span class="id" title="var">sz</span></span> <span class="inlinecode">-|-</span> <span class="inlinecode"><span class="id" title="var">tblockR</span></span> <span class="inlinecode"><span class="id" title="var">aty</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:73"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.heap_pred.block.html#blockR"><span class="id" title="definition">blockR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:71"><span class="id" title="variable">alloc_sz</span></a> (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.m"><span class="id" title="abbreviation">cQp.m</span></a> 1) <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.simple.html#alignedR"><span class="id" title="abbreviation">alignedR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_al:72"><span class="id" title="variable">alloc_al</span></a><a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">)</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
TODO: ^ This misses a condition that <span class="inlinecode"><span class="id" title="var">storage_ptr</span></span>
                        is suitably aligned, accounting for
                        <i>_STDCPP_DEFAULT_NEW_ALIGNMENT_</i> (issue 149, FM-975) 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">(</span></a><a id="obj_ptr:77" class="idref" href="#obj_ptr:77"><span class="id" title="binder">obj_ptr</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;also&nbsp;ensures&nbsp;these&nbsp;pointers&nbsp;share&nbsp;their<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;address&nbsp;(see&nbsp;<span class="inlinecode"><span class="id" title="var">provides_storage_same_address</span></span>)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.pred.html#L.provides_storage"><span class="id" title="axiom">provides_storage</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:73"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:77"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:65"><span class="id" title="variable">aty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_opt_initialize"><span class="id" title="definition">wp_opt_initialize</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#oinit:62"><span class="id" title="variable">oinit</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:65"><span class="id" title="variable">aty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:77"><span class="id" title="variable">obj_ptr</span></a> (<span class="id" title="keyword">fun</span> <a id="free':78" class="idref" href="#free':78"><span class="id" title="binder">free'</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Track&nbsp;the&nbsp;type&nbsp;we&nbsp;are&nbsp;allocating<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;checked&nbsp;at&nbsp;<span class="inlinecode"><span class="id" title="var">delete</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;It&nbsp;is&nbsp;important&nbsp;that&nbsp;this&nbsp;preseves<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`const`ness&nbsp;of&nbsp;the&nbsp;type.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:77"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.mut"><span class="id" title="abbreviation">cQp.mut</span></a> 1) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:65"><span class="id" title="variable">aty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:66"><span class="id" title="variable">Q</span></a> (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:77"><span class="id" title="variable">obj_ptr</span></a>) (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free':78"><span class="id" title="variable">free'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#3661e58f765c638206576597ccc57486"><span class="id" title="notation">&gt;*&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:70"><span class="id" title="variable">free</span></a>))<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">)</span></a>)))<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Enew"><span class="id" title="constructor">Enew</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:63"><span class="id" title="variable">new_fn</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_expr:64"><span class="id" title="variable">storage_expr</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:65"><span class="id" title="variable">aty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#oinit:62"><span class="id" title="variable">oinit</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:66"><span class="id" title="variable">Q</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> **; <span class="id" title="var">iIntros</span> "args".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand_new"><span class="id" title="axiom">wp_operand_new</span></a>; <span class="id" title="tactic">eauto</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">pre</span> <span class="id" title="var">post</span> <span class="id" title="var">q</span>) "%Hspec".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">pre</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="var">post</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hpre</span> <span class="id" title="var">Hpost</span>]. 1: {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">pre</span>; <span class="id" title="tactic">first</span> (<span class="id" title="tactic">intuition</span>; <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#app_nil_l"><span class="id" title="lemma">app_nil_l</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hspec</span>). 2: {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">exfalso</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hspec</span>; <span class="id" title="tactic">by</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#app_cons_not_nil"><span class="id" title="lemma">app_cons_not_nil</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">post</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">exfalso</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hspec</span>; <span class="id" title="tactic">by</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#app_cons_not_nil"><span class="id" title="lemma">app_cons_not_nil</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.Mbind_frame"><span class="id" title="lemma">Mbind_frame</span></a>; <span class="id" title="var">last</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "args"; <span class="id" title="tactic">by</span> <span class="id" title="var">iPureIntro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>: <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hspec</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Hspec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iIntros</span> (<span class="id" title="var">R</span> <span class="id" title="var">S</span>) "RS R"; <span class="id" title="var">iIntros</span> (<span class="id" title="var">p</span>); <span class="id" title="var">iSpecialize</span> <span class="id" title="notation">(</span>"R" <span class="id" title="notation">$!</span> <span class="id" title="var">p</span><span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iRevert</span> "R". <span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.initializers.html#wp_initialize_frame"><span class="id" title="lemma">wp_initialize_frame</span></a> =&gt; //.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iIntros</span> (<span class="id" title="var">p</span>); <span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.Mmap_frame"><span class="id" title="lemma">Mmap_frame</span></a>; <span class="id" title="var">iIntros</span> (<span class="id" title="var">R</span> <span class="id" title="var">S</span>) "RS R"; <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "RS".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iIntros</span> (<span class="id" title="var">ps</span> <span class="id" title="var">free</span>) "H".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "H"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> (<span class="id" title="var">alloc_sz</span> <span class="id" title="var">alloc_al</span> <span class="id" title="var">storage_ptr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"(-&gt; &amp; %Hstorage_ptr &amp; %Halloc_sz &amp; % &amp; %Halloc_al &amp; H)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iExists</span> <span class="id" title="var">alloc_sz</span>, <span class="id" title="var">alloc_al</span>; <span class="id" title="var">iFrame</span> "%"; <span class="id" title="var">iIntros</span> (<span class="id" title="var">p</span>) "alloc_sz".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span>"H" <span class="id" title="notation">$!</span> <span class="id" title="var">p</span> <span class="id" title="notation">with</span> "alloc_sz"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "spec"; <span class="id" title="var">iModIntro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_fptr_frame"><span class="id" title="lemma">wp_fptr_frame</span></a>; <span class="id" title="var">last</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "spec".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">v</span>) "[$ X]"; <span class="id" title="var">iRevert</span> "X"; <span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.destroy.html#interp_frame"><span class="id" title="lemma">interp_frame</span></a>; <span class="id" title="var">iIntros</span> "X".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iExists</span> <span class="id" title="var">storage_ptr</span>; <span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="abbreviation">bool_decide_false</span>; <span class="id" title="var">last</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Expr__newdelete.wp_operand_array_new" class="idref" href="#Expr__newdelete.wp_operand_array_new"><span class="id" title="axiom">wp_operand_array_new</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">forall</span> <span class="id" title="notation">(</span><a id="array_size:79" class="idref" href="#array_size:79"><span class="id" title="binder">array_size</span></a> : <a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Expr"><span class="id" title="inductive">Expr</span></a>) (<a id="oinit:80" class="idref" href="#oinit:80"><span class="id" title="binder">oinit</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Expr"><span class="id" title="inductive">Expr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="new_fn:81" class="idref" href="#new_fn:81"><span class="id" title="binder">new_fn</span></a> <a id="new_args:82" class="idref" href="#new_args:82"><span class="id" title="binder">new_args</span></a> <a id="aty:83" class="idref" href="#aty:83"><span class="id" title="binder">aty</span></a> <a id="Q:84" class="idref" href="#Q:84"><span class="id" title="binder">Q</span></a> <a id="targs:85" class="idref" href="#targs:85"><span class="id" title="binder">targs</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="nfty:86" class="idref" href="#nfty:86"><span class="id" title="binder">nfty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#normalize_type"><span class="id" title="definition">normalize_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:81"><span class="id" title="variable">new_fn</span></a><span class="id" title="notation">.2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">_</span> : <a class="idref" href="bedrock.lang.cpp.logic.call.html#arg_types"><span class="id" title="definition">arg_types</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#nfty:86"><span class="id" title="variable">nfty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.Tsize_t"><span class="id" title="abbreviation">Tsize_t</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#targs:85"><span class="id" title="variable">targs</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">),</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&lt;https://eel.is/c++draft/expr.new7>
               | (7) Every constant-expression in a noptr-new-declarator shall be a
               |     converted constant expression ([expr.const]) of type std​::​size_t
               |     and its value shall be greater than zero.
               |     [Example 4: Given the definition int n = 42, new float[n][5] is
               |      well-formed (because n is the expression of a noptr-new-declarator),
               |      but new float[5][n] is ill-formed (because n is not a constant
               |      expression). — end example]
               If we're allocating a new array, we know that the expression must reduce
               to a constant value of type [size_t] /and/ that it must be sequenced
               before we call the [new_fn].
             *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">letI</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">*</span></a> <a id="v:87" class="idref" href="#v:87"><span class="id" title="binder">v</span></a>, <a id="free:88" class="idref" href="#free:88"><span class="id" title="binder">free</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">:=</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_size:79"><span class="id" title="variable">array_size</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Valid&nbsp;C++&nbsp;programs&nbsp;require&nbsp;this&nbsp;value&nbsp;to&nbsp;be&nbsp;a&nbsp;<span class="inlinecode"><span class="id" title="var">Vint</span></span>&nbsp;(see&nbsp;the&nbsp;quote&nbsp;from<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">expr.new</span>#7</span>&nbsp;above).&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="array_sizeN:89" class="idref" href="#array_sizeN:89"><span class="id" title="binder">array_sizeN</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#v:87"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vn"><span class="id" title="definition">Vn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_sizeN:89"><span class="id" title="variable">array_sizeN</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;size&nbsp;must&nbsp;be&nbsp;greater&nbsp;than&nbsp;zero&nbsp;(see&nbsp;the&nbsp;quote&nbsp;from&nbsp;<span class="inlinecode"><span class="id" title="var">expr.new</span>#7</span>&nbsp;above).&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_sizeN:89"><span class="id" title="variable">array_sizeN</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a>%<span class="id" title="var">N</span> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">letI</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">*</span></a> <span class="id" title="var">_</span>, <a id="vs:90" class="idref" href="#vs:90"><span class="id" title="binder">vs</span></a>, <a id="ifree:91" class="idref" href="#ifree:91"><span class="id" title="binder">ifree</span></a>, <a id="free':92" class="idref" href="#free':92"><span class="id" title="binder">free'</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_args"><span class="id" title="abbreviation">wp_args</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.expr.html#evaluation_order.nd"><span class="id" title="constructor">evaluation_order.nd</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#targs:85"><span class="id" title="variable">targs</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_args:82"><span class="id" title="variable">new_args</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="alloc_sz:93" class="idref" href="#alloc_sz:93"><span class="id" title="binder">alloc_sz</span></a> <a id="alloc_al:94" class="idref" href="#alloc_al:94"><span class="id" title="binder">alloc_al</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="array_ty:95" class="idref" href="#array_ty:95"><span class="id" title="binder">array_ty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tarray"><span class="id" title="constructor">Tarray</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:83"><span class="id" title="variable">aty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_sizeN:89"><span class="id" title="variable">array_sizeN</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.size_of"><span class="id" title="abbreviation">size_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:95"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:93"><span class="id" title="variable">alloc_sz</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.has_type_prop"><span class="id" title="axiom">has_type_prop</span></a> (2 <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:93"><span class="id" title="variable">alloc_sz</span></a>)%<span class="id" title="var">N</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.Tsize_t"><span class="id" title="abbreviation">Tsize_t</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;^^&nbsp;the&nbsp;overhead,&nbsp;<span class="inlinecode"><span class="id" title="var">overhead_sz</span></span>&nbsp;below,&nbsp;is&nbsp;less&nbsp;than&nbsp;or&nbsp;equal&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;of&nbsp;the&nbsp;object,&nbsp;and&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;overhead&nbsp;and&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allocation&nbsp;size&nbsp;must&nbsp;fit&nbsp;in&nbsp;a&nbsp;`size_t`.&nbsp;See<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://eel.is/c++draft/expr.new16 for more information *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.types.html#align_of"><span class="id" title="axiom">align_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:83"><span class="id" title="variable">aty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_al:94"><span class="id" title="variable">alloc_al</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> </div>

<div class="doc">
&lt;-- TODO FM-975 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;NOTE:&nbsp;This&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">Forall</span></span> <span class="inlinecode"><span class="id" title="var">sz'</span></span>&nbsp;because&nbsp;the&nbsp;C++&nbsp;Abstract&nbsp;Machine&nbsp;can&nbsp;choose<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;however&nbsp;many&nbsp;bytes&nbsp;it&nbsp;wants&nbsp;to&nbsp;use&nbsp;for&nbsp;metadata&nbsp;when&nbsp;handling<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynamically&nbsp;allocated&nbsp;arrays.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a id="overhead_sz:96" class="idref" href="#overhead_sz:96"><span class="id" title="binder">overhead_sz</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#overhead_sz:96"><span class="id" title="variable">overhead_sz</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:93"><span class="id" title="variable">alloc_sz</span></a>)%<span class="id" title="var">N</span> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.prelude.base.html#Reduce"><span class="id" title="abbreviation">Reduce</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_size_t"><span class="id" title="definition">alloc_size_t</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#overhead_sz:96"><span class="id" title="variable">overhead_sz</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:93"><span class="id" title="variable">alloc_sz</span></a>) (<span class="id" title="keyword">fun</span> <a id="psz:97" class="idref" href="#psz:97"><span class="id" title="binder">psz</span></a> <a id="FR:98" class="idref" href="#FR:98"><span class="id" title="binder">FR</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3100380cbf7f520075624a1979df30b0"><span class="id" title="notation">|&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_fptr"><span class="id" title="axiom">wp_fptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a>.(<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#types"><span class="id" title="projection">types</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#nfty:86"><span class="id" title="variable">nfty</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.path_pred.html#_global"><span class="id" title="definition">_global</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:81"><span class="id" title="variable">new_fn</span></a><span class="id" title="notation">.1</span>) (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#psz:97"><span class="id" title="variable">psz</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#vs:90"><span class="id" title="variable">vs</span></a>) (<span class="id" title="keyword">fun</span> <a id="res:99" class="idref" href="#res:99"><span class="id" title="binder">res</span></a> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#FR:98"><span class="id" title="variable">FR</span></a> <span class="id" title="notation">$</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#f9d3e3a67e261f7f954c4cd8a90ae26c"><span class="id" title="notation">letI</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#f9d3e3a67e261f7f954c4cd8a90ae26c"><span class="id" title="notation">*</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#f9d3e3a67e261f7f954c4cd8a90ae26c"><span class="id" title="notation">:=</span></a> <a class="idref" href="bedrock.lang.cpp.logic.destroy.html#interp"><span class="id" title="abbreviation">interp</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ifree:91"><span class="id" title="variable">ifree</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#f9d3e3a67e261f7f954c4cd8a90ae26c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">(</span></a><a id="storage_ptr:100" class="idref" href="#storage_ptr:100"><span class="id" title="binder">storage_ptr</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#res:99"><span class="id" title="variable">res</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#primR"><span class="id" title="abbreviation">primR</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a>) (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.mut"><span class="id" title="abbreviation">cQp.mut</span></a> 1) (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:100"><span class="id" title="variable">storage_ptr</span></a>) <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <span class="id" title="definition">bool_decide</span> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:100"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.nullptr"><span class="id" title="axiom">nullptr</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_args:82"><span class="id" title="variable">new_args</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:84"><span class="id" title="variable">Q</span></a> (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:100"><span class="id" title="variable">storage_ptr</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:88"><span class="id" title="variable">free</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">blockR</span></span> <span class="inlinecode"><span class="id" title="var">alloc_sz</span></span> <span class="inlinecode">-|-</span> <span class="inlinecode"><span class="id" title="var">tblockR</span></span> <span class="inlinecode">(<span class="id" title="var">Tarray</span></span> <span class="inlinecode"><span class="id" title="var">aty</span></span> <span class="inlinecode"><span class="id" title="var">array_size</span>)</span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:100"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.block.html#blockR"><span class="id" title="definition">blockR</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#overhead_sz:96"><span class="id" title="variable">overhead_sz</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:93"><span class="id" title="variable">alloc_sz</span></a>) (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.m"><span class="id" title="abbreviation">cQp.m</span></a> 1) <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:100"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">.[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tu8"><span class="id" title="abbreviation">Tu8</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">!</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#overhead_sz:96"><span class="id" title="variable">overhead_sz</span></a><a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">]</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.simple.html#alignedR"><span class="id" title="abbreviation">alignedR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_al:94"><span class="id" title="variable">alloc_al</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
TODO: ^ This misses a condition that <span class="inlinecode"><span class="id" title="var">storage_ptr</span></span>
                                is suitably aligned, accounting for
                                <i>_STDCPP_DEFAULT_NEW_ALIGNMENT_</i> (issue 149, FM-975) 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">(</span></a><a id="obj_ptr:101" class="idref" href="#obj_ptr:101"><span class="id" title="binder">obj_ptr</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;also&nbsp;ensures&nbsp;these&nbsp;pointers&nbsp;share&nbsp;their<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;address&nbsp;(see&nbsp;<span class="inlinecode"><span class="id" title="var">provides_storage_same_address</span></span>)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.pred.html#L.provides_storage"><span class="id" title="axiom">provides_storage</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:100"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">.[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tu8"><span class="id" title="abbreviation">Tu8</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">!</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#overhead_sz:96"><span class="id" title="variable">overhead_sz</span></a><a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">]</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:101"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:95"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_opt_initialize"><span class="id" title="definition">wp_opt_initialize</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#oinit:80"><span class="id" title="variable">oinit</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:95"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:101"><span class="id" title="variable">obj_ptr</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="free'':102" class="idref" href="#free'':102"><span class="id" title="binder">free''</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Track&nbsp;the&nbsp;type&nbsp;we&nbsp;are&nbsp;allocating<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;checked&nbsp;at&nbsp;<span class="inlinecode"><span class="id" title="var">delete</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:101"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.mut"><span class="id" title="abbreviation">cQp.mut</span></a> 1) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:95"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:84"><span class="id" title="variable">Q</span></a> (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:101"><span class="id" title="variable">obj_ptr</span></a>) (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free'':102"><span class="id" title="variable">free''</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#3661e58f765c638206576597ccc57486"><span class="id" title="notation">&gt;*&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free':92"><span class="id" title="variable">free'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#3661e58f765c638206576597ccc57486"><span class="id" title="notation">&gt;*&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:88"><span class="id" title="variable">free</span></a>))<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">)</span></a>)))<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Enew"><span class="id" title="constructor">Enew</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:81"><span class="id" title="variable">new_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_args:82"><span class="id" title="variable">new_args</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:83"><span class="id" title="variable">aty</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_size:79"><span class="id" title="variable">array_size</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#oinit:80"><span class="id" title="variable">oinit</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:84"><span class="id" title="variable">Q</span></a>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand_array_placement_new"><span class="id" title="lemma">wp_operand_array_placement_new</span></a></span> specializes <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand_array_new"><span class="id" title="axiom">wp_operand_array_new</span></a></span> for
<a id="lab245"></a><h1 class="section">invocations of the form <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.new"><span class="id" title="section">new</span></a></span> <span class="inlinecode">(<a class="idref" href="bedrock.lang.cpp.logic.pred_paradoxes.html#with_cpp.type_ptr_object_representation_full_is_unsound.p"><span class="id" title="variable">p</span></a>)</span> <span class="inlinecode"><a class="idref" href="bedrock.lang.algebra.coGset.html#C"><span class="id" title="abbreviation">C</span></a>[...];</span> - where <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.pred_paradoxes.html#with_cpp.type_ptr_object_representation_full_is_unsound.p"><span class="id" title="variable">p</span></a></span> is a pointer to</h1>

<a id="lab246"></a><h1 class="section">some memory with the appropriate size and alignment constraints.</h1>

         *
<a id="lab247"></a><h1 class="section">Notes:</h1>

<a id="lab248"></a><h1 class="section">1) this rule /only/ covers uses of the library function placement new</h1>

<a id="lab249"></a><h1 class="section"><span class="inlinecode"><span class="id" title="library">operator</span></span> <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.new"><span class="id" title="section">new</span></a>[](<span class="id" title="var">std</span>​::​<span class="id" title="var">size_t</span>,</span> <span class="inlinecode"><span class="id" title="var">void</span>*</span> <span class="inlinecode">)</span> - although other user-defined variants</h1>

<a id="lab250"></a><h1 class="section">are possible to construct (cf. &lt;https://eel.is/c++draft/expr.new20>)</h1>

<a id="lab251"></a><h1 class="section">2) cf. &lt;https://eel.is/c++draft/expr.new21></h1>

<a id="lab252"></a><h1 class="section">| ...</h1>

<a id="lab253"></a><h1 class="section">|</h1>

<a id="lab254"></a><h1 class="section">| If the allocation function is a non-allocating form</h1>

<a id="lab255"></a><h1 class="section">| (<span class="inlinecode"><span class="id" title="var">new.delete.placement</span></span>) that returns null, the behavior</h1>

<a id="lab256"></a><h1 class="section">| is undefined. ...</h1>

         
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="Expr__newdelete.wp_operand_array_placement_new" class="idref" href="#Expr__newdelete.wp_operand_array_placement_new"><span class="id" title="lemma">wp_operand_array_placement_new</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">forall</span> <span class="id" title="notation">(</span><a id="array_size:104" class="idref" href="#array_size:104"><span class="id" title="binder">array_size</span></a> : <a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Expr"><span class="id" title="inductive">Expr</span></a>) (<a id="oinit:105" class="idref" href="#oinit:105"><span class="id" title="binder">oinit</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Expr"><span class="id" title="inductive">Expr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="new_fn:106" class="idref" href="#new_fn:106"><span class="id" title="binder">new_fn</span></a> <a id="storage_expr:107" class="idref" href="#storage_expr:107"><span class="id" title="binder">storage_expr</span></a> <a id="aty:108" class="idref" href="#aty:108"><span class="id" title="binder">aty</span></a> <a id="Q:109" class="idref" href="#Q:109"><span class="id" title="binder">Q</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="nfty:110" class="idref" href="#nfty:110"><span class="id" title="binder">nfty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#normalize_type"><span class="id" title="definition">normalize_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:106"><span class="id" title="variable">new_fn</span></a><span class="id" title="notation">.2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">_</span> : <a class="idref" href="bedrock.lang.cpp.syntax.typing.html#type_of"><span class="id" title="definition">type_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_expr:107"><span class="id" title="variable">storage_expr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">_</span> : <a class="idref" href="bedrock.lang.cpp.logic.call.html#arg_types"><span class="id" title="definition">arg_types</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#nfty:110"><span class="id" title="variable">nfty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.Tsize_t"><span class="id" title="abbreviation">Tsize_t</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">),</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&lt;https://eel.is/c++draft/expr.new7>
               | (7) Every constant-expression in a noptr-new-declarator shall be a
               |     converted constant expression ([expr.const]) of type std​::​size_t
               |     and its value shall be greater than zero.
               |     [Example 4: Given the definition int n = 42, new float[n][5] is
               |      well-formed (because n is the expression of a noptr-new-declarator),
               |      but new float[5][n] is ill-formed (because n is not a constant
               |      expression). — end example]
               If we're allocating a new array, we know that the expression must reduce
               to a constant value of type [size_t] /and/ that it must be sequenced
               before we call the [new_fn].
             *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_size:104"><span class="id" title="variable">array_size</span></a> (<span class="id" title="keyword">fun</span> <a id="v:111" class="idref" href="#v:111"><span class="id" title="binder">v</span></a> <a id="free:112" class="idref" href="#free:112"><span class="id" title="binder">free</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Valid&nbsp;C++&nbsp;programs&nbsp;require&nbsp;this&nbsp;value&nbsp;to&nbsp;be&nbsp;a&nbsp;<span class="inlinecode"><span class="id" title="var">Vint</span></span>&nbsp;(see&nbsp;the&nbsp;quote&nbsp;from<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">expr.new</span>#7</span>&nbsp;above).&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="array_sizeN:113" class="idref" href="#array_sizeN:113"><span class="id" title="binder">array_sizeN</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#v:111"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vn"><span class="id" title="definition">Vn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_sizeN:113"><span class="id" title="variable">array_sizeN</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;size&nbsp;must&nbsp;be&nbsp;greater&nbsp;than&nbsp;zero&nbsp;(see&nbsp;the&nbsp;quote&nbsp;from&nbsp;<span class="inlinecode"><span class="id" title="var">expr.new</span>#7</span>&nbsp;above).&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_sizeN:113"><span class="id" title="variable">array_sizeN</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a>%<span class="id" title="var">N</span> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">letI</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">*</span></a> <span class="id" title="var">_</span>, <a id="vs:114" class="idref" href="#vs:114"><span class="id" title="binder">vs</span></a>, <a id="ifree:115" class="idref" href="#ifree:115"><span class="id" title="binder">ifree</span></a>, <a id="free':116" class="idref" href="#free':116"><span class="id" title="binder">free'</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">:=</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_args"><span class="id" title="abbreviation">wp_args</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.expr.html#evaluation_order.nd"><span class="id" title="constructor">evaluation_order.nd</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_expr:107"><span class="id" title="variable">storage_expr</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="alloc_sz:117" class="idref" href="#alloc_sz:117"><span class="id" title="binder">alloc_sz</span></a> <a id="alloc_al:118" class="idref" href="#alloc_al:118"><span class="id" title="binder">alloc_al</span></a> <a id="storage_ptr:119" class="idref" href="#storage_ptr:119"><span class="id" title="binder">storage_ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#vs:114"><span class="id" title="variable">vs</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:119"><span class="id" title="variable">storage_ptr</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:119"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.nullptr"><span class="id" title="axiom">nullptr</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="array_ty:120" class="idref" href="#array_ty:120"><span class="id" title="binder">array_ty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tarray"><span class="id" title="constructor">Tarray</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:108"><span class="id" title="variable">aty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_sizeN:113"><span class="id" title="variable">array_sizeN</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.size_of"><span class="id" title="abbreviation">size_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:120"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:117"><span class="id" title="variable">alloc_sz</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.has_type_prop"><span class="id" title="axiom">has_type_prop</span></a> (2 <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:117"><span class="id" title="variable">alloc_sz</span></a>)%<span class="id" title="var">N</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.Tsize_t"><span class="id" title="abbreviation">Tsize_t</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;^^&nbsp;the&nbsp;overhead,&nbsp;<span class="inlinecode"><span class="id" title="var">overhead_sz</span></span>&nbsp;below,&nbsp;is&nbsp;less&nbsp;than&nbsp;or&nbsp;equal&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;of&nbsp;the&nbsp;object,&nbsp;and&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;overhead&nbsp;and&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allocation&nbsp;size&nbsp;must&nbsp;fit&nbsp;in&nbsp;a&nbsp;`size_t`.&nbsp;See<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://eel.is/c++draft/expr.new16 for more information *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.types.html#align_of"><span class="id" title="axiom">align_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:108"><span class="id" title="variable">aty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_al:118"><span class="id" title="variable">alloc_al</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> </div>

<div class="doc">
&lt;-- TODO FM-975 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a id="overhead_sz:121" class="idref" href="#overhead_sz:121"><span class="id" title="binder">overhead_sz</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#overhead_sz:121"><span class="id" title="variable">overhead_sz</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:117"><span class="id" title="variable">alloc_sz</span></a>)%<span class="id" title="var">N</span> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.prelude.base.html#Reduce"><span class="id" title="abbreviation">Reduce</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_size_t"><span class="id" title="definition">alloc_size_t</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#overhead_sz:121"><span class="id" title="variable">overhead_sz</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:117"><span class="id" title="variable">alloc_sz</span></a>) (<span class="id" title="keyword">fun</span> <a id="psz:122" class="idref" href="#psz:122"><span class="id" title="binder">psz</span></a> <a id="FR:123" class="idref" href="#FR:123"><span class="id" title="binder">FR</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3100380cbf7f520075624a1979df30b0"><span class="id" title="notation">|&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_fptr"><span class="id" title="axiom">wp_fptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a>.(<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#types"><span class="id" title="projection">types</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#nfty:110"><span class="id" title="variable">nfty</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.path_pred.html#_global"><span class="id" title="definition">_global</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:106"><span class="id" title="variable">new_fn</span></a><span class="id" title="notation">.1</span>) (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#psz:122"><span class="id" title="variable">psz</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#vs:114"><span class="id" title="variable">vs</span></a>) (<span class="id" title="keyword">fun</span> <a id="res:124" class="idref" href="#res:124"><span class="id" title="binder">res</span></a> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#FR:123"><span class="id" title="variable">FR</span></a> <span class="id" title="notation">$</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#f9d3e3a67e261f7f954c4cd8a90ae26c"><span class="id" title="notation">letI</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#f9d3e3a67e261f7f954c4cd8a90ae26c"><span class="id" title="notation">*</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#f9d3e3a67e261f7f954c4cd8a90ae26c"><span class="id" title="notation">:=</span></a> <a class="idref" href="bedrock.lang.cpp.logic.destroy.html#interp"><span class="id" title="abbreviation">interp</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ifree:115"><span class="id" title="variable">ifree</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#f9d3e3a67e261f7f954c4cd8a90ae26c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#res:124"><span class="id" title="variable">res</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#primR"><span class="id" title="abbreviation">primR</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a>) (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.mut"><span class="id" title="abbreviation">cQp.mut</span></a> 1) (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:119"><span class="id" title="variable">storage_ptr</span></a>) <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">blockR</span></span> <span class="inlinecode"><span class="id" title="var">alloc_sz</span></span> <span class="inlinecode">-|-</span> <span class="inlinecode"><span class="id" title="var">tblockR</span></span> <span class="inlinecode">(<span class="id" title="var">Tarray</span></span> <span class="inlinecode"><span class="id" title="var">aty</span></span> <span class="inlinecode"><span class="id" title="var">array_size</span>)</span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:119"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.block.html#blockR"><span class="id" title="definition">blockR</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#overhead_sz:121"><span class="id" title="variable">overhead_sz</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_sz:117"><span class="id" title="variable">alloc_sz</span></a>) (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.m"><span class="id" title="abbreviation">cQp.m</span></a> 1) <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:119"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">.[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tu8"><span class="id" title="abbreviation">Tu8</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">!</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#overhead_sz:121"><span class="id" title="variable">overhead_sz</span></a><a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">]</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.simple.html#alignedR"><span class="id" title="abbreviation">alignedR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#alloc_al:118"><span class="id" title="variable">alloc_al</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
TODO: ^ This misses a condition that <span class="inlinecode"><span class="id" title="var">storage_ptr</span></span>
                              is suitably aligned, accounting for
                              <i>_STDCPP_DEFAULT_NEW_ALIGNMENT_</i> (issue 149, FM-975) 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">(</span></a><a id="obj_ptr:125" class="idref" href="#obj_ptr:125"><span class="id" title="binder">obj_ptr</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;also&nbsp;ensures&nbsp;these&nbsp;pointers&nbsp;share&nbsp;their<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;address&nbsp;(see&nbsp;<span class="inlinecode"><span class="id" title="var">provides_storage_same_address</span></span>)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.pred.html#L.provides_storage"><span class="id" title="axiom">provides_storage</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:119"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">.[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tu8"><span class="id" title="abbreviation">Tu8</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">!</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#overhead_sz:121"><span class="id" title="variable">overhead_sz</span></a><a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">]</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:125"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:120"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">letI</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">*</span></a> <a id="free'':126" class="idref" href="#free'':126"><span class="id" title="binder">free''</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">:=</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_opt_initialize"><span class="id" title="definition">wp_opt_initialize</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#oinit:105"><span class="id" title="variable">oinit</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:120"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:125"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#c221b9dad79b2807ca5890fdbaa6e59d"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Track&nbsp;the&nbsp;type&nbsp;we&nbsp;are&nbsp;allocating<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;checked&nbsp;at&nbsp;<span class="inlinecode"><span class="id" title="var">delete</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:125"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.mut"><span class="id" title="abbreviation">cQp.mut</span></a> 1) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:120"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:109"><span class="id" title="variable">Q</span></a> (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:125"><span class="id" title="variable">obj_ptr</span></a>) (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free'':126"><span class="id" title="variable">free''</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#3661e58f765c638206576597ccc57486"><span class="id" title="notation">&gt;*&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free':116"><span class="id" title="variable">free'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#3661e58f765c638206576597ccc57486"><span class="id" title="notation">&gt;*&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:112"><span class="id" title="variable">free</span></a>)<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">)</span></a>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Enew"><span class="id" title="constructor">Enew</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:106"><span class="id" title="variable">new_fn</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_expr:107"><span class="id" title="variable">storage_expr</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:108"><span class="id" title="variable">aty</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_size:104"><span class="id" title="variable">array_size</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#oinit:105"><span class="id" title="variable">oinit</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:109"><span class="id" title="variable">Q</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> **; <span class="id" title="var">iIntros</span> "array_sz".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand_array_new"><span class="id" title="axiom">wp_operand_array_new</span></a>; <span class="id" title="tactic">eauto</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> (<a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_operand_frame"><span class="id" title="axiom">wp_operand_frame</span></a> <span class="id" title="var">_</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a>); [<span class="id" title="tactic">reflexivity</span> | .. | <span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">v</span> <span class="id" title="var">free</span>) "H"; <span class="id" title="var">iDestruct</span> "H" <span class="id" title="keyword">as</span> (<span class="id" title="var">array_sizeN</span>) "(%&amp;%&amp;args)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iExists</span> <span class="id" title="var">array_sizeN</span>; <span class="id" title="var">iFrame</span> "%".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">pre</span> <span class="id" title="var">post</span> <span class="id" title="var">q</span>) "%Hspec".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">pre</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="var">post</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hpre</span> <span class="id" title="var">Hpost</span>]. 1: {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">pre</span>; <span class="id" title="tactic">first</span> (<span class="id" title="tactic">intuition</span>; <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#app_nil_l"><span class="id" title="lemma">app_nil_l</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hspec</span>). 2: {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">exfalso</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hspec</span>; <span class="id" title="tactic">by</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#app_cons_not_nil"><span class="id" title="lemma">app_cons_not_nil</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">post</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">exfalso</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hspec</span>; <span class="id" title="tactic">by</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#app_cons_not_nil"><span class="id" title="lemma">app_cons_not_nil</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.Mbind_frame"><span class="id" title="lemma">Mbind_frame</span></a>; <span class="id" title="var">last</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "args"; <span class="id" title="tactic">by</span> <span class="id" title="var">iPureIntro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>: <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hspec</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Hspec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iIntros</span> (<span class="id" title="var">R</span> <span class="id" title="var">S</span>) "RS R"; <span class="id" title="var">iIntros</span> (<span class="id" title="var">p</span>); <span class="id" title="var">iSpecialize</span> <span class="id" title="notation">(</span>"R" <span class="id" title="notation">$!</span> <span class="id" title="var">p</span><span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iRevert</span> "R"; <span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.initializers.html#wp_initialize_frame"><span class="id" title="lemma">wp_initialize_frame</span></a> =&gt; //.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iIntros</span> (<span class="id" title="var">p</span>); <span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.Mmap_frame"><span class="id" title="lemma">Mmap_frame</span></a>; <span class="id" title="var">iIntros</span> (<span class="id" title="var">R</span> <span class="id" title="var">S</span>) "RS R"; <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "RS".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iIntros</span> (<span class="id" title="var">ps</span> <span class="id" title="var">free'</span>) "H".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "H"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> (<span class="id" title="var">alloc_sz</span> <span class="id" title="var">alloc_al</span> <span class="id" title="var">storage_ptr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"(-&gt; &amp; %Hstorage_ptr &amp; %Halloc_sz &amp; % &amp; %Halloc_al &amp; H)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iExists</span> <span class="id" title="var">alloc_sz</span>, <span class="id" title="var">alloc_al</span>; <span class="id" title="var">iFrame</span> "%".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">overhead_size</span>); <span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span>"H" <span class="id" title="notation">$!</span> <span class="id" title="var">overhead_size</span><span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "($ &amp; H)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">p</span>) "alloc_sz"; <span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span>"H" <span class="id" title="notation">$!</span> <span class="id" title="var">p</span> <span class="id" title="notation">with</span> "alloc_sz"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "spec"; <span class="id" title="var">iModIntro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_fptr_frame"><span class="id" title="lemma">wp_fptr_frame</span></a>; <span class="id" title="var">last</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "spec".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">v</span>) "[$ X]". <span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="bedrock.lang.cpp.logic.destroy.html#interp_wand"><span class="id" title="lemma">interp_wand</span></a> <span class="id" title="notation">with</span> "X"<span class="id" title="notation">)</span>. <span class="id" title="var">iIntros</span> "(? &amp; ? &amp; ? &amp; ?)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iExists</span> <span class="id" title="var">storage_ptr</span>; <span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="abbreviation">bool_decide_false</span>; <span class="id" title="var">last</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.new"><span class="id" title="section">new</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Expr__newdelete.with_cpp_logic.with_resolve.delete" class="idref" href="#Expr__newdelete.with_cpp_logic.with_resolve.delete"><span class="id" title="section">delete</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Expr__newdelete.alloc_pointer" class="idref" href="#Expr__newdelete.alloc_pointer"><span class="id" title="definition">alloc_pointer</span></a> (<a id="pv:127" class="idref" href="#pv:127"><span class="id" title="binder">pv</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a>) (<a id="Q:128" class="idref" href="#Q:128"><span class="id" title="binder">Q</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#FreeTemp"><span class="id" title="abbreviation">FreeTemp</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="bedrock.lang.base_logic.mpred.html#mpred"><span class="id" title="definition">mpred</span></a>) : <a class="idref" href="bedrock.lang.base_logic.mpred.html#mpred"><span class="id" title="definition">mpred</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a id="p:129" class="idref" href="#p:129"><span class="id" title="binder">p</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:129"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#primR"><span class="id" title="abbreviation">primR</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a>) (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.mut"><span class="id" title="abbreviation">cQp.mut</span></a> 1) (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#pv:127"><span class="id" title="variable">pv</span></a>) <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:128"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:129"><span class="id" title="variable">p</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.wp.html#FreeTemps.delete"><span class="id" title="constructor">FreeTemps.delete</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:129"><span class="id" title="variable">p</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="Expr__newdelete.alloc_pointer_frame" class="idref" href="#Expr__newdelete.alloc_pointer_frame"><span class="id" title="lemma">alloc_pointer_frame</span></a> : <span class="id" title="notation">forall</span> <a id="p:130" class="idref" href="#p:130"><span class="id" title="binder">p</span></a> <a id="Q:131" class="idref" href="#Q:131"><span class="id" title="binder">Q</span></a> <a id="Q':132" class="idref" href="#Q':132"><span class="id" title="binder">Q'</span></a><span class="id" title="notation">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a id="p:133" class="idref" href="#p:133"><span class="id" title="binder">p</span></a> <a id="fr:134" class="idref" href="#fr:134"><span class="id" title="binder">fr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:131"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:133"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#fr:134"><span class="id" title="variable">fr</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q':132"><span class="id" title="variable">Q'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:133"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#fr:134"><span class="id" title="variable">fr</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_pointer"><span class="id" title="definition">alloc_pointer</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:130"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:131"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_pointer"><span class="id" title="definition">alloc_pointer</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:130"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q':132"><span class="id" title="variable">Q'</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">rewrite</span> /<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_pointer"><span class="id" title="definition">alloc_pointer</span></a>. <span class="id" title="var">iIntros</span> "X Y".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (?) "p"; <span class="id" title="var">iApply</span> "X"; <span class="id" title="var">iApply</span> "Y"; <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">delete_val</span></span> <span class="inlinecode"><span class="id" title="var">default</span></span> <span class="inlinecode"><span class="id" title="var">ty</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>&nbsp;is&nbsp;the&nbsp;weakest&nbsp;pre-condition&nbsp;of&nbsp;deleting&nbsp;<span class="inlinecode"><span class="id" title="var">p</span></span>&nbsp;(of&nbsp;type&nbsp;<span class="inlinecode"><span class="id" title="var">ty</span></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">ty</span></span>&nbsp;has&nbsp;a&nbsp;custom&nbsp;<span class="inlinecode"><span class="id" title="var">operator</span></span> <span class="inlinecode"><span class="id" title="var">delete</span></span>,&nbsp;that&nbsp;function&nbsp;will&nbsp;be&nbsp;called,&nbsp;otherwise<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">default</span></span>&nbsp;delete&nbsp;operator&nbsp;will&nbsp;be&nbsp;used.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Expr__newdelete.delete_val" class="idref" href="#Expr__newdelete.delete_val"><span class="id" title="definition">delete_val</span></a> <a id="tu:135" class="idref" href="#tu:135"><span class="id" title="binder">tu</span></a> (<a id="default:136" class="idref" href="#default:136"><span class="id" title="binder">default</span></a> : <a class="idref" href="bedrock.lang.cpp.syntax.names.html#obj_name"><span class="id" title="definition">obj_name</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">*</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#type"><span class="id" title="inductive">type</span></a>) (<a id="ty:137" class="idref" href="#ty:137"><span class="id" title="binder">ty</span></a> : <a class="idref" href="bedrock.lang.cpp.syntax.types.html#type"><span class="id" title="inductive">type</span></a>) (<a id="p:138" class="idref" href="#p:138"><span class="id" title="binder">p</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a>) (<a id="Q:139" class="idref" href="#Q:139"><span class="id" title="binder">Q</span></a> : <a class="idref" href="bedrock.lang.base_logic.mpred.html#mpred"><span class="id" title="definition">mpred</span></a>) : <a class="idref" href="bedrock.lang.base_logic.mpred.html#mpred"><span class="id" title="definition">mpred</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="del_type:140" class="idref" href="#del_type:140"><span class="id" title="binder">del_type</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tfunction"><span class="id" title="constructor">Tfunction</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="del:147" class="idref" href="#del:147"><span class="id" title="binder">del</span></a> '<a id="pat:143" class="idref" href="#pat:143"><span class="id" title="binder">(</span></a><a id="fn:142" class="idref" href="#fn:142"><span class="id" title="binder"><span id="pat:143" class="id">fn</span></span></a><a id="pat:143" class="idref" href="#pat:143"><span class="id" title="binder">,</span></a> <a id="ty:141" class="idref" href="#ty:141"><span class="id" title="binder"><span id="pat:143" class="id">ty</span></span></a><a id="pat:143" class="idref" href="#pat:143"><span class="id" title="binder">)</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_pointer"><span class="id" title="definition">alloc_pointer</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:138"><span class="id" title="variable">p</span></a> (<span class="id" title="keyword">fun</span> <a id="p':144" class="idref" href="#p':144"><span class="id" title="binder">p'</span></a> <a id="free:145" class="idref" href="#free:145"><span class="id" title="binder">free</span></a> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_fptr"><span class="id" title="axiom">wp_fptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#tu:135"><span class="id" title="variable">tu</span></a>.(<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#types"><span class="id" title="projection">types</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:141"><span class="id" title="variable">ty</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.path_pred.html#_global"><span class="id" title="definition">_global</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#fn:142"><span class="id" title="variable">fn</span></a>) (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p':144"><span class="id" title="variable">p'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) (<span class="id" title="keyword">fun</span> <a id="p:146" class="idref" href="#p:146"><span class="id" title="binder">p</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.call.html#operand_receive"><span class="id" title="abbreviation">operand_receive</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:146"><span class="id" title="variable">p</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.destroy.html#interp"><span class="id" title="abbreviation">interp</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#tu:135"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:145"><span class="id" title="variable">free</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:139"><span class="id" title="variable">Q</span></a>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#erase_qualifiers"><span class="id" title="definition">erase_qualifiers</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:137"><span class="id" title="variable">ty</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tnamed"><span class="id" title="constructor">Tnamed</span></a> <span class="id" title="var">nm</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#tu:135"><span class="id" title="variable">tu</span></a> <span class="id" title="notation">!!</span> <span class="id" title="var">nm</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#Gstruct"><span class="id" title="constructor">Gstruct</span></a> <span class="id" title="var">s</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#del:147"><span class="id" title="variable">del</span></a> <span class="id" title="notation">$</span> <span class="id" title="definition">from_option</span> (<span class="id" title="keyword">fun</span> <a id="x:148" class="idref" href="#x:148"><span class="id" title="binder">x</span></a> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#x:148"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#del_type:140"><span class="id" title="variable">del_type</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#default:136"><span class="id" title="variable">default</span></a> <span class="id" title="var">s</span>.(<a class="idref" href="bedrock.lang.cpp.syntax.decl.html#s_delete"><span class="id" title="projection">s_delete</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#Gunion"><span class="id" title="constructor">Gunion</span></a> <span class="id" title="var">u</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#del:147"><span class="id" title="variable">del</span></a> <span class="id" title="notation">$</span> <span class="id" title="definition">from_option</span> (<span class="id" title="keyword">fun</span> <a id="x:149" class="idref" href="#x:149"><span class="id" title="binder">x</span></a> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#x:149"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#del_type:140"><span class="id" title="variable">del_type</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#default:136"><span class="id" title="variable">default</span></a> <span class="id" title="var">u</span>.(<a class="idref" href="bedrock.lang.cpp.syntax.decl.html#u_delete"><span class="id" title="projection">u_delete</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#del:147"><span class="id" title="variable">del</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#default:136"><span class="id" title="variable">default</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="Expr__newdelete.delete_val_frame" class="idref" href="#Expr__newdelete.delete_val_frame"><span class="id" title="lemma">delete_val_frame</span></a> : <span class="id" title="notation">forall</span> <a id="tu:150" class="idref" href="#tu:150"><span class="id" title="binder">tu</span></a> <a id="default:151" class="idref" href="#default:151"><span class="id" title="binder">default</span></a> <a id="ty:152" class="idref" href="#ty:152"><span class="id" title="binder">ty</span></a> <a id="p:153" class="idref" href="#p:153"><span class="id" title="binder">p</span></a> <a id="Q:154" class="idref" href="#Q:154"><span class="id" title="binder">Q</span></a> <a id="Q':155" class="idref" href="#Q':155"><span class="id" title="binder">Q'</span></a><span class="id" title="notation">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:154"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q':155"><span class="id" title="variable">Q'</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.delete_val"><span class="id" title="definition">delete_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#tu:150"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#default:151"><span class="id" title="variable">default</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:152"><span class="id" title="variable">ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:153"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:154"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.delete_val"><span class="id" title="definition">delete_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#tu:150"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#default:151"><span class="id" title="variable">default</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:152"><span class="id" title="variable">ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:153"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q':155"><span class="id" title="variable">Q'</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.delete_val"><span class="id" title="definition">delete_val</span></a>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "X"; <span class="id" title="tactic">repeat</span> <span class="id" title="var">case_match</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_pointer_frame"><span class="id" title="lemma">alloc_pointer_frame</span></a>; <span class="id" title="var">iIntros</span> (??);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_fptr_frame"><span class="id" title="lemma">wp_fptr_frame</span></a>; <span class="id" title="var">iIntros</span> (?); <span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.call.html#operand_receive_frame"><span class="id" title="lemma">operand_receive_frame</span></a>; <span class="id" title="var">iIntros</span> (?); <span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.destroy.html#interp_frame"><span class="id" title="lemma">interp_frame</span></a>; <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.resolve_dtor"><span class="id" title="definition">resolve_dtor</span></a></span> <span class="inlinecode"><span class="id" title="var">ty</span></span> <span class="inlinecode"><a class="idref" href="bedrock.noimport.doc.cpp.logic.html#with_Sigma.this"><span class="id" title="variable">this</span></a></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> resolves the destructor for the object <span class="inlinecode"><a class="idref" href="bedrock.noimport.doc.cpp.logic.html#with_Sigma.this"><span class="id" title="variable">this</span></a></span> (of type <span class="inlinecode"><span class="id" title="var">ty</span></span>).
            The continuation <span class="inlinecode"><span class="id" title="var">Q</span></span> is passed the pointer to the most-derived-object of <span class="inlinecode"><a class="idref" href="bedrock.noimport.doc.cpp.logic.html#with_Sigma.this"><span class="id" title="variable">this</span></a></span> and its type.
         
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Expr__newdelete.resolve_dtor" class="idref" href="#Expr__newdelete.resolve_dtor"><span class="id" title="definition">resolve_dtor</span></a> (<a id="ty:156" class="idref" href="#ty:156"><span class="id" title="binder">ty</span></a> : <a class="idref" href="bedrock.lang.cpp.syntax.types.html#type"><span class="id" title="inductive">type</span></a>) (<a id="this:157" class="idref" href="#this:157"><span class="id" title="binder">this</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a>) (<a id="Q:158" class="idref" href="#Q:158"><span class="id" title="binder">Q</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#type"><span class="id" title="inductive">type</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="bedrock.lang.base_logic.mpred.html#mpred"><span class="id" title="definition">mpred</span></a>) : <a class="idref" href="bedrock.lang.base_logic.mpred.html#mpred"><span class="id" title="definition">mpred</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#drop_qualifiers"><span class="id" title="definition">drop_qualifiers</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:156"><span class="id" title="variable">ty</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tqualified"><span class="id" title="constructor">Tqualified</span></a> <span class="id" title="var">_</span> <span class="id" title="var">ty</span> =&gt; <span class="id" title="notation">False</span> <span class="comment">(*&nbsp;unreachable&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tnamed"><span class="id" title="constructor">Tnamed</span></a> <span class="id" title="var">cls</span>      =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <span class="id" title="notation">!!</span> <span class="id" title="var">cls</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#Gstruct"><span class="id" title="constructor">Gstruct</span></a> <span class="id" title="var">s</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.decl.html#has_virtual_dtor"><span class="id" title="definition">has_virtual_dtor</span></a> <span class="id" title="var">s</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;NOTE&nbsp;<span class="inlinecode"><span class="id" title="var">has_virtual_dtor</span></span>&nbsp;could&nbsp;be&nbsp;derived&nbsp;from&nbsp;the&nbsp;vtable...&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;this&nbsp;case,&nbsp;use&nbsp;virtual&nbsp;dispatch&nbsp;to&nbsp;invoke&nbsp;the&nbsp;destructor.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.dispatch.html#resolve_virtual"><span class="id" title="definition">resolve_virtual</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this:157"><span class="id" title="variable">this</span></a> <span class="id" title="var">cls</span> <span class="id" title="var">s</span>.(<a class="idref" href="bedrock.lang.cpp.syntax.decl.html#s_dtor"><span class="id" title="projection">s_dtor</span></a>) (<span class="id" title="keyword">fun</span> <a id="fimpl:159" class="idref" href="#fimpl:159"><span class="id" title="binder">fimpl</span></a> <a id="impl_class:160" class="idref" href="#impl_class:160"><span class="id" title="binder">impl_class</span></a> <a id="this':161" class="idref" href="#this':161"><span class="id" title="binder">this'</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="r_ty:162" class="idref" href="#r_ty:162"><span class="id" title="binder">r_ty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tnamed"><span class="id" title="constructor">Tnamed</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#impl_class:160"><span class="id" title="variable">impl_class</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:158"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this':161"><span class="id" title="variable">this'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#r_ty:162"><span class="id" title="variable">r_ty</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:158"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this:157"><span class="id" title="variable">this</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.types.html#erase_qualifiers"><span class="id" title="definition">erase_qualifiers</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:156"><span class="id" title="variable">ty</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#Gunion"><span class="id" title="constructor">Gunion</span></a> <span class="id" title="var">u</span>)  =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Unions&nbsp;cannot&nbsp;have&nbsp;<span class="inlinecode"><span class="id" title="var">virtual</span></span>&nbsp;destructors:&nbsp;we&nbsp;directly&nbsp;invoke&nbsp;the&nbsp;destructor.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:158"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this:157"><span class="id" title="variable">this</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.types.html#erase_qualifiers"><span class="id" title="definition">erase_qualifiers</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:156"><span class="id" title="variable">ty</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>                =&gt; <span class="id" title="notation">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tarray"><span class="id" title="constructor">Tarray</span></a> <span class="id" title="var">ety</span> <span class="id" title="var">sz</span>   =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">False</span> <span class="comment">(*&nbsp;arrays&nbsp;can&nbsp;not&nbsp;be&nbsp;deleted&nbsp;with&nbsp;direct&nbsp;delete&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tref"><span class="id" title="constructor">Tref</span></a> <span class="id" title="var">r_ty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Trv_ref"><span class="id" title="constructor">Trv_ref</span></a> <span class="id" title="var">r_ty</span>    =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">False</span> <span class="comment">(*&nbsp;references&nbsp;can&nbsp;not&nbsp;be&nbsp;deleted,&nbsp;only&nbsp;destroyed&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">ty</span>              =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:158"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this:157"><span class="id" title="variable">this</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.types.html#erase_qualifiers"><span class="id" title="definition">erase_qualifiers</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:156"><span class="id" title="variable">ty</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>%<span class="id" title="var">I</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="Expr__newdelete.resolve_dtor_frame" class="idref" href="#Expr__newdelete.resolve_dtor_frame"><span class="id" title="lemma">resolve_dtor_frame</span></a> : <span class="id" title="notation">forall</span> <a id="ty:163" class="idref" href="#ty:163"><span class="id" title="binder">ty</span></a> <a id="p:164" class="idref" href="#p:164"><span class="id" title="binder">p</span></a> <a id="Q:165" class="idref" href="#Q:165"><span class="id" title="binder">Q</span></a> <a id="Q':166" class="idref" href="#Q':166"><span class="id" title="binder">Q'</span></a><span class="id" title="notation">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a id="p:167" class="idref" href="#p:167"><span class="id" title="binder">p</span></a> <a id="t:168" class="idref" href="#t:168"><span class="id" title="binder">t</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:165"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:167"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#t:168"><span class="id" title="variable">t</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q':166"><span class="id" title="variable">Q'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:167"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#t:168"><span class="id" title="variable">t</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.resolve_dtor"><span class="id" title="definition">resolve_dtor</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:163"><span class="id" title="variable">ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:164"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:165"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.resolve_dtor"><span class="id" title="definition">resolve_dtor</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:163"><span class="id" title="variable">ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:164"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q':166"><span class="id" title="variable">Q'</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.resolve_dtor"><span class="id" title="definition">resolve_dtor</span></a>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "X"; <span class="id" title="tactic">repeat</span> <span class="id" title="var">case_match</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [ <span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_fptr_frame"><span class="id" title="lemma">wp_fptr_frame</span></a>; <span class="id" title="var">iIntros</span> (?); <span class="id" title="tactic">eauto</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.dispatch.html#resolve_virtual_frame"><span class="id" title="lemma">resolve_virtual_frame</span></a>. <span class="id" title="var">iIntros</span> (???); <span class="id" title="var">iApply</span> "X".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Expr__newdelete.cv_compat" class="idref" href="#Expr__newdelete.cv_compat"><span class="id" title="definition">cv_compat</span></a> (<a id="t1:169" class="idref" href="#t1:169"><span class="id" title="binder">t1</span></a> <a id="t2:170" class="idref" href="#t2:170"><span class="id" title="binder">t2</span></a> : <a class="idref" href="bedrock.lang.cpp.syntax.types.html#type"><span class="id" title="inductive">type</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.syntax.types.html#erase_qualifiers"><span class="id" title="definition">erase_qualifiers</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#t1:169"><span class="id" title="variable">t1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#erase_qualifiers"><span class="id" title="definition">erase_qualifiers</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#t2:170"><span class="id" title="variable">t2</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;delete<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://eel.is/c++draft/expr.delete<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOTE:&nbsp;https://eel.is/c++draft/expr.delete7.1 says:
           > The value returned from the allocation call of the new-expression
           > shall be passed as the first argument to the deallocation function.

           Hence, the destructor is passed a pointer to the object, and the
           deallocation function [delete] is passed a pointer to the
           underlying storage (of type [void *]).

           On deleting null:
           From the C++ standard (https://en.cppreference.com/w/cpp/language/delete)

           > If expression evaluates to a null pointer value, no destructors are
           > called, and the deallocation function may or may not be called (it's
           > unspecified), but the default deallocation functions are guaranteed
           > to do nothing when passed a null pointer.

           NOTE: [Edelete]'s first argument is [true] iff the expression corresponds to
           an array-delete ([delete[]]).
         *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Expr__newdelete.wp_operand_delete" class="idref" href="#Expr__newdelete.wp_operand_delete"><span class="id" title="axiom">wp_operand_delete</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">forall</span> <a id="delete_fn:171" class="idref" href="#delete_fn:171"><span class="id" title="binder">delete_fn</span></a> <a id="e:172" class="idref" href="#e:172"><span class="id" title="binder">e</span></a> <a id="destroyed_type:173" class="idref" href="#destroyed_type:173"><span class="id" title="binder">destroyed_type</span></a> <a id="Q:174" class="idref" href="#Q:174"><span class="id" title="binder">Q</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="dfty:175" class="idref" href="#dfty:175"><span class="id" title="binder">dfty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#normalize_type"><span class="id" title="definition">normalize_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:171"><span class="id" title="variable">delete_fn</span></a><span class="id" title="notation">.2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">_</span> : <a class="idref" href="bedrock.lang.cpp.logic.call.html#arg_types"><span class="id" title="definition">arg_types</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#dfty:175"><span class="id" title="variable">dfty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">),</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;call&nbsp;the&nbsp;destructor&nbsp;on&nbsp;the&nbsp;object,&nbsp;and&nbsp;then&nbsp;call&nbsp;delete_fn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#e:172"><span class="id" title="variable">e</span></a> (<span class="id" title="keyword">fun</span> <a id="v:176" class="idref" href="#v:176"><span class="id" title="binder">v</span></a> <a id="free:177" class="idref" href="#free:177"><span class="id" title="binder">free</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="obj_ptr:178" class="idref" href="#obj_ptr:178"><span class="id" title="binder">obj_ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#v:176"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:178"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <span class="id" title="definition">bool_decide</span> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:178"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.nullptr"><span class="id" title="axiom">nullptr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;conjunction&nbsp;justifies&nbsp;the&nbsp;compiler&nbsp;calling&nbsp;the&nbsp;delete&nbsp;function<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;not&nbsp;calling&nbsp;it.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.delete_val"><span class="id" title="definition">delete_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:171"><span class="id" title="variable">delete_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#destroyed_type:173"><span class="id" title="variable">destroyed_type</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.nullptr"><span class="id" title="axiom">nullptr</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:174"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vvoid"><span class="id" title="definition">Vvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:177"><span class="id" title="variable">free</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∧</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:174"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vvoid"><span class="id" title="definition">Vvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:177"><span class="id" title="variable">free</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;v----&nbsp;Calling&nbsp;destructor&nbsp;with&nbsp;object&nbsp;pointer&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.resolve_dtor"><span class="id" title="definition">resolve_dtor</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#destroyed_type:173"><span class="id" title="variable">destroyed_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:178"><span class="id" title="variable">obj_ptr</span></a> (<span class="id" title="keyword">fun</span> <a id="this':179" class="idref" href="#this':179"><span class="id" title="binder">this'</span></a> <a id="mdc_ty:180" class="idref" href="#mdc_ty:180"><span class="id" title="binder">mdc_ty</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="cv_mdc:181" class="idref" href="#cv_mdc:181"><span class="id" title="binder">cv_mdc</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this':179"><span class="id" title="variable">this'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.mut"><span class="id" title="abbreviation">cQp.mut</span></a> 1) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#cv_mdc:181"><span class="id" title="variable">cv_mdc</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.cv_compat"><span class="id" title="definition">cv_compat</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#cv_mdc:181"><span class="id" title="variable">cv_mdc</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#mdc_ty:180"><span class="id" title="variable">mdc_ty</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;v----&nbsp;because&nbsp;dispatch&nbsp;could&nbsp;be&nbsp;virtual,&nbsp;the&nbsp;translation&nbsp;unit<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;used&nbsp;to&nbsp;destroy&nbsp;the&nbsp;object&nbsp;may&nbsp;need&nbsp;to&nbsp;be&nbsp;different&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="tu':182" class="idref" href="#tu':182"><span class="id" title="binder">tu'</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.translation_unit.html#denoteModule"><span class="id" title="definition">denoteModule</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#tu':182"><span class="id" title="variable">tu'</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.cpp.logic.destroy.html#destroy_val"><span class="id" title="abbreviation">destroy_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#tu':182"><span class="id" title="variable">tu'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#mdc_ty:180"><span class="id" title="variable">mdc_ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this':179"><span class="id" title="variable">this'</span></a> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="storage_ptr:183" class="idref" href="#storage_ptr:183"><span class="id" title="binder">storage_ptr</span></a> <a id="sz:184" class="idref" href="#sz:184"><span class="id" title="binder">sz</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.size_of"><span class="id" title="abbreviation">size_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#mdc_ty:180"><span class="id" title="variable">mdc_ty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:184"><span class="id" title="variable">sz</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;v----&nbsp;Token&nbsp;for&nbsp;converting&nbsp;obj&nbsp;memory&nbsp;to&nbsp;storage&nbsp;memory&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.pred.html#L.provides_storage"><span class="id" title="axiom">provides_storage</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:183"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this':179"><span class="id" title="variable">this'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#mdc_ty:180"><span class="id" title="variable">mdc_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Transfer&nbsp;memory&nbsp;to&nbsp;underlying&nbsp;storage&nbsp;pointer;&nbsp;unlike&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">end_provides_storage</span></span>,&nbsp;this&nbsp;memory&nbsp;was&nbsp;pre-destructed&nbsp;by<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">destroy_val</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:183"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.block.html#blockR"><span class="id" title="definition">blockR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:184"><span class="id" title="variable">sz</span></a> (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.m"><span class="id" title="abbreviation">cQp.m</span></a> 1) <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;v----&nbsp;Calling&nbsp;deallocator&nbsp;with&nbsp;storage&nbsp;pointer<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Like&nbsp;above,&nbsp;because&nbsp;the&nbsp;operation&nbsp;is&nbsp;on&nbsp;the&nbsp;MDC,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;must&nbsp;use&nbsp;<span class="inlinecode"><span class="id" title="var">tu'</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.delete_val"><span class="id" title="definition">delete_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#tu':182"><span class="id" title="variable">tu'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:171"><span class="id" title="variable">delete_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#mdc_ty:180"><span class="id" title="variable">mdc_ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:183"><span class="id" title="variable">storage_ptr</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:174"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vvoid"><span class="id" title="definition">Vvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:177"><span class="id" title="variable">free</span></a>)<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">)</span></a>)))<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Edelete"><span class="id" title="constructor">Edelete</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:171"><span class="id" title="variable">delete_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#e:172"><span class="id" title="variable">e</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#destroyed_type:173"><span class="id" title="variable">destroyed_type</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:174"><span class="id" title="variable">Q</span></a>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand_delete_default"><span class="id" title="lemma">wp_operand_delete_default</span></a></span> specializes <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand_delete"><span class="id" title="axiom">wp_operand_delete</span></a></span> for invocations of
<a id="lab257"></a><h1 class="section">the form <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.delete"><span class="id" title="section">delete</span></a></span> <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.pred_paradoxes.html#with_cpp.type_ptr_object_representation_full_is_unsound.p"><span class="id" title="variable">p</span></a>;</span> - where <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.pred_paradoxes.html#with_cpp.type_ptr_object_representation_full_is_unsound.p"><span class="id" title="variable">p</span></a></span> is a non-null pointer to an object whose</h1>

<a id="lab258"></a><h1 class="section">most-derived destructor is defined in the current translation unit.</h1>

         
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="Expr__newdelete.wp_operand_delete_default" class="idref" href="#Expr__newdelete.wp_operand_delete_default"><span class="id" title="lemma">wp_operand_delete_default</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">forall</span> <a id="delete_fn:186" class="idref" href="#delete_fn:186"><span class="id" title="binder">delete_fn</span></a> <a id="e:187" class="idref" href="#e:187"><span class="id" title="binder">e</span></a> <a id="destroyed_type:188" class="idref" href="#destroyed_type:188"><span class="id" title="binder">destroyed_type</span></a> <a id="Q:189" class="idref" href="#Q:189"><span class="id" title="binder">Q</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="dfty:190" class="idref" href="#dfty:190"><span class="id" title="binder">dfty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#normalize_type"><span class="id" title="definition">normalize_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:186"><span class="id" title="variable">delete_fn</span></a><span class="id" title="notation">.2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">_</span> : <a class="idref" href="bedrock.lang.cpp.logic.call.html#arg_types"><span class="id" title="definition">arg_types</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#dfty:190"><span class="id" title="variable">dfty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">),</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;call&nbsp;the&nbsp;destructor&nbsp;on&nbsp;the&nbsp;object,&nbsp;and&nbsp;then&nbsp;call&nbsp;delete_fn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#e:187"><span class="id" title="variable">e</span></a> (<span class="id" title="keyword">fun</span> <a id="v:191" class="idref" href="#v:191"><span class="id" title="binder">v</span></a> <a id="free:192" class="idref" href="#free:192"><span class="id" title="binder">free</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="obj_ptr:193" class="idref" href="#obj_ptr:193"><span class="id" title="binder">obj_ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#v:191"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:193"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:193"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.nullptr"><span class="id" title="axiom">nullptr</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;v----&nbsp;Calling&nbsp;destructor&nbsp;with&nbsp;object&nbsp;pointer&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.resolve_dtor"><span class="id" title="definition">resolve_dtor</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#destroyed_type:188"><span class="id" title="variable">destroyed_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:193"><span class="id" title="variable">obj_ptr</span></a> (<span class="id" title="keyword">fun</span> <a id="this':194" class="idref" href="#this':194"><span class="id" title="binder">this'</span></a> <a id="mdc_ty:195" class="idref" href="#mdc_ty:195"><span class="id" title="binder">mdc_ty</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="cv_mdc:196" class="idref" href="#cv_mdc:196"><span class="id" title="binder">cv_mdc</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this':194"><span class="id" title="variable">this'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.mut"><span class="id" title="abbreviation">cQp.mut</span></a> 1) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#cv_mdc:196"><span class="id" title="variable">cv_mdc</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.cv_compat"><span class="id" title="definition">cv_compat</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#cv_mdc:196"><span class="id" title="variable">cv_mdc</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#mdc_ty:195"><span class="id" title="variable">mdc_ty</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.translation_unit.html#denoteModule"><span class="id" title="definition">denoteModule</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.cpp.logic.destroy.html#destroy_val"><span class="id" title="abbreviation">destroy_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#mdc_ty:195"><span class="id" title="variable">mdc_ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this':194"><span class="id" title="variable">this'</span></a> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="storage_ptr:197" class="idref" href="#storage_ptr:197"><span class="id" title="binder">storage_ptr</span></a> <a id="sz:198" class="idref" href="#sz:198"><span class="id" title="binder">sz</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.size_of"><span class="id" title="abbreviation">size_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#mdc_ty:195"><span class="id" title="variable">mdc_ty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:198"><span class="id" title="variable">sz</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;v----&nbsp;Token&nbsp;for&nbsp;converting&nbsp;obj&nbsp;memory&nbsp;to&nbsp;storage&nbsp;memory&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.pred.html#L.provides_storage"><span class="id" title="axiom">provides_storage</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:197"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this':194"><span class="id" title="variable">this'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#mdc_ty:195"><span class="id" title="variable">mdc_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Transfer&nbsp;memory&nbsp;to&nbsp;underlying&nbsp;storage&nbsp;pointer;&nbsp;unlike&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">end_provides_storage</span></span>,&nbsp;this&nbsp;memory&nbsp;was&nbsp;pre-destructed&nbsp;by<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">destroy_val</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:197"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.block.html#blockR"><span class="id" title="definition">blockR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:198"><span class="id" title="variable">sz</span></a> (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.m"><span class="id" title="abbreviation">cQp.m</span></a> 1) <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;v----&nbsp;Calling&nbsp;deallocator&nbsp;with&nbsp;storage&nbsp;pointer&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.delete_val"><span class="id" title="definition">delete_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:186"><span class="id" title="variable">delete_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#mdc_ty:195"><span class="id" title="variable">mdc_ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:197"><span class="id" title="variable">storage_ptr</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:189"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vvoid"><span class="id" title="definition">Vvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:192"><span class="id" title="variable">free</span></a>)<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">)</span></a>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Edelete"><span class="id" title="constructor">Edelete</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:186"><span class="id" title="variable">delete_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#e:187"><span class="id" title="variable">e</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#destroyed_type:188"><span class="id" title="variable">destroyed_type</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:189"><span class="id" title="variable">Q</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> **; <span class="id" title="var">iIntros</span> "operand".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand_delete"><span class="id" title="axiom">wp_operand_delete</span></a>; <span class="id" title="tactic">eauto</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> (<a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_operand_frame"><span class="id" title="axiom">wp_operand_frame</span></a> <span class="id" title="var">_</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a>); [<span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span> | | <span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">v</span> <span class="id" title="var">free</span>) "H"; <span class="id" title="var">iDestruct</span> "H" <span class="id" title="keyword">as</span> (<span class="id" title="var">obj_ptr</span>) "(-&gt; &amp; % &amp; dtor_lookup)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iExists</span> <span class="id" title="var">obj_ptr</span>; <span class="id" title="var">iSplitR</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="abbreviation">bool_decide_false</span>; <span class="id" title="var">last</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.resolve_dtor_frame"><span class="id" title="lemma">resolve_dtor_frame</span></a>; <span class="id" title="var">last</span> <span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">p</span> <span class="id" title="var">mdc_ty</span>) "H"; <span class="id" title="var">iDestruct</span> "H" <span class="id" title="keyword">as</span> (<span class="id" title="var">cv_mdc</span>) "(? &amp; % &amp; ? &amp; destroy_val)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iExists</span> <span class="id" title="var">cv_mdc</span>; <span class="id" title="var">iFrame</span> "%∗".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="var">iExists</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a>; <span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;NOTE:&nbsp;<span class="inlinecode"><span class="id" title="var">destroyed_type</span></span>&nbsp;will&nbsp;refer&nbsp;to&nbsp;the&nbsp;/element/&nbsp;of&nbsp;the&nbsp;array&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Expr__newdelete.wp_operand_array_delete" class="idref" href="#Expr__newdelete.wp_operand_array_delete"><span class="id" title="axiom">wp_operand_array_delete</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">forall</span> <a id="delete_fn:199" class="idref" href="#delete_fn:199"><span class="id" title="binder">delete_fn</span></a> <a id="e:200" class="idref" href="#e:200"><span class="id" title="binder">e</span></a> <a id="destroyed_type:201" class="idref" href="#destroyed_type:201"><span class="id" title="binder">destroyed_type</span></a> <a id="Q:202" class="idref" href="#Q:202"><span class="id" title="binder">Q</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="dfty:203" class="idref" href="#dfty:203"><span class="id" title="binder">dfty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#normalize_type"><span class="id" title="definition">normalize_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:199"><span class="id" title="variable">delete_fn</span></a><span class="id" title="notation">.2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">_</span> : <a class="idref" href="bedrock.lang.cpp.logic.call.html#arg_types"><span class="id" title="definition">arg_types</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#dfty:203"><span class="id" title="variable">dfty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">),</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;call&nbsp;the&nbsp;destructor&nbsp;on&nbsp;the&nbsp;object,&nbsp;and&nbsp;then&nbsp;call&nbsp;delete_fn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#e:200"><span class="id" title="variable">e</span></a> (<span class="id" title="keyword">fun</span> <a id="v:204" class="idref" href="#v:204"><span class="id" title="binder">v</span></a> <a id="free:205" class="idref" href="#free:205"><span class="id" title="binder">free</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="obj_ptr:206" class="idref" href="#obj_ptr:206"><span class="id" title="binder">obj_ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#v:204"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:206"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <span class="id" title="definition">bool_decide</span> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:206"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.nullptr"><span class="id" title="axiom">nullptr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;conjunction&nbsp;justifies&nbsp;the&nbsp;compiler&nbsp;calling&nbsp;the&nbsp;delete&nbsp;function<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;not&nbsp;calling&nbsp;it.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.delete_val"><span class="id" title="definition">delete_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:199"><span class="id" title="variable">delete_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#destroyed_type:201"><span class="id" title="variable">destroyed_type</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.nullptr"><span class="id" title="axiom">nullptr</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:202"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vvoid"><span class="id" title="definition">Vvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:205"><span class="id" title="variable">free</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∧</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:202"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vvoid"><span class="id" title="definition">Vvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:205"><span class="id" title="variable">free</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">(</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="array_size:207" class="idref" href="#array_size:207"><span class="id" title="binder">array_size</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="array_ty:208" class="idref" href="#array_ty:208"><span class="id" title="binder">array_ty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tarray"><span class="id" title="constructor">Tarray</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#destroyed_type:201"><span class="id" title="variable">destroyed_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_size:207"><span class="id" title="variable">array_size</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;/----&nbsp;Token&nbsp;for&nbsp;distinguishing&nbsp;between&nbsp;array&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;non-array&nbsp;allocations&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:206"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.mut"><span class="id" title="abbreviation">cQp.mut</span></a> 1) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:208"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;/----&nbsp;Calling&nbsp;destructor&nbsp;with&nbsp;object&nbsp;pointer<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Note:&nbsp;virtual&nbsp;dispatch&nbsp;is&nbsp;not&nbsp;allowed&nbsp;for&nbsp;<span class="inlinecode"><span class="id" title="var">delete</span>[]</span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.destroy.html#destroy_val"><span class="id" title="abbreviation">destroy_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:208"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:206"><span class="id" title="variable">obj_ptr</span></a> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="storage_ptr:209" class="idref" href="#storage_ptr:209"><span class="id" title="binder">storage_ptr</span></a> (<a id="sz:210" class="idref" href="#sz:210"><span class="id" title="binder">sz</span></a> <a id="sz':211" class="idref" href="#sz':211"><span class="id" title="binder">sz'</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.size_of"><span class="id" title="abbreviation">size_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:208"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:210"><span class="id" title="variable">sz</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;v----&nbsp;Token&nbsp;for&nbsp;converting&nbsp;obj&nbsp;memory&nbsp;to&nbsp;storage&nbsp;memory&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.pred.html#L.provides_storage"><span class="id" title="axiom">provides_storage</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:209"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">.[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tu8"><span class="id" title="abbreviation">Tu8</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">!</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz':211"><span class="id" title="variable">sz'</span></a><a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">]</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:206"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:208"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Transfer&nbsp;memory&nbsp;to&nbsp;underlying&nbsp;storage&nbsp;pointer;&nbsp;unlike&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">end_provides_storage</span></span>,&nbsp;this&nbsp;memory&nbsp;was&nbsp;pre-destructed&nbsp;by<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">destroy_val</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:209"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.block.html#blockR"><span class="id" title="definition">blockR</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz':211"><span class="id" title="variable">sz'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:210"><span class="id" title="variable">sz</span></a>) (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.m"><span class="id" title="abbreviation">cQp.m</span></a> 1) <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;v----&nbsp;Calling&nbsp;deallocator&nbsp;with&nbsp;storage&nbsp;pointer.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Note:&nbsp;we&nbsp;rely&nbsp;on&nbsp;the&nbsp;AST&nbsp;to&nbsp;have&nbsp;correctly&nbsp;resolved&nbsp;this&nbsp;since&nbsp;the&nbsp;dispatch&nbsp;is&nbsp;statically&nbsp;known.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.prelude.base.html#Reduce"><span class="id" title="abbreviation">Reduce</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_pointer"><span class="id" title="definition">alloc_pointer</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:209"><span class="id" title="variable">storage_ptr</span></a> (<span class="id" title="keyword">fun</span> <a id="p:212" class="idref" href="#p:212"><span class="id" title="binder">p</span></a> <a id="FR:213" class="idref" href="#FR:213"><span class="id" title="binder">FR</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_fptr"><span class="id" title="axiom">wp_fptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a>.(<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#types"><span class="id" title="projection">types</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:199"><span class="id" title="variable">delete_fn</span></a><span class="id" title="notation">.2</span> (<a class="idref" href="bedrock.lang.cpp.logic.path_pred.html#_global"><span class="id" title="definition">_global</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:199"><span class="id" title="variable">delete_fn</span></a><span class="id" title="notation">.1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:212"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) (<span class="id" title="keyword">fun</span> <a id="p:214" class="idref" href="#p:214"><span class="id" title="binder">p</span></a> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.destroy.html#interp"><span class="id" title="abbreviation">interp</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#FR:213"><span class="id" title="variable">FR</span></a> <span class="id" title="notation">$</span> <a class="idref" href="bedrock.lang.cpp.logic.call.html#operand_receive"><span class="id" title="abbreviation">operand_receive</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:214"><span class="id" title="variable">p</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:202"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vvoid"><span class="id" title="definition">Vvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:205"><span class="id" title="variable">free</span></a>))))<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">)</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">)</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Edelete"><span class="id" title="constructor">Edelete</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:199"><span class="id" title="variable">delete_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#e:200"><span class="id" title="variable">e</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#destroyed_type:201"><span class="id" title="variable">destroyed_type</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:202"><span class="id" title="variable">Q</span></a>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand_array_delete_default"><span class="id" title="lemma">wp_operand_array_delete_default</span></a></span> specializes <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand_delete"><span class="id" title="axiom">wp_operand_delete</span></a></span> for invocations
<a id="lab259"></a><h1 class="section">of the form <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.delete"><span class="id" title="section">delete</span></a>[]</span> <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.pred_paradoxes.html#with_cpp.type_ptr_object_representation_full_is_unsound.p"><span class="id" title="variable">p</span></a>;</span> - where <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.pred_paradoxes.html#with_cpp.type_ptr_object_representation_full_is_unsound.p"><span class="id" title="variable">p</span></a></span> is a non-null pointer to an array of objects</h1>

<a id="lab260"></a><h1 class="section">whose most-derived destructor is defined in the current translation unit.</h1>

         
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="Expr__newdelete.wp_operand_array_delete_default" class="idref" href="#Expr__newdelete.wp_operand_array_delete_default"><span class="id" title="lemma">wp_operand_array_delete_default</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">forall</span> <a id="delete_fn:216" class="idref" href="#delete_fn:216"><span class="id" title="binder">delete_fn</span></a> <a id="e:217" class="idref" href="#e:217"><span class="id" title="binder">e</span></a> <a id="destroyed_type:218" class="idref" href="#destroyed_type:218"><span class="id" title="binder">destroyed_type</span></a> <a id="Q:219" class="idref" href="#Q:219"><span class="id" title="binder">Q</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="dfty:220" class="idref" href="#dfty:220"><span class="id" title="binder">dfty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#normalize_type"><span class="id" title="definition">normalize_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:216"><span class="id" title="variable">delete_fn</span></a><span class="id" title="notation">.2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">_</span> : <a class="idref" href="bedrock.lang.cpp.logic.call.html#arg_types"><span class="id" title="definition">arg_types</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#dfty:220"><span class="id" title="variable">dfty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><span class="id" title="notation">),</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;call&nbsp;the&nbsp;destructor&nbsp;on&nbsp;the&nbsp;object,&nbsp;and&nbsp;then&nbsp;call&nbsp;delete_fn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#e:217"><span class="id" title="variable">e</span></a> (<span class="id" title="keyword">fun</span> <a id="v:221" class="idref" href="#v:221"><span class="id" title="binder">v</span></a> <a id="free:222" class="idref" href="#free:222"><span class="id" title="binder">free</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="obj_ptr:223" class="idref" href="#obj_ptr:223"><span class="id" title="binder">obj_ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#v:221"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:223"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:223"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.nullptr"><span class="id" title="axiom">nullptr</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="array_size:224" class="idref" href="#array_size:224"><span class="id" title="binder">array_size</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="array_ty:225" class="idref" href="#array_ty:225"><span class="id" title="binder">array_ty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tarray"><span class="id" title="constructor">Tarray</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#destroyed_type:218"><span class="id" title="variable">destroyed_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_size:224"><span class="id" title="variable">array_size</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;/----&nbsp;Token&nbsp;for&nbsp;distinguishing&nbsp;between&nbsp;array&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;non-array&nbsp;allocations&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:223"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.mut"><span class="id" title="abbreviation">cQp.mut</span></a> 1) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:225"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;/----&nbsp;Calling&nbsp;destructor&nbsp;with&nbsp;object&nbsp;pointer<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Note:&nbsp;virtual&nbsp;dispatch&nbsp;is&nbsp;not&nbsp;allowed&nbsp;for&nbsp;<span class="inlinecode"><span class="id" title="var">delete</span>[]</span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.destroy.html#destroy_val"><span class="id" title="abbreviation">destroy_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:225"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:223"><span class="id" title="variable">obj_ptr</span></a> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="storage_ptr:226" class="idref" href="#storage_ptr:226"><span class="id" title="binder">storage_ptr</span></a> (<a id="sz:227" class="idref" href="#sz:227"><span class="id" title="binder">sz</span></a> <a id="sz':228" class="idref" href="#sz':228"><span class="id" title="binder">sz'</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.size_of"><span class="id" title="abbreviation">size_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:225"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:227"><span class="id" title="variable">sz</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;v----&nbsp;Token&nbsp;for&nbsp;converting&nbsp;obj&nbsp;memory&nbsp;to&nbsp;storage&nbsp;memory&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.pred.html#L.provides_storage"><span class="id" title="axiom">provides_storage</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:226"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">.[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tu8"><span class="id" title="abbreviation">Tu8</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">!</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz':228"><span class="id" title="variable">sz'</span></a><a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">]</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:223"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:225"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Transfer&nbsp;memory&nbsp;to&nbsp;underlying&nbsp;storage&nbsp;pointer;&nbsp;unlike&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">end_provides_storage</span></span>,&nbsp;this&nbsp;memory&nbsp;was&nbsp;pre-destructed&nbsp;by<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">destroy_val</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:226"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.block.html#blockR"><span class="id" title="definition">blockR</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz':228"><span class="id" title="variable">sz'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:227"><span class="id" title="variable">sz</span></a>) (<a class="idref" href="bedrock.lang.cpp.algebra.cfrac.html#cQp.m"><span class="id" title="abbreviation">cQp.m</span></a> 1) <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;/----&nbsp;Calling&nbsp;deallocator&nbsp;with&nbsp;storage&nbsp;pointer.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;Note:&nbsp;we&nbsp;rely&nbsp;on&nbsp;the&nbsp;AST&nbsp;to&nbsp;have&nbsp;correctly&nbsp;resolved<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;&nbsp;this&nbsp;since&nbsp;the&nbsp;dispatch&nbsp;is&nbsp;statically&nbsp;known.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.prelude.base.html#Reduce"><span class="id" title="abbreviation">Reduce</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_pointer"><span class="id" title="definition">alloc_pointer</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:226"><span class="id" title="variable">storage_ptr</span></a> (<span class="id" title="keyword">fun</span> <a id="p:229" class="idref" href="#p:229"><span class="id" title="binder">p</span></a> <a id="FR:230" class="idref" href="#FR:230"><span class="id" title="binder">FR</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_fptr"><span class="id" title="axiom">wp_fptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a>.(<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#types"><span class="id" title="projection">types</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:216"><span class="id" title="variable">delete_fn</span></a><span class="id" title="notation">.2</span> (<a class="idref" href="bedrock.lang.cpp.logic.path_pred.html#_global"><span class="id" title="definition">_global</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:216"><span class="id" title="variable">delete_fn</span></a><span class="id" title="notation">.1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:229"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) (<span class="id" title="keyword">fun</span> <a id="p:231" class="idref" href="#p:231"><span class="id" title="binder">p</span></a> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.destroy.html#interp"><span class="id" title="abbreviation">interp</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#FR:230"><span class="id" title="variable">FR</span></a> <span class="id" title="notation">$</span> <a class="idref" href="bedrock.lang.cpp.logic.call.html#operand_receive"><span class="id" title="abbreviation">operand_receive</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:231"><span class="id" title="variable">p</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:219"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vvoid"><span class="id" title="definition">Vvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:222"><span class="id" title="variable">free</span></a>))))<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">)</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Edelete"><span class="id" title="constructor">Edelete</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:216"><span class="id" title="variable">delete_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#e:217"><span class="id" title="variable">e</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#destroyed_type:218"><span class="id" title="variable">destroyed_type</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:219"><span class="id" title="variable">Q</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> **; <span class="id" title="var">iIntros</span> "operand".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand_array_delete"><span class="id" title="axiom">wp_operand_array_delete</span></a>; <span class="id" title="tactic">eauto</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> (<a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_operand_frame"><span class="id" title="axiom">wp_operand_frame</span></a> <span class="id" title="var">_</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.tu"><span class="id" title="variable">tu</span></a>); [<span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span> | | <span class="id" title="tactic">by</span> <span class="id" title="var">iFrame</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">v</span> <span class="id" title="var">free</span>) "H"; <span class="id" title="var">iDestruct</span> "H" <span class="id" title="keyword">as</span> (<span class="id" title="var">obj_ptr</span>) "(-&gt; &amp; % &amp; sz)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iExists</span> <span class="id" title="var">obj_ptr</span>; <span class="id" title="var">iSplitR</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="abbreviation">bool_decide_false</span>; <span class="id" title="var">last</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> "sz" <span class="id" title="keyword">as</span> (<span class="id" title="var">array_sz</span>) "(? &amp; destroy_val)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="var">iExists</span> <span class="id" title="var">array_sz</span>; <span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Expr__newdelete.with_cpp_logic.with_resolve.delete.NOTE_potentially_relaxing_array_delete" class="idref" href="#Expr__newdelete.with_cpp_logic.with_resolve.delete.NOTE_potentially_relaxing_array_delete"><span class="id" title="section">NOTE_potentially_relaxing_array_delete</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;While&nbsp;(we&nbsp;currently&nbsp;think)&nbsp;it&nbsp;is&nbsp;UB&nbsp;to&nbsp;delete&nbsp;<span class="inlinecode"><span class="id" title="tactic">auto</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">new</span></span> <span class="inlinecode"><span class="id" title="var">int</span>[5][6]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;<span class="inlinecode"><span class="id" title="var">delete</span>[]</span> <span class="inlinecode">&amp;(<span class="id" title="var">p</span>[0][0])</span>,&nbsp;it&nbsp;seems&nbsp;like&nbsp;clang&nbsp;still&nbsp;does&nbsp;something<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sensible&nbsp;for&nbsp;this.&nbsp;If&nbsp;we&nbsp;want&nbsp;to&nbsp;relax&nbsp;our&nbsp;axioms&nbsp;in&nbsp;the&nbsp;future&nbsp;to<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allow&nbsp;for&nbsp;this&nbsp;sort&nbsp;of&nbsp;behavior,&nbsp;we&nbsp;could&nbsp;relate&nbsp;the&nbsp;"carrier&nbsp;type"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;the&nbsp;"dynamic&nbsp;type"&nbsp;of&nbsp;the&nbsp;array&nbsp;which&nbsp;was&nbsp;allocated&nbsp;(which&nbsp;is&nbsp;stored<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">new_token</span></span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In&nbsp;particular,&nbsp;so&nbsp;long&nbsp;as&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">obj_ptr</span></span>&nbsp;<span class="inlinecode"><span class="id" title="var">p'</span></span>&nbsp;we&nbsp;delete&nbsp;is&nbsp;syntactically<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;identical&nbsp;to&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">obj_ptr</span></span>&nbsp;<span class="inlinecode"><span class="id" title="var">p</span></span>&nbsp;returned&nbsp;by&nbsp;our&nbsp;array-new&nbsp;call&nbsp;/and/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;"carrier&nbsp;type"&nbsp;of&nbsp;the&nbsp;delete&nbsp;is&nbsp;_similar_<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;https://eel.is/c++draft/conv.qual&gt;&nbsp;to&nbsp;the&nbsp;"carrier&nbsp;type"&nbsp;of<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;array,&nbsp;we&nbsp;can&nbsp;use&nbsp;<span class="inlinecode"><span class="id" title="var">p'</span></span>&nbsp;to&nbsp;delete&nbsp;the&nbsp;object&nbsp;rooted&nbsp;at&nbsp;<span class="inlinecode"><span class="id" title="var">p</span></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOTE:&nbsp;we&nbsp;might&nbsp;need&nbsp;to&nbsp;insert&nbsp;<span class="inlinecode"><span class="id" title="var">erase_qualifiers</span></span>/<span class="inlinecode"><span class="id" title="var">normalize_type</span></span>&nbsp;calls&nbsp;to<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reflect&nbsp;that&nbsp;the&nbsp;standard&nbsp;only&nbsp;calls&nbsp;for&nbsp;"similarity"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(which&nbsp;has&nbsp;a&nbsp;more&nbsp;nuanced&nbsp;consideration&nbsp;of&nbsp;cv-qualifiers).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;we&nbsp;have&nbsp;<span class="inlinecode"><span class="id" title="var">Tarray</span></span> <span class="inlinecode"><span class="id" title="var">ty</span></span> <span class="inlinecode"><span class="id" title="var">sz</span></span>,&nbsp;<span class="inlinecode"><span class="id" title="var">array_carrier_type</span></span> <span class="inlinecode"><span class="id" title="var">ty</span></span>&nbsp;strips&nbsp;all&nbsp;of&nbsp;the&nbsp;outermost<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">Tarray</span></span>s&nbsp;off&nbsp;and&nbsp;returns&nbsp;the&nbsp;"carrier&nbsp;type"&nbsp;of&nbsp;the&nbsp;array.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <a id="Expr__newdelete.array_carrier_type" class="idref" href="#Expr__newdelete.array_carrier_type"><span class="id" title="definition">array_carrier_type</span></a> (<a id="ty:232" class="idref" href="#ty:232"><span class="id" title="binder">ty</span></a> : <a class="idref" href="bedrock.lang.cpp.syntax.types.html#type"><span class="id" title="inductive">type</span></a>) : <a class="idref" href="bedrock.lang.cpp.syntax.types.html#type"><span class="id" title="inductive">type</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:232"><span class="id" title="variable">ty</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tarray"><span class="id" title="constructor">Tarray</span></a> <span class="id" title="var">ty'</span> <span class="id" title="var">_</span> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_carrier_type:233"><span class="id" title="definition">array_carrier_type</span></a> <span class="id" title="var">ty'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:232"><span class="id" title="variable">ty</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.delete.NOTE_potentially_relaxing_array_delete"><span class="id" title="section">NOTE_potentially_relaxing_array_delete</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.delete"><span class="id" title="section">delete</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve"><span class="id" title="section">with_resolve</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic"><span class="id" title="section">with_cpp_logic</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete"><span class="id" title="module">Expr__newdelete</span></a>.<br/>

<br/>
<span class="id" title="keyword">Declare Module</span> <a id="E__newdelete" class="idref" href="#E__newdelete"><span class="id" title="module">E__newdelete</span></a> : <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete"><span class="id" title="module">Expr__newdelete</span></a>.<br/>

<br/>
<span class="id" title="keyword">Export</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#E__newdelete"><span class="id" title="module">E__newdelete</span></a>.<br/>
</div>
<!--
-- Copyright (c) 2020 BedRock Systems, Inc.
-- This software is distributed under the terms of the BedRock Open-Source License.
-- See the LICENSE-BedRock file in the repository root for details.
-->

<!--
-- SPDX-LIcense-Identifier:BSD-2-Clause
-->
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
