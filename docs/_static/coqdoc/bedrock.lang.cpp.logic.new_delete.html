<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
-- Copyright (c) 2020 BedRock Systems, Inc.
-- This software is distributed under the terms of the BedRock Open-Source License.
-- See the LICENSE-BedRock file in the repository root for details.
-->

<!--
-- SPDX-LIcense-Identifier:BSD-2-Clause
-->
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="../css/coqdocjs/coqdoc.css" rel="stylesheet" type="text/css" />
<link href="../css/coqdocjs/coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../js/coqdocjs/config.js"></script>
<script type="text/javascript" src="../js/coqdocjs/coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <!-- NOTE: These are displayed right to left on the page -->
    <span class="right">
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> `theories/` </a>
      <a href="../../index.html"> Toplevel </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">bedrock.lang.cpp.logic.new_delete</h1>

<div class="code">
<span class="comment">(*<br/>
&nbsp;*&nbsp;Copyright&nbsp;(c)&nbsp;2021&nbsp;BedRock&nbsp;Systems,&nbsp;Inc.<br/>
&nbsp;*&nbsp;This&nbsp;software&nbsp;is&nbsp;distributed&nbsp;under&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;BedRock&nbsp;Open-Source&nbsp;License.<br/>
&nbsp;*&nbsp;See&nbsp;the&nbsp;LICENSE-BedRock&nbsp;file&nbsp;in&nbsp;the&nbsp;repository&nbsp;root&nbsp;for&nbsp;details.<br/>
&nbsp;*)</span><br/>
</div>

<div class="doc">
<a id="lab114"></a><h1 class="section">Semantics of <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.new"><span class="id" title="section">new</span></a></span> and <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.delete"><span class="id" title="section">delete</span></a></span> expressions</h1>

<a id="lab115"></a><h1 class="section">(expressed in weakest pre-condition style)</h1>

 
</div>
<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.proofmode.proofmode.html#"><span class="id" title="library">iris.proofmode.proofmode</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">bedrock.lang.cpp</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="bedrock.lang.cpp.ast.html#"><span class="id" title="library">ast</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.html#"><span class="id" title="library">semantics</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">bedrock.lang.cpp.logic</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.pred.html#"><span class="id" title="library">pred</span></a> <a class="idref" href="bedrock.lang.cpp.logic.path_pred.html#"><span class="id" title="library">path_pred</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#"><span class="id" title="library">heap_pred</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.destroy.html#"><span class="id" title="library">destroy</span></a> <a class="idref" href="bedrock.lang.cpp.logic.initializers.html#"><span class="id" title="library">initializers</span></a> <a class="idref" href="bedrock.lang.cpp.logic.dispatch.html#"><span class="id" title="library">dispatch</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.wp.html#"><span class="id" title="library">wp</span></a> <a class="idref" href="bedrock.lang.cpp.logic.call.html#"><span class="id" title="library">call</span></a>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#"><span class="id" title="library">bedrock.lang.cpp.heap_notations</span></a>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="keyword">Type</span> <a id="Expr__newdelete" class="idref" href="#Expr__newdelete"><span class="id" title="module">Expr__newdelete</span></a>.<br/>

<br/>
&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">free_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab116"></a><h1 class="section">Weakest pre-condition for <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.new"><span class="id" title="section">new</span></a></span> and <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.delete"><span class="id" title="section">delete</span></a></span> expressions</h1>

   *
<a id="lab117"></a><h1 class="section">NOTE It is important that these rules are sound, but less important that</h1>

<a id="lab118"></a><h1 class="section">they are complete. When in doubt, we err on the side of caution and under-specify</h1>

<a id="lab119"></a><h1 class="section">the behavior of various constructs.</h1>

   *
<a id="lab120"></a><h1 class="section">If you run into code that requires addditional semantic specification, please file</h1>

<a id="lab121"></a><h1 class="section">an issue.</h1>

   
<div class="paragraph"> </div>

 Dynamic Typing at <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.delete"><span class="id" title="section">delete</span></a></span>-Time

<div class="paragraph"> </div>

      The C++ Standard ascribes undefined behavior to any <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.delete"><span class="id" title="section">delete</span></a></span>-calls which
      have a Static Type which differs from the Dynamic Type that was associated
      with the pointer when it was initially created via <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.new"><span class="id" title="section">new</span></a></span>
      &lt;https://eel.is/c++draft/expr.delete3>:
      | (3) In a single-object delete expression, if the static type of the object to be
      |     deleted is not similar ([conv.qual]) to its dynamic type and the selected
      |     deallocation function (see below) is not a destroying operator delete, the
      |     static type shall be a base class of the dynamic type of the object to be
      |     deleted and the static type shall have a virtual destructor or the behavior is
      |     undefined. In an array delete expression, if the dynamic type of the object to
      |     be deleted is not similar to its static type, the behavior is undefined.
      [new_tokenR allocation_type] tracks this Dynamic Type information.
   
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <a id="Expr__newdelete.new_tokenR" class="idref" href="#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> : <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">forall</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">`{</span></a><a id="ebf069dbc779b42a15c441a6d39d5f83" class="idref" href="#ebf069dbc779b42a15c441a6d39d5f83"><span class="id" title="binder">Σ</span></a> : <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.cpp_logic"><span class="id" title="class">cpp_logic</span></a> <a id="ti:1" class="idref" href="#ti:1"><span class="id" title="binder">ti</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">},</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#type"><span class="id" title="inductive">type</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.rep_defs.html#Rep"><span class="id" title="definition">Rep</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Expr__newdelete.new_tokenR_timeless" class="idref" href="#Expr__newdelete.new_tokenR_timeless"><span class="id" title="axiom">new_tokenR_timeless</span></a> : <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">forall</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">`{</span></a><a id="48bbc240c70629f9166b6605559525f0" class="idref" href="#48bbc240c70629f9166b6605559525f0"><span class="id" title="binder">Σ</span></a> : <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.cpp_logic"><span class="id" title="class">cpp_logic</span></a> <a id="ti:4" class="idref" href="#ti:4"><span class="id" title="binder">ti</span></a>} <a id="ty:6" class="idref" href="#ty:6"><span class="id" title="binder">ty</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">,</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.derived_connectives.html#Timeless"><span class="id" title="class">Timeless</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:6"><span class="id" title="variable">ty</span></a>).<br/>
&nbsp;&nbsp;#[<span class="id" title="var">global</span>] <span class="id" title="var">Existing</span> <span class="id" title="var">Instances</span> <span class="id" title="var">new_tokenR_timeless</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Expr__newdelete.with_cpp_logic" class="idref" href="#Expr__newdelete.with_cpp_logic"><span class="id" title="section">with_cpp_logic</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<a id="2ff76d4cddec082cd899c55bae9fabf3" class="idref" href="#2ff76d4cddec082cd899c55bae9fabf3"><span class="id" title="binder">Σ</span></a> : <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.cpp_logic"><span class="id" title="class">cpp_logic</span></a> <a id="thread_info:8" class="idref" href="#thread_info:8"><span class="id" title="binder">thread_info</span></a>}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Expr__newdelete.with_cpp_logic.with_resolve" class="idref" href="#Expr__newdelete.with_cpp_logic.with_resolve"><span class="id" title="section">with_resolve</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="resolve:10" class="idref" href="#resolve:10"><span class="id" title="binder">resolve</span></a>:<a class="idref" href="bedrock.lang.cpp.semantics.genv.html#genv"><span class="id" title="class">genv</span></a>}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> (<a id="70cf4ae13e57eff91798dfc327124f70" class="idref" href="#70cf4ae13e57eff91798dfc327124f70"><span class="id" title="variable">ρ</span></a> : <a class="idref" href="bedrock.lang.cpp.logic.wp.html#region"><span class="id" title="inductive">region</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.wp_prval" class="idref" href="#Expr__newdelete.wp_prval"><span class="id" title="abbreviation">wp_prval</span></a> := (<a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_prval"><span class="id" title="definition">wp_prval</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#70cf4ae13e57eff91798dfc327124f70"><span class="id" title="variable">ρ</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.wp_init" class="idref" href="#Expr__newdelete.wp_init"><span class="id" title="abbreviation">wp_init</span></a> := (<a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_init"><span class="id" title="axiom">wp_init</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#70cf4ae13e57eff91798dfc327124f70"><span class="id" title="variable">ρ</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.wp_initialize" class="idref" href="#Expr__newdelete.wp_initialize"><span class="id" title="abbreviation">wp_initialize</span></a> := (<a class="idref" href="bedrock.lang.cpp.logic.initializers.html#IN.wp_initialize"><span class="id" title="definition">wp_initialize</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#70cf4ae13e57eff91798dfc327124f70"><span class="id" title="variable">ρ</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.wp_operand" class="idref" href="#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> := (<a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.wp_operand"><span class="id" title="axiom">wp_operand</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#70cf4ae13e57eff91798dfc327124f70"><span class="id" title="variable">ρ</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.wp_args" class="idref" href="#Expr__newdelete.wp_args"><span class="id" title="abbreviation">wp_args</span></a> := (<a class="idref" href="bedrock.lang.cpp.logic.call.html#wp_args"><span class="id" title="definition">wp_args</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#70cf4ae13e57eff91798dfc327124f70"><span class="id" title="variable">ρ</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.fspec" class="idref" href="#Expr__newdelete.fspec"><span class="id" title="abbreviation">fspec</span></a> := (<a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.fspec"><span class="id" title="axiom">fspec</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.resolve"><span class="id" title="variable">resolve</span></a>.(<a class="idref" href="bedrock.lang.cpp.semantics.genv.html#genv_tu"><span class="id" title="projection">genv_tu</span></a>).(<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#globals"><span class="id" title="projection">globals</span></a>)).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.size_of" class="idref" href="#Expr__newdelete.size_of"><span class="id" title="abbreviation">size_of</span></a> := (@<a class="idref" href="bedrock.lang.cpp.semantics.types.html#size_of"><span class="id" title="definition">size_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.resolve"><span class="id" title="variable">resolve</span></a>) (<span class="id" title="var">only</span> <span class="id" title="var">parsing</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.Tsize_t" class="idref" href="#Expr__newdelete.Tsize_t"><span class="id" title="abbreviation">Tsize_t</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tu64"><span class="id" title="abbreviation">Tu64</span></a> (<span class="id" title="var">only</span> <span class="id" title="var">parsing</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Notation</span> <a id="Expr__newdelete.Tbyte" class="idref" href="#Expr__newdelete.Tbyte"><span class="id" title="abbreviation">Tbyte</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tuchar"><span class="id" title="abbreviation">Tuchar</span></a> (<span class="id" title="var">only</span> <span class="id" title="var">parsing</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Expr__newdelete.alloc_size_t" class="idref" href="#Expr__newdelete.alloc_size_t"><span class="id" title="definition">alloc_size_t</span></a> (<a id="sz:12" class="idref" href="#sz:12"><span class="id" title="binder">sz</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>) (<a id="Q:13" class="idref" href="#Q:13"><span class="id" title="binder">Q</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.mpred"><span class="id" title="definition">mpred</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.mpred"><span class="id" title="definition">mpred</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.mpred"><span class="id" title="definition">mpred</span></a>) : <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.mpred"><span class="id" title="definition">mpred</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a id="p:14" class="idref" href="#p:14"><span class="id" title="binder">p</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:14"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#primR"><span class="id" title="definition">primR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.Tsize_t"><span class="id" title="abbreviation">Tsize_t</span></a> 1 (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vn"><span class="id" title="definition">Vn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:12"><span class="id" title="variable">sz</span></a>) <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:13"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:14"><span class="id" title="variable">p</span></a> (<span class="id" title="keyword">fun</span> <a id="Q:15" class="idref" href="#Q:15"><span class="id" title="binder">Q</span></a> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:14"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#anyR"><span class="id" title="axiom">anyR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.Tsize_t"><span class="id" title="abbreviation">Tsize_t</span></a> 1 <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:15"><span class="id" title="variable">Q</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Expr__newdelete.with_cpp_logic.with_resolve.new" class="idref" href="#Expr__newdelete.with_cpp_logic.with_resolve.new"><span class="id" title="section">new</span></a>.<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.new"><span class="id" title="section">new</span></a></span> <span class="inlinecode">(...)</span> <span class="inlinecode"><a class="idref" href="bedrock.lang.algebra.coGset.html#C"><span class="id" title="abbreviation">C</span></a>(...)</span> &lt;https://eel.is/c++draft/expr.new&gt;
<ul class="doclist">
<li> invokes a C++ new operator <span class="inlinecode"><span class="id" title="var">new_fn</span></span>, which returns a storage pointer <span class="inlinecode"><span class="id" title="var">storage_ptr</span></span>;
              <span class="inlinecode"><span class="id" title="var">new_fn</span></span> <i>might</i> allocate memory
              (https://eel.is/c++draft/expr.new10), or return an argument
              address for some forms of placement new;
            - constructs an object pointer [obj_ptr], which shares the address of [storage_ptr];
            - invokes the constructor C over [obj_ptr].

            Furthermore <https://eel.is/c++draft/expr.new22&gt;:

</li>
</ul>
            | (22) A new-expression that creates an object of type T initializes that
            |      object as follows:
            | (22.1) If the new-initializer is omitted, the object is default-initialized
            |        (<span class="inlinecode"><span class="id" title="var">dcl.init</span></span>).
            |        <span class="inlinecode"><span class="id" title="var">Note</span></span> <span class="inlinecode">12:</span> <span class="inlinecode"><span class="id" title="var">If</span></span> <span class="inlinecode"><span class="id" title="keyword">no</span></span> <span class="inlinecode"><span class="id" title="var">initialization</span></span> <span class="inlinecode"><span class="id" title="keyword">is</span></span> <span class="inlinecode"><span class="id" title="var">performed</span>,</span> <span class="inlinecode"><span class="id" title="var">the</span></span> <span class="inlinecode"><span class="id" title="var">object</span></span> <span class="inlinecode"><span class="id" title="var">has</span></span> <span class="inlinecode"><span class="id" title="var">an</span></span>
            <span class="inlinecode">|</span>         <span class="inlinecode"><span class="id" title="var">indeterminate</span></span> <span class="inlinecode"><span class="id" title="var">value</span>.</span> <span class="inlinecode">—</span> <span class="inlinecode"><span class="id" title="keyword">end</span></span> <span class="inlinecode"><span class="id" title="var">note</span></span>
            | (22.2) Otherwise, the new-initializer is interpreted according to the
            |        initialization rules of <span class="inlinecode"><span class="id" title="var">dcl.init</span></span> for direct-initialization.
            We use <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.initializers.html#Init.default_initialize"><span class="id" title="definition">default_initialize</span></a></span> for default ininitialization as it is defined in the
            C++ Standard and we use <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_init"><span class="id" title="abbreviation">wp_init</span></a></span> for direct-initialization as defined
            by the C++ Standard.

<div class="paragraph"> </div>

            ~~~ Implementation Details ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

<div class="paragraph"> </div>

<ul class="doclist">
<li> This axiom assumes that <span class="inlinecode"><span class="id" title="var">storage_ptr</span></span> points to a character array that will
              <i>provide storage</i> for a new <i>complete object</i> <span class="inlinecode"><span class="id" title="var">o</span></span>
              (http://eel.is/c++draft/intro.objectdef:provides_storage).

              In that case, the C++ abstract machine can choose to make [obj_ptr
              <> storage_ptr] (while keeping the same address), so that the old
              pointer [storage_ptr] cannot be used to access the new object.
              Inspired by Cerberus, we model this by _allowing_ [obj_ptr] to have
              a different allocation ID.

            - The created object might be a subobject of an existing object
              (pointed to by some pointer [p])
              (https://eel.is/c++draft/basic.memobjintro.object-2).
              It is unclear whether that requires <span class="inlinecode"><span class="id" title="var">storage_ptr</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><a class="idref" href="bedrock.noimport.doc.cpp.logic.html#with_Sigma.p"><span class="id" title="variable">p</span></a></span> or just
              <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.model.simple_pred.html#SimpleCPP.provides_storage"><span class="id" title="definition">provides_storage</span></a></span> <span class="inlinecode"><span class="id" title="var">storage_ptr</span></span> <span class="inlinecode"><a class="idref" href="bedrock.noimport.doc.cpp.logic.html#with_Sigma.p"><span class="id" title="variable">p</span></a></span>.
              In that case, we plan to allow proving that <span class="inlinecode"><span class="id" title="var">obj_ptr</span></span> = <span class="inlinecode"><a class="idref" href="bedrock.noimport.doc.cpp.logic.html#with_Sigma.p"><span class="id" title="variable">p</span></a></span> <span class="inlinecode">.,</span> <span class="inlinecode"><span class="id" title="var">o</span></span>; we
              offer no such support at present; we account for this case by not specifying that
              <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.model.inductive_pointers.html#PTRS_IMPL.ptr_alloc_id"><span class="id" title="definition">ptr_alloc_id</span></a></span> <span class="inlinecode"><span class="id" title="var">obj_ptr</span></span> <span class="inlinecode">&lt;&gt;</span> <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.model.inductive_pointers.html#PTRS_IMPL.ptr_alloc_id"><span class="id" title="definition">ptr_alloc_id</span></a></span> <span class="inlinecode"><span class="id" title="var">storage_ptr</span></span>.

</li>
<li> Currently, we do not model coalescing of multiple allocations
              (https://eel.is/c++draft/expr.new14).
         

</li>
</ul>
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Expr__newdelete.wp_operand_new" class="idref" href="#Expr__newdelete.wp_operand_new"><span class="id" title="axiom">wp_operand_new</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">forall</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">(</span></a><a id="oinit:16" class="idref" href="#oinit:16"><span class="id" title="binder">oinit</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Expr"><span class="id" title="inductive">Expr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="new_fn:17" class="idref" href="#new_fn:17"><span class="id" title="binder">new_fn</span></a> <a id="new_args:18" class="idref" href="#new_args:18"><span class="id" title="binder">new_args</span></a> <a id="aty:19" class="idref" href="#aty:19"><span class="id" title="binder">aty</span></a> <a id="Q:20" class="idref" href="#Q:20"><span class="id" title="binder">Q</span></a> <a id="targs:21" class="idref" href="#targs:21"><span class="id" title="binder">targs</span></a> <a id="sz:22" class="idref" href="#sz:22"><span class="id" title="binder">sz</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="nfty:23" class="idref" href="#nfty:23"><span class="id" title="binder">nfty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#normalize_type"><span class="id" title="definition">normalize_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:17"><span class="id" title="variable">new_fn</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#:::x_'.2'"><span class="id" title="notation">.2</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">_</span> : <a class="idref" href="bedrock.lang.cpp.logic.call.html#arg_types"><span class="id" title="definition">arg_types</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#nfty:23"><span class="id" title="variable">nfty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tnum"><span class="id" title="constructor">Tnum</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:22"><span class="id" title="variable">sz</span></a> <a class="idref" href="bedrock.lang.cpp.arith.types.html#Unsigned"><span class="id" title="constructor">Unsigned</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#targs:21"><span class="id" title="variable">targs</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_args"><span class="id" title="abbreviation">wp_args</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#targs:21"><span class="id" title="variable">targs</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_args:18"><span class="id" title="variable">new_args</span></a> (<span class="id" title="keyword">fun</span> <a id="vs:24" class="idref" href="#vs:24"><span class="id" title="binder">vs</span></a> <a id="free:25" class="idref" href="#free:25"><span class="id" title="binder">free</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="sz:26" class="idref" href="#sz:26"><span class="id" title="binder">sz</span></a> <a id="al:27" class="idref" href="#al:27"><span class="id" title="binder">al</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.size_of"><span class="id" title="abbreviation">size_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:19"><span class="id" title="variable">aty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:26"><span class="id" title="variable">sz</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.has_type"><span class="id" title="axiom">has_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:26"><span class="id" title="variable">sz</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.Tsize_t"><span class="id" title="abbreviation">Tsize_t</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.types.html#align_of"><span class="id" title="axiom">align_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:19"><span class="id" title="variable">aty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#al:27"><span class="id" title="variable">al</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.prelude.base.html#Reduce"><span class="id" title="abbreviation">Reduce</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_size_t"><span class="id" title="definition">alloc_size_t</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:26"><span class="id" title="variable">sz</span></a> (<span class="id" title="keyword">fun</span> <a id="p:28" class="idref" href="#p:28"><span class="id" title="binder">p</span></a> <a id="FR:29" class="idref" href="#FR:29"><span class="id" title="binder">FR</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3100380cbf7f520075624a1979df30b0"><span class="id" title="notation">|&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.fspec"><span class="id" title="abbreviation">fspec</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#nfty:23"><span class="id" title="variable">nfty</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.path_pred.html#_global"><span class="id" title="definition">_global</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:17"><span class="id" title="variable">new_fn</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#:::x_'.1'"><span class="id" title="notation">.1</span></a>) (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:28"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#vs:24"><span class="id" title="variable">vs</span></a>) (<span class="id" title="keyword">fun</span> <a id="res:30" class="idref" href="#res:30"><span class="id" title="binder">res</span></a> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#FR:29"><span class="id" title="variable">FR</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#547692780023ef044153bc0c4f871ef7"><span class="id" title="notation">$</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="storage_ptr:31" class="idref" href="#storage_ptr:31"><span class="id" title="binder">storage_ptr</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#res:30"><span class="id" title="variable">res</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#primR"><span class="id" title="definition">primR</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a>) 1 (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:31"><span class="id" title="variable">storage_ptr</span></a>) <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.decidable.html#bool_decide"><span class="id" title="definition">bool_decide</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:31"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.nullptr"><span class="id" title="axiom">nullptr</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_args:18"><span class="id" title="variable">new_args</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:20"><span class="id" title="variable">Q</span></a> (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:31"><span class="id" title="variable">storage_ptr</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:25"><span class="id" title="variable">free</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">blockR</span></span> <span class="inlinecode"><span class="id" title="var">sz</span></span> <span class="inlinecode">-|-</span> <span class="inlinecode"><span class="id" title="var">tblockR</span></span> <span class="inlinecode"><span class="id" title="var">aty</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:31"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#blockR"><span class="id" title="definition">blockR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:26"><span class="id" title="variable">sz</span></a> 1 <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#alignedR"><span class="id" title="definition">alignedR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#al:27"><span class="id" title="variable">al</span></a><a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">)</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;TODO:&nbsp;^&nbsp;This&nbsp;misses&nbsp;an&nbsp;condition&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">storage_ptr</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;suitably&nbsp;aligned,&nbsp;accounting&nbsp;for<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__STDCPP_DEFAULT_NEW_ALIGNMENT__&nbsp;(issue&nbsp;149) *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a id="obj_ptr:32" class="idref" href="#obj_ptr:32"><span class="id" title="binder">obj_ptr</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;also&nbsp;ensures&nbsp;these&nbsp;pointers&nbsp;share&nbsp;their<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;address&nbsp;(see&nbsp;<span class="inlinecode"><span class="id" title="var">provides_storage_same_address</span></span>)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.pred.html#L.provides_storage"><span class="id" title="axiom">provides_storage</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:31"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:32"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:19"><span class="id" title="variable">aty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#oinit:16"><span class="id" title="variable">oinit</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="comment">(*&nbsp;default_initialize&nbsp;the&nbsp;memory&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.initializers.html#IN.default_initialize"><span class="id" title="definition">default_initialize</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:19"><span class="id" title="variable">aty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:32"><span class="id" title="variable">obj_ptr</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="free':34" class="idref" href="#free':34"><span class="id" title="binder">free'</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Track&nbsp;the&nbsp;type&nbsp;we&nbsp;are&nbsp;allocating<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;checked&nbsp;at&nbsp;<span class="inlinecode"><span class="id" title="var">delete</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:32"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:19"><span class="id" title="variable">aty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:20"><span class="id" title="variable">Q</span></a> (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:32"><span class="id" title="variable">obj_ptr</span></a>) (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free':34"><span class="id" title="variable">free'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#e7ee732424d29ae8c030d3bb834f6f3f"><span class="id" title="notation">&gt;*&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:25"><span class="id" title="variable">free</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">init</span> =&gt; <span class="comment">(*&nbsp;Use&nbsp;<span class="inlinecode"><span class="id" title="var">init</span></span>&nbsp;to&nbsp;initialize&nbsp;the&nbsp;memory&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_initialize"><span class="id" title="abbreviation">wp_initialize</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:19"><span class="id" title="variable">aty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:32"><span class="id" title="variable">obj_ptr</span></a> <span class="id" title="var">init</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="free':35" class="idref" href="#free':35"><span class="id" title="binder">free'</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Track&nbsp;the&nbsp;type&nbsp;we&nbsp;are&nbsp;allocating<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;checked&nbsp;at&nbsp;<span class="inlinecode"><span class="id" title="var">delete</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:32"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:19"><span class="id" title="variable">aty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:20"><span class="id" title="variable">Q</span></a> (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:32"><span class="id" title="variable">obj_ptr</span></a>) (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free':35"><span class="id" title="variable">free'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#e7ee732424d29ae8c030d3bb834f6f3f"><span class="id" title="notation">&gt;*&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:25"><span class="id" title="variable">free</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">)</span></a>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Enew"><span class="id" title="constructor">Enew</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:17"><span class="id" title="variable">new_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_args:18"><span class="id" title="variable">new_args</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:19"><span class="id" title="variable">aty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#oinit:16"><span class="id" title="variable">oinit</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:20"><span class="id" title="variable">Q</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Expr__newdelete.wp_operand_array_new" class="idref" href="#Expr__newdelete.wp_operand_array_new"><span class="id" title="axiom">wp_operand_array_new</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">forall</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">(</span></a><a id="array_size:37" class="idref" href="#array_size:37"><span class="id" title="binder">array_size</span></a> : <a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Expr"><span class="id" title="inductive">Expr</span></a>) (<a id="oinit:38" class="idref" href="#oinit:38"><span class="id" title="binder">oinit</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Expr"><span class="id" title="inductive">Expr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="new_fn:39" class="idref" href="#new_fn:39"><span class="id" title="binder">new_fn</span></a> <a id="new_args:40" class="idref" href="#new_args:40"><span class="id" title="binder">new_args</span></a> <a id="aty:41" class="idref" href="#aty:41"><span class="id" title="binder">aty</span></a> <a id="Q:42" class="idref" href="#Q:42"><span class="id" title="binder">Q</span></a> <a id="targs:43" class="idref" href="#targs:43"><span class="id" title="binder">targs</span></a> <a id="sz:44" class="idref" href="#sz:44"><span class="id" title="binder">sz</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="nfty:45" class="idref" href="#nfty:45"><span class="id" title="binder">nfty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#normalize_type"><span class="id" title="definition">normalize_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:39"><span class="id" title="variable">new_fn</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#:::x_'.2'"><span class="id" title="notation">.2</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">_</span> : <a class="idref" href="bedrock.lang.cpp.logic.call.html#arg_types"><span class="id" title="definition">arg_types</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#nfty:45"><span class="id" title="variable">nfty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tnum"><span class="id" title="constructor">Tnum</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:44"><span class="id" title="variable">sz</span></a> <a class="idref" href="bedrock.lang.cpp.arith.types.html#Unsigned"><span class="id" title="constructor">Unsigned</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#targs:43"><span class="id" title="variable">targs</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&lt;https://eel.is/c++draft/expr.new7>
               | (7) Every constant-expression in a noptr-new-declarator shall be a
               |     converted constant expression ([expr.const]) of type std​::​size_t
               |     and its value shall be greater than zero.
               |     [Example 4: Given the definition int n = 42, new float[n][5] is
               |      well-formed (because n is the expression of a noptr-new-declarator),
               |      but new float[5][n] is ill-formed (because n is not a constant
               |      expression). — end example]
               If we're allocating a new array, we know that the expression must reduce
               to a constant value of type [size_t] /and/ that it must be sequenced
               before we call the [new_fn].
             *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_size:37"><span class="id" title="variable">array_size</span></a> (<span class="id" title="keyword">fun</span> <a id="v:46" class="idref" href="#v:46"><span class="id" title="binder">v</span></a> <a id="free:47" class="idref" href="#free:47"><span class="id" title="binder">free</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Valid&nbsp;C++&nbsp;programs&nbsp;require&nbsp;this&nbsp;value&nbsp;to&nbsp;be&nbsp;a&nbsp;<span class="inlinecode"><span class="id" title="var">Vint</span></span>&nbsp;(see&nbsp;the&nbsp;quote&nbsp;from<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">expr.new</span>#7</span>&nbsp;above).&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="array_sizeN:48" class="idref" href="#array_sizeN:48"><span class="id" title="binder">array_sizeN</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#v:46"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vn"><span class="id" title="definition">Vn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_sizeN:48"><span class="id" title="variable">array_sizeN</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;size&nbsp;must&nbsp;be&nbsp;greater&nbsp;than&nbsp;zero&nbsp;(see&nbsp;the&nbsp;quote&nbsp;from&nbsp;<span class="inlinecode"><span class="id" title="var">expr.new</span>#7</span>&nbsp;above).&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_sizeN:48"><span class="id" title="variable">array_sizeN</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a>%<span class="id" title="var">N</span> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_args"><span class="id" title="abbreviation">wp_args</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#targs:43"><span class="id" title="variable">targs</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_args:40"><span class="id" title="variable">new_args</span></a> (<span class="id" title="keyword">fun</span> <a id="vs:49" class="idref" href="#vs:49"><span class="id" title="binder">vs</span></a> <a id="free':50" class="idref" href="#free':50"><span class="id" title="binder">free'</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="sz:51" class="idref" href="#sz:51"><span class="id" title="binder">sz</span></a> <a id="al:52" class="idref" href="#al:52"><span class="id" title="binder">al</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="array_ty:53" class="idref" href="#array_ty:53"><span class="id" title="binder">array_ty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tarray"><span class="id" title="constructor">Tarray</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:41"><span class="id" title="variable">aty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_sizeN:48"><span class="id" title="variable">array_sizeN</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.size_of"><span class="id" title="abbreviation">size_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:53"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:51"><span class="id" title="variable">sz</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.has_type"><span class="id" title="axiom">has_type</span></a> (2 <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:51"><span class="id" title="variable">sz</span></a>)%<span class="id" title="var">N</span> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tu64"><span class="id" title="abbreviation">Tu64</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;^^&nbsp;the&nbsp;overhead,&nbsp;<span class="inlinecode"><span class="id" title="var">sz'</span></span>&nbsp;below,&nbsp;is&nbsp;less&nbsp;than&nbsp;or&nbsp;equal&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;of&nbsp;the&nbsp;object,&nbsp;and&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;overhead&nbsp;and&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allocation&nbsp;size&nbsp;must&nbsp;fit&nbsp;in&nbsp;a&nbsp;`size_t`.&nbsp;See<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://eel.is/c++draft/expr.new16 for more information *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.types.html#align_of"><span class="id" title="axiom">align_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:41"><span class="id" title="variable">aty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#al:52"><span class="id" title="variable">al</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;NOTE:&nbsp;This&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">Forall</span></span> <span class="inlinecode"><span class="id" title="var">sz'</span></span>&nbsp;because&nbsp;the&nbsp;C++&nbsp;Abstract&nbsp;Machine&nbsp;can&nbsp;choose<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;however&nbsp;many&nbsp;bytes&nbsp;it&nbsp;wants&nbsp;to&nbsp;use&nbsp;for&nbsp;metadata&nbsp;when&nbsp;handling<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynamically&nbsp;allocated&nbsp;arrays.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a id="sz':54" class="idref" href="#sz':54"><span class="id" title="binder">sz'</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.prelude.base.html#Reduce"><span class="id" title="abbreviation">Reduce</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_size_t"><span class="id" title="definition">alloc_size_t</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz':54"><span class="id" title="variable">sz'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:51"><span class="id" title="variable">sz</span></a>) (<span class="id" title="keyword">fun</span> <a id="psz:55" class="idref" href="#psz:55"><span class="id" title="binder">psz</span></a> <a id="FR:56" class="idref" href="#FR:56"><span class="id" title="binder">FR</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3100380cbf7f520075624a1979df30b0"><span class="id" title="notation">|&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.fspec"><span class="id" title="abbreviation">fspec</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#nfty:45"><span class="id" title="variable">nfty</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.path_pred.html#_global"><span class="id" title="definition">_global</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:39"><span class="id" title="variable">new_fn</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#:::x_'.1'"><span class="id" title="notation">.1</span></a>) (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#psz:55"><span class="id" title="variable">psz</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#vs:49"><span class="id" title="variable">vs</span></a>) (<span class="id" title="keyword">fun</span> <a id="res:57" class="idref" href="#res:57"><span class="id" title="binder">res</span></a> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#FR:56"><span class="id" title="variable">FR</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#547692780023ef044153bc0c4f871ef7"><span class="id" title="notation">$</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="storage_ptr:58" class="idref" href="#storage_ptr:58"><span class="id" title="binder">storage_ptr</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#res:57"><span class="id" title="variable">res</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#primR"><span class="id" title="definition">primR</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a>) 1 (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:58"><span class="id" title="variable">storage_ptr</span></a>) <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.decidable.html#bool_decide"><span class="id" title="definition">bool_decide</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:58"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.nullptr"><span class="id" title="axiom">nullptr</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_args:40"><span class="id" title="variable">new_args</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:42"><span class="id" title="variable">Q</span></a> (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:58"><span class="id" title="variable">storage_ptr</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:47"><span class="id" title="variable">free</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">blockR</span></span> <span class="inlinecode"><span class="id" title="var">sz</span></span> <span class="inlinecode">-|-</span> <span class="inlinecode"><span class="id" title="var">tblockR</span></span> <span class="inlinecode">(<span class="id" title="var">Tarray</span></span> <span class="inlinecode"><span class="id" title="var">aty</span></span> <span class="inlinecode"><span class="id" title="var">array_size</span>)</span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:58"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#blockR"><span class="id" title="definition">blockR</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz':54"><span class="id" title="variable">sz'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:51"><span class="id" title="variable">sz</span></a>) 1 <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:58"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">.[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tu8"><span class="id" title="abbreviation">Tu8</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">!</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz':54"><span class="id" title="variable">sz'</span></a><a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">]</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#alignedR"><span class="id" title="definition">alignedR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#al:52"><span class="id" title="variable">al</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">)</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;todo:&nbsp;^&nbsp;This&nbsp;misses&nbsp;an&nbsp;condition&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">storage_ptr</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;suitably&nbsp;aligned,&nbsp;accounting&nbsp;for<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__STDCPP_DEFAULT_NEW_ALIGNMENT__&nbsp;(issue&nbsp;149) *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a id="obj_ptr:59" class="idref" href="#obj_ptr:59"><span class="id" title="binder">obj_ptr</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;also&nbsp;ensures&nbsp;these&nbsp;pointers&nbsp;share&nbsp;their<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;address&nbsp;(see&nbsp;<span class="inlinecode"><span class="id" title="var">provides_storage_same_address</span></span>)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.pred.html#L.provides_storage"><span class="id" title="axiom">provides_storage</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:58"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">.[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tu8"><span class="id" title="abbreviation">Tu8</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">!</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz':54"><span class="id" title="variable">sz'</span></a><a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">]</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:59"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:53"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#oinit:38"><span class="id" title="variable">oinit</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="comment">(*&nbsp;default_initialize&nbsp;the&nbsp;memory&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.initializers.html#IN.default_initialize"><span class="id" title="definition">default_initialize</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:53"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:59"><span class="id" title="variable">obj_ptr</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="free'':61" class="idref" href="#free'':61"><span class="id" title="binder">free''</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Track&nbsp;the&nbsp;type&nbsp;we&nbsp;are&nbsp;allocating<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;checked&nbsp;at&nbsp;<span class="inlinecode"><span class="id" title="var">delete</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:59"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:53"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:42"><span class="id" title="variable">Q</span></a> (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:59"><span class="id" title="variable">obj_ptr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free'':61"><span class="id" title="variable">free''</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#e7ee732424d29ae8c030d3bb834f6f3f"><span class="id" title="notation">&gt;*&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free':50"><span class="id" title="variable">free'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#e7ee732424d29ae8c030d3bb834f6f3f"><span class="id" title="notation">&gt;*&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:47"><span class="id" title="variable">free</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">init</span> =&gt; <span class="comment">(*&nbsp;Use&nbsp;<span class="inlinecode"><span class="id" title="var">init</span></span>&nbsp;to&nbsp;initialize&nbsp;the&nbsp;memory&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_initialize"><span class="id" title="abbreviation">wp_initialize</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:53"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:59"><span class="id" title="variable">obj_ptr</span></a> <span class="id" title="var">init</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="free'':62" class="idref" href="#free'':62"><span class="id" title="binder">free''</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Track&nbsp;the&nbsp;type&nbsp;we&nbsp;are&nbsp;allocating<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;checked&nbsp;at&nbsp;<span class="inlinecode"><span class="id" title="var">delete</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:59"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:53"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:42"><span class="id" title="variable">Q</span></a> (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:59"><span class="id" title="variable">obj_ptr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free'':62"><span class="id" title="variable">free''</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#e7ee732424d29ae8c030d3bb834f6f3f"><span class="id" title="notation">&gt;*&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free':50"><span class="id" title="variable">free'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#e7ee732424d29ae8c030d3bb834f6f3f"><span class="id" title="notation">&gt;*&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:47"><span class="id" title="variable">free</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">)</span></a>)))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Enew"><span class="id" title="constructor">Enew</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_fn:39"><span class="id" title="variable">new_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#new_args:40"><span class="id" title="variable">new_args</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#aty:41"><span class="id" title="variable">aty</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_size:37"><span class="id" title="variable">array_size</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#oinit:38"><span class="id" title="variable">oinit</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:42"><span class="id" title="variable">Q</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.new"><span class="id" title="section">new</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Expr__newdelete.with_cpp_logic.with_resolve.delete" class="idref" href="#Expr__newdelete.with_cpp_logic.with_resolve.delete"><span class="id" title="section">delete</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Expr__newdelete.alloc_pointer" class="idref" href="#Expr__newdelete.alloc_pointer"><span class="id" title="definition">alloc_pointer</span></a> (<a id="pv:64" class="idref" href="#pv:64"><span class="id" title="binder">pv</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a>) (<a id="Q:65" class="idref" href="#Q:65"><span class="id" title="binder">Q</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#FreeTemp"><span class="id" title="abbreviation">FreeTemp</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.mpred"><span class="id" title="definition">mpred</span></a>) : <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.mpred"><span class="id" title="definition">mpred</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a id="p:66" class="idref" href="#p:66"><span class="id" title="binder">p</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:66"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#primR"><span class="id" title="definition">primR</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a>) 1 (<a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#pv:64"><span class="id" title="variable">pv</span></a>) <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:65"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:66"><span class="id" title="variable">p</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.wp.html#FreeTemps.delete"><span class="id" title="constructor">FreeTemps.delete</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:66"><span class="id" title="variable">p</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="Expr__newdelete.alloc_pointer_frame" class="idref" href="#Expr__newdelete.alloc_pointer_frame"><span class="id" title="lemma">alloc_pointer_frame</span></a> : <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">forall</span></a> <a id="p:67" class="idref" href="#p:67"><span class="id" title="binder">p</span></a> <a id="Q:68" class="idref" href="#Q:68"><span class="id" title="binder">Q</span></a> <a id="Q':69" class="idref" href="#Q':69"><span class="id" title="binder">Q'</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a id="p:70" class="idref" href="#p:70"><span class="id" title="binder">p</span></a> <a id="fr:71" class="idref" href="#fr:71"><span class="id" title="binder">fr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:68"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:70"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#fr:71"><span class="id" title="variable">fr</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q':69"><span class="id" title="variable">Q'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:70"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#fr:71"><span class="id" title="variable">fr</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_pointer"><span class="id" title="definition">alloc_pointer</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:67"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:68"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_pointer"><span class="id" title="definition">alloc_pointer</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:67"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q':69"><span class="id" title="variable">Q'</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">rewrite</span> /<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_pointer"><span class="id" title="definition">alloc_pointer</span></a>. <span class="id" title="var">iIntros</span> "X Y".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (?) "p"; <span class="id" title="var">iApply</span> "X"; <span class="id" title="var">iApply</span> "Y"; <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">delete_val</span></span> <span class="inlinecode"><span class="id" title="var">default</span></span> <span class="inlinecode"><span class="id" title="var">ty</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>&nbsp;is&nbsp;the&nbsp;weakest&nbsp;pre-condition&nbsp;of&nbsp;deleting&nbsp;<span class="inlinecode"><span class="id" title="var">p</span></span>&nbsp;(of&nbsp;type&nbsp;<span class="inlinecode"><span class="id" title="var">ty</span></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">ty</span></span>&nbsp;has&nbsp;a&nbsp;custom&nbsp;<span class="inlinecode"><span class="id" title="var">operator</span></span> <span class="inlinecode"><span class="id" title="var">delete</span></span>,&nbsp;that&nbsp;function&nbsp;will&nbsp;be&nbsp;called,&nbsp;otherwise<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">default</span></span>&nbsp;delete&nbsp;operator&nbsp;will&nbsp;be&nbsp;used.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Expr__newdelete.delete_val" class="idref" href="#Expr__newdelete.delete_val"><span class="id" title="definition">delete_val</span></a> (<a id="default:72" class="idref" href="#default:72"><span class="id" title="binder">default</span></a> : <a class="idref" href="bedrock.lang.cpp.syntax.names.html#obj_name"><span class="id" title="definition">obj_name</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">*</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#type"><span class="id" title="inductive">type</span></a>) (<a id="ty:73" class="idref" href="#ty:73"><span class="id" title="binder">ty</span></a> : <a class="idref" href="bedrock.lang.cpp.syntax.types.html#type"><span class="id" title="inductive">type</span></a>) (<a id="p:74" class="idref" href="#p:74"><span class="id" title="binder">p</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a>) (<a id="Q:75" class="idref" href="#Q:75"><span class="id" title="binder">Q</span></a> : <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.mpred"><span class="id" title="definition">mpred</span></a>) : <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.mpred"><span class="id" title="definition">mpred</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="del_type:76" class="idref" href="#del_type:76"><span class="id" title="binder">del_type</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tfunction"><span class="id" title="constructor">Tfunction</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
TODO this should use <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.call.html#operand_receive"><span class="id" title="definition">operand_receive</span></a></span> <span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a></span> 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="del:83" class="idref" href="#del:83"><span class="id" title="binder">del</span></a> '<a id="pat:79" class="idref" href="#pat:79"><span class="id" title="binder">(</span></a><a id="pat:79" class="idref" href="#pat:79"><span class="id" title="binder">fn</span></a><a id="pat:79" class="idref" href="#pat:79"><span class="id" title="binder">,</span></a> <a id="pat:79" class="idref" href="#pat:79"><span class="id" title="binder">ty</span></a><a id="pat:79" class="idref" href="#pat:79"><span class="id" title="binder">)</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_pointer"><span class="id" title="definition">alloc_pointer</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:74"><span class="id" title="variable">p</span></a> (<span class="id" title="keyword">fun</span> <a id="p':80" class="idref" href="#p':80"><span class="id" title="binder">p'</span></a> <a id="free:81" class="idref" href="#free:81"><span class="id" title="binder">free</span></a> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.fspec"><span class="id" title="abbreviation">fspec</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:77"><span class="id" title="variable">ty</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.path_pred.html#_global"><span class="id" title="definition">_global</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#fn:78"><span class="id" title="variable">fn</span></a>) (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p':80"><span class="id" title="variable">p'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) (<span class="id" title="keyword">fun</span> <a id="p:82" class="idref" href="#p:82"><span class="id" title="binder">p</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.call.html#operand_receive"><span class="id" title="definition">operand_receive</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:82"><span class="id" title="variable">p</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.destroy.html#interp"><span class="id" title="definition">interp</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:81"><span class="id" title="variable">free</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:75"><span class="id" title="variable">Q</span></a>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="bedrock.lang.cpp.syntax.typing.html#erase_qualifiers"><span class="id" title="definition">erase_qualifiers</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:73"><span class="id" title="variable">ty</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tnamed"><span class="id" title="constructor">Tnamed</span></a> <span class="id" title="var">nm</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.resolve"><span class="id" title="variable">resolve</span></a>.(<a class="idref" href="bedrock.lang.cpp.semantics.genv.html#genv_tu"><span class="id" title="projection">genv_tu</span></a>) <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#4fa0a1d38759705f0ddcbbfc0f886b59"><span class="id" title="notation">!!</span></a> <span class="id" title="var">nm</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#Gstruct"><span class="id" title="constructor">Gstruct</span></a> <span class="id" title="var">s</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#del:83"><span class="id" title="variable">del</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#547692780023ef044153bc0c4f871ef7"><span class="id" title="notation">$</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.option.html#from_option"><span class="id" title="definition">from_option</span></a> (<span class="id" title="keyword">fun</span> <a id="x:84" class="idref" href="#x:84"><span class="id" title="binder">x</span></a> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#x:84"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#del_type:76"><span class="id" title="variable">del_type</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#default:72"><span class="id" title="variable">default</span></a> <span class="id" title="var">s</span>.(<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#s_delete"><span class="id" title="projection">s_delete</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#Gunion"><span class="id" title="constructor">Gunion</span></a> <span class="id" title="var">u</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#del:83"><span class="id" title="variable">del</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#547692780023ef044153bc0c4f871ef7"><span class="id" title="notation">$</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.option.html#from_option"><span class="id" title="definition">from_option</span></a> (<span class="id" title="keyword">fun</span> <a id="x:85" class="idref" href="#x:85"><span class="id" title="binder">x</span></a> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#x:85"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#del_type:76"><span class="id" title="variable">del_type</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#default:72"><span class="id" title="variable">default</span></a> <span class="id" title="var">u</span>.(<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#u_delete"><span class="id" title="projection">u_delete</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#::bi_scope:'False'"><span class="id" title="notation">False</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#del:83"><span class="id" title="variable">del</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#default:72"><span class="id" title="variable">default</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="Expr__newdelete.delete_val_frame" class="idref" href="#Expr__newdelete.delete_val_frame"><span class="id" title="lemma">delete_val_frame</span></a> : <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">forall</span></a> <a id="default:86" class="idref" href="#default:86"><span class="id" title="binder">default</span></a> <a id="ty:87" class="idref" href="#ty:87"><span class="id" title="binder">ty</span></a> <a id="p:88" class="idref" href="#p:88"><span class="id" title="binder">p</span></a> <a id="Q:89" class="idref" href="#Q:89"><span class="id" title="binder">Q</span></a> <a id="Q':90" class="idref" href="#Q':90"><span class="id" title="binder">Q'</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:89"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q':90"><span class="id" title="variable">Q'</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.delete_val"><span class="id" title="definition">delete_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#default:86"><span class="id" title="variable">default</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:87"><span class="id" title="variable">ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:88"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:89"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.delete_val"><span class="id" title="definition">delete_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#default:86"><span class="id" title="variable">default</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:87"><span class="id" title="variable">ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:88"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q':90"><span class="id" title="variable">Q'</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.delete_val"><span class="id" title="definition">delete_val</span></a>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "X"; <span class="id" title="tactic">repeat</span> <span class="id" title="var">case_match</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_pointer_frame"><span class="id" title="lemma">alloc_pointer_frame</span></a>; <span class="id" title="var">iIntros</span> (??);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.fspec_frame"><span class="id" title="lemma">fspec_frame</span></a>; <span class="id" title="var">iIntros</span> (?); <span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.call.html#operand_receive_frame"><span class="id" title="lemma">operand_receive_frame</span></a>; <span class="id" title="var">iIntros</span> (?); <span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.destroy.html#interp_frame"><span class="id" title="lemma">interp_frame</span></a>; <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.resolve_dtor"><span class="id" title="definition">resolve_dtor</span></a></span> <span class="inlinecode"><span class="id" title="var">ty</span></span> <span class="inlinecode"><a class="idref" href="bedrock.noimport.doc.cpp.logic.html#with_Sigma.this"><span class="id" title="variable">this</span></a></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> resolves the destructor for the object <span class="inlinecode"><a class="idref" href="bedrock.noimport.doc.cpp.logic.html#with_Sigma.this"><span class="id" title="variable">this</span></a></span> (of type <span class="inlinecode"><span class="id" title="var">ty</span></span>).
            The continuation <span class="inlinecode"><span class="id" title="var">Q</span></span> is passed the pointer to the most-derived-object of <span class="inlinecode"><a class="idref" href="bedrock.noimport.doc.cpp.logic.html#with_Sigma.this"><span class="id" title="variable">this</span></a></span> and its type.
         
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Expr__newdelete.resolve_dtor" class="idref" href="#Expr__newdelete.resolve_dtor"><span class="id" title="definition">resolve_dtor</span></a> (<a id="ty:91" class="idref" href="#ty:91"><span class="id" title="binder">ty</span></a> : <a class="idref" href="bedrock.lang.cpp.syntax.types.html#type"><span class="id" title="inductive">type</span></a>) (<a id="this:92" class="idref" href="#this:92"><span class="id" title="binder">this</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a>) (<a id="Q:93" class="idref" href="#Q:93"><span class="id" title="binder">Q</span></a> : <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.ptr"><span class="id" title="axiom">ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#type"><span class="id" title="inductive">type</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.mpred"><span class="id" title="definition">mpred</span></a>) : <a class="idref" href="bedrock.lang.cpp.logic.mpred.html#LC.mpred"><span class="id" title="definition">mpred</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="bedrock.lang.cpp.syntax.typing.html#drop_qualifiers"><span class="id" title="definition">drop_qualifiers</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:91"><span class="id" title="variable">ty</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tqualified"><span class="id" title="constructor">Tqualified</span></a> <span class="id" title="var">_</span> <span class="id" title="var">ty</span> =&gt; <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#::bi_scope:'False'"><span class="id" title="notation">False</span></a> <span class="comment">(*&nbsp;unreachable&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tnamed"><span class="id" title="constructor">Tnamed</span></a> <span class="id" title="var">cls</span>      =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.resolve"><span class="id" title="variable">resolve</span></a>.(<a class="idref" href="bedrock.lang.cpp.semantics.genv.html#genv_tu"><span class="id" title="projection">genv_tu</span></a>) <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#4fa0a1d38759705f0ddcbbfc0f886b59"><span class="id" title="notation">!!</span></a> <span class="id" title="var">cls</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#Gstruct"><span class="id" title="constructor">Gstruct</span></a> <span class="id" title="var">s</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#has_virtual_dtor"><span class="id" title="definition">has_virtual_dtor</span></a> <span class="id" title="var">s</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;NOTE&nbsp;<span class="inlinecode"><span class="id" title="var">has_virtual_dtor</span></span>&nbsp;could&nbsp;be&nbsp;derived&nbsp;from&nbsp;the&nbsp;vtable...&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;this&nbsp;case,&nbsp;use&nbsp;virtual&nbsp;dispatch&nbsp;to&nbsp;invoke&nbsp;the&nbsp;destructor.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.dispatch.html#resolve_virtual"><span class="id" title="definition">resolve_virtual</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this:92"><span class="id" title="variable">this</span></a> <span class="id" title="var">cls</span> <span class="id" title="var">s</span>.(<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#s_dtor"><span class="id" title="projection">s_dtor</span></a>) (<span class="id" title="keyword">fun</span> <a id="fimpl:94" class="idref" href="#fimpl:94"><span class="id" title="binder">fimpl</span></a> <a id="impl_class:95" class="idref" href="#impl_class:95"><span class="id" title="binder">impl_class</span></a> <a id="this':96" class="idref" href="#this':96"><span class="id" title="binder">this'</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="r_ty:97" class="idref" href="#r_ty:97"><span class="id" title="binder">r_ty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tnamed"><span class="id" title="constructor">Tnamed</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#impl_class:95"><span class="id" title="variable">impl_class</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:93"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this':96"><span class="id" title="variable">this'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#r_ty:97"><span class="id" title="variable">r_ty</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:93"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this:92"><span class="id" title="variable">this</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.typing.html#erase_qualifiers"><span class="id" title="definition">erase_qualifiers</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:91"><span class="id" title="variable">ty</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.translation_unit.html#Gunion"><span class="id" title="constructor">Gunion</span></a> <span class="id" title="var">u</span>)  =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Unions&nbsp;cannot&nbsp;have&nbsp;<span class="inlinecode"><span class="id" title="var">virtual</span></span>&nbsp;destructors:&nbsp;we&nbsp;directly&nbsp;invoke&nbsp;the&nbsp;destructor.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:93"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this:92"><span class="id" title="variable">this</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.typing.html#erase_qualifiers"><span class="id" title="definition">erase_qualifiers</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:91"><span class="id" title="variable">ty</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>                =&gt; <a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#::bi_scope:'False'"><span class="id" title="notation">False</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tarray"><span class="id" title="constructor">Tarray</span></a> <span class="id" title="var">ety</span> <span class="id" title="var">sz</span>   =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#::bi_scope:'False'"><span class="id" title="notation">False</span></a> <span class="comment">(*&nbsp;arrays&nbsp;can&nbsp;not&nbsp;be&nbsp;deleted&nbsp;with&nbsp;direct&nbsp;delete&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tref"><span class="id" title="constructor">Tref</span></a> <span class="id" title="var">r_ty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Trv_ref"><span class="id" title="constructor">Trv_ref</span></a> <span class="id" title="var">r_ty</span>    =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#::bi_scope:'False'"><span class="id" title="notation">False</span></a> <span class="comment">(*&nbsp;references&nbsp;can&nbsp;not&nbsp;be&nbsp;deleted,&nbsp;only&nbsp;destroyed&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">ty</span>              =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:93"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this:92"><span class="id" title="variable">this</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.typing.html#erase_qualifiers"><span class="id" title="definition">erase_qualifiers</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:91"><span class="id" title="variable">ty</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>%<span class="id" title="var">I</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="Expr__newdelete.resolve_dtor_frame" class="idref" href="#Expr__newdelete.resolve_dtor_frame"><span class="id" title="lemma">resolve_dtor_frame</span></a> : <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">forall</span></a> <a id="ty:98" class="idref" href="#ty:98"><span class="id" title="binder">ty</span></a> <a id="p:99" class="idref" href="#p:99"><span class="id" title="binder">p</span></a> <a id="Q:100" class="idref" href="#Q:100"><span class="id" title="binder">Q</span></a> <a id="Q':101" class="idref" href="#Q':101"><span class="id" title="binder">Q'</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">Forall</span></a> <a id="p:102" class="idref" href="#p:102"><span class="id" title="binder">p</span></a> <a id="t:103" class="idref" href="#t:103"><span class="id" title="binder">t</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#c4d2389a489ed3709578030625aa8744"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:100"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:102"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#t:103"><span class="id" title="variable">t</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q':101"><span class="id" title="variable">Q'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:102"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#t:103"><span class="id" title="variable">t</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.resolve_dtor"><span class="id" title="definition">resolve_dtor</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:98"><span class="id" title="variable">ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:99"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:100"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.resolve_dtor"><span class="id" title="definition">resolve_dtor</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:98"><span class="id" title="variable">ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:99"><span class="id" title="variable">p</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q':101"><span class="id" title="variable">Q'</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.resolve_dtor"><span class="id" title="definition">resolve_dtor</span></a>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "X"; <span class="id" title="tactic">repeat</span> <span class="id" title="var">case_match</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [ <span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.wp.html#WPE.fspec_frame"><span class="id" title="lemma">fspec_frame</span></a>; <span class="id" title="var">iIntros</span> (?); <span class="id" title="tactic">eauto</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="bedrock.lang.cpp.logic.dispatch.html#resolve_virtual_frame"><span class="id" title="lemma">resolve_virtual_frame</span></a>. <span class="id" title="var">iIntros</span> (???); <span class="id" title="var">iApply</span> "X".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;delete<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://eel.is/c++draft/expr.delete<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOTE:&nbsp;https://eel.is/c++draft/expr.delete7.1 says:
           > The value returned from the allocation call of the new-expression
           > shall be passed as the first argument to the deallocation function.

           Hence, the destructor is passed a pointer to the object, and the
           deallocation function [delete] is passed a pointer to the
           underlying storage (of type [void *]).

           On deleting null:
           From the C++ standard (https://en.cppreference.com/w/cpp/language/delete)

           > If expression evaluates to a null pointer value, no destructors are
           > called, and the deallocation function may or may not be called (it's
           > unspecified), but the default deallocation functions are guaranteed
           > to do nothing when passed a null pointer.

           NOTE: [Edelete]'s first argument is [true] iff the expression corresponds to
           an array-delete ([delete[]]).
         *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Expr__newdelete.wp_operand_delete" class="idref" href="#Expr__newdelete.wp_operand_delete"><span class="id" title="axiom">wp_operand_delete</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">forall</span></a> <a id="delete_fn:104" class="idref" href="#delete_fn:104"><span class="id" title="binder">delete_fn</span></a> <a id="e:105" class="idref" href="#e:105"><span class="id" title="binder">e</span></a> <a id="destroyed_type:106" class="idref" href="#destroyed_type:106"><span class="id" title="binder">destroyed_type</span></a> <a id="Q:107" class="idref" href="#Q:107"><span class="id" title="binder">Q</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="dfty:108" class="idref" href="#dfty:108"><span class="id" title="binder">dfty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#normalize_type"><span class="id" title="definition">normalize_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:104"><span class="id" title="variable">delete_fn</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#:::x_'.2'"><span class="id" title="notation">.2</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">_</span> : <a class="idref" href="bedrock.lang.cpp.logic.call.html#arg_types"><span class="id" title="definition">arg_types</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#dfty:108"><span class="id" title="variable">dfty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;call&nbsp;the&nbsp;destructor&nbsp;on&nbsp;the&nbsp;object,&nbsp;and&nbsp;then&nbsp;call&nbsp;delete_fn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#e:105"><span class="id" title="variable">e</span></a> (<span class="id" title="keyword">fun</span> <a id="v:109" class="idref" href="#v:109"><span class="id" title="binder">v</span></a> <a id="free:110" class="idref" href="#free:110"><span class="id" title="binder">free</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="obj_ptr:111" class="idref" href="#obj_ptr:111"><span class="id" title="binder">obj_ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#v:109"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:111"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.decidable.html#bool_decide"><span class="id" title="definition">bool_decide</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:111"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.nullptr"><span class="id" title="axiom">nullptr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;conjunction&nbsp;justifies&nbsp;the&nbsp;compiler&nbsp;calling&nbsp;the&nbsp;delete&nbsp;function<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;not&nbsp;calling&nbsp;it.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.delete_val"><span class="id" title="definition">delete_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:104"><span class="id" title="variable">delete_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#destroyed_type:106"><span class="id" title="variable">destroyed_type</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.nullptr"><span class="id" title="axiom">nullptr</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:107"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vvoid"><span class="id" title="definition">Vvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:110"><span class="id" title="variable">free</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#285322c305ec6868ebb70cbafa909038"><span class="id" title="notation">∧</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:107"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vvoid"><span class="id" title="definition">Vvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:110"><span class="id" title="variable">free</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;v----&nbsp;Calling&nbsp;destructor&nbsp;with&nbsp;object&nbsp;pointer&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.resolve_dtor"><span class="id" title="definition">resolve_dtor</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#destroyed_type:106"><span class="id" title="variable">destroyed_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:111"><span class="id" title="variable">obj_ptr</span></a> (<span class="id" title="keyword">fun</span> <a id="this':112" class="idref" href="#this':112"><span class="id" title="binder">this'</span></a> <a id="mdc_ty:113" class="idref" href="#mdc_ty:113"><span class="id" title="binder">mdc_ty</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this':112"><span class="id" title="variable">this'</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#mdc_ty:113"><span class="id" title="variable">mdc_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.destroy.html#destroy_val"><span class="id" title="definition">destroy_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#mdc_ty:113"><span class="id" title="variable">mdc_ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this':112"><span class="id" title="variable">this'</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#547692780023ef044153bc0c4f871ef7"><span class="id" title="notation">$</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="storage_ptr:114" class="idref" href="#storage_ptr:114"><span class="id" title="binder">storage_ptr</span></a> <a id="sz:115" class="idref" href="#sz:115"><span class="id" title="binder">sz</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.size_of"><span class="id" title="abbreviation">size_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#mdc_ty:113"><span class="id" title="variable">mdc_ty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:115"><span class="id" title="variable">sz</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;v----&nbsp;Token&nbsp;for&nbsp;converting&nbsp;obj&nbsp;memory&nbsp;to&nbsp;storage&nbsp;memory&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.pred.html#L.provides_storage"><span class="id" title="axiom">provides_storage</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:114"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#this':112"><span class="id" title="variable">this'</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#mdc_ty:113"><span class="id" title="variable">mdc_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Transfer&nbsp;memory&nbsp;to&nbsp;underlying&nbsp;storage&nbsp;pointer;&nbsp;unlike&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">end_provides_storage</span></span>,&nbsp;this&nbsp;memory&nbsp;was&nbsp;pre-destructed&nbsp;by<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">delete_val</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:114"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#blockR"><span class="id" title="definition">blockR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:115"><span class="id" title="variable">sz</span></a> 1 <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;v----&nbsp;Calling&nbsp;deallocator&nbsp;with&nbsp;storage&nbsp;pointer&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.delete_val"><span class="id" title="definition">delete_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:104"><span class="id" title="variable">delete_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#mdc_ty:113"><span class="id" title="variable">mdc_ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:114"><span class="id" title="variable">storage_ptr</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:107"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vvoid"><span class="id" title="definition">Vvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:110"><span class="id" title="variable">free</span></a>)<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">))</span></a>))<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Edelete"><span class="id" title="constructor">Edelete</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:104"><span class="id" title="variable">delete_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#e:105"><span class="id" title="variable">e</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#destroyed_type:106"><span class="id" title="variable">destroyed_type</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:107"><span class="id" title="variable">Q</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;NOTE:&nbsp;<span class="inlinecode"><span class="id" title="var">destroyed_type</span></span>&nbsp;will&nbsp;refer&nbsp;to&nbsp;the&nbsp;/element/&nbsp;of&nbsp;the&nbsp;array&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Expr__newdelete.wp_operand_array_delete" class="idref" href="#Expr__newdelete.wp_operand_array_delete"><span class="id" title="axiom">wp_operand_array_delete</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">forall</span></a> <a id="delete_fn:117" class="idref" href="#delete_fn:117"><span class="id" title="binder">delete_fn</span></a> <a id="e:118" class="idref" href="#e:118"><span class="id" title="binder">e</span></a> <a id="destroyed_type:119" class="idref" href="#destroyed_type:119"><span class="id" title="binder">destroyed_type</span></a> <a id="Q:120" class="idref" href="#Q:120"><span class="id" title="binder">Q</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="dfty:121" class="idref" href="#dfty:121"><span class="id" title="binder">dfty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#normalize_type"><span class="id" title="definition">normalize_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:117"><span class="id" title="variable">delete_fn</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#:::x_'.2'"><span class="id" title="notation">.2</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">_</span> : <a class="idref" href="bedrock.lang.cpp.logic.call.html#arg_types"><span class="id" title="definition">arg_types</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#dfty:121"><span class="id" title="variable">dfty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tptr"><span class="id" title="constructor">Tptr</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Ar_Definite"><span class="id" title="constructor">Ar_Definite</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#a46514f7419edb3d22453078cf7c9fb7"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;call&nbsp;the&nbsp;destructor&nbsp;on&nbsp;the&nbsp;object,&nbsp;and&nbsp;then&nbsp;call&nbsp;delete_fn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#e:118"><span class="id" title="variable">e</span></a> (<span class="id" title="keyword">fun</span> <a id="v:122" class="idref" href="#v:122"><span class="id" title="binder">v</span></a> <a id="free:123" class="idref" href="#free:123"><span class="id" title="binder">free</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="obj_ptr:124" class="idref" href="#obj_ptr:124"><span class="id" title="binder">obj_ptr</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#v:122"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vptr"><span class="id" title="constructor">Vptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:124"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">if</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.decidable.html#bool_decide"><span class="id" title="definition">bool_decide</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:124"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.nullptr"><span class="id" title="axiom">nullptr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;this&nbsp;conjunction&nbsp;justifies&nbsp;the&nbsp;compiler&nbsp;calling&nbsp;the&nbsp;delete&nbsp;function<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;not&nbsp;calling&nbsp;it.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.delete_val"><span class="id" title="definition">delete_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:117"><span class="id" title="variable">delete_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#destroyed_type:119"><span class="id" title="variable">destroyed_type</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#PTRS_INTF_AXIOM.nullptr"><span class="id" title="axiom">nullptr</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:120"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vvoid"><span class="id" title="definition">Vvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:123"><span class="id" title="variable">free</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="https://plv.mpi-sws.org/coqdoc/iris//iris.bi.interface.html#285322c305ec6868ebb70cbafa909038"><span class="id" title="notation">∧</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:120"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vvoid"><span class="id" title="definition">Vvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:123"><span class="id" title="variable">free</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">else</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">(</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="array_size:125" class="idref" href="#array_size:125"><span class="id" title="binder">array_size</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="array_ty:126" class="idref" href="#array_ty:126"><span class="id" title="binder">array_ty</span></a> := <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tarray"><span class="id" title="constructor">Tarray</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#destroyed_type:119"><span class="id" title="variable">destroyed_type</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_size:125"><span class="id" title="variable">array_size</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;/----&nbsp;Token&nbsp;for&nbsp;distinguishing&nbsp;between&nbsp;array&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;non-array&nbsp;allocations&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:124"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.new_tokenR"><span class="id" title="axiom">new_tokenR</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:126"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;/----&nbsp;Calling&nbsp;destructor&nbsp;with&nbsp;object&nbsp;pointer<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Note:&nbsp;virtual&nbsp;dispatch&nbsp;is&nbsp;not&nbsp;allowed&nbsp;for&nbsp;<span class="inlinecode"><span class="id" title="var">delete</span>[]</span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.destroy.html#destroy_val"><span class="id" title="definition">destroy_val</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:126"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:124"><span class="id" title="variable">obj_ptr</span></a> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">Exists</span></a> <a id="storage_ptr:127" class="idref" href="#storage_ptr:127"><span class="id" title="binder">storage_ptr</span></a> (<a id="sz:128" class="idref" href="#sz:128"><span class="id" title="binder">sz</span></a> <a id="sz':129" class="idref" href="#sz':129"><span class="id" title="binder">sz'</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a><a class="idref" href="bedrock.lang.bi.prelude.html#3ad7164693adfb9816edb0160af074a6"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">[|</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.size_of"><span class="id" title="abbreviation">size_of</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:126"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:128"><span class="id" title="variable">sz</span></a> <a class="idref" href="bedrock.lang.bi.only_provable.html#d95ff2fe2904cc1067c71e0d017740c6"><span class="id" title="notation">|]</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;v----&nbsp;Token&nbsp;for&nbsp;converting&nbsp;obj&nbsp;memory&nbsp;to&nbsp;storage&nbsp;memory&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.pred.html#L.provides_storage"><span class="id" title="axiom">provides_storage</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:127"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">.[</span></a><a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tu8"><span class="id" title="abbreviation">Tu8</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">!</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz':129"><span class="id" title="variable">sz'</span></a><a class="idref" href="bedrock.lang.cpp.semantics.ptrs.html#386812f0666029e370133e1eab907589"><span class="id" title="notation">]</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#obj_ptr:124"><span class="id" title="variable">obj_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_ty:126"><span class="id" title="variable">array_ty</span></a> <a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">**</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Transfer&nbsp;memory&nbsp;to&nbsp;underlying&nbsp;storage&nbsp;pointer;&nbsp;unlike&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">end_provides_storage</span></span>,&nbsp;this&nbsp;memory&nbsp;was&nbsp;pre-destructed&nbsp;by<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">delete_val</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">(</span></a><a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:127"><span class="id" title="variable">storage_ptr</span></a> <a class="idref" href="bedrock.lang.cpp.heap_notations.html#62731479375849aa261b6fbaae1406e9"><span class="id" title="notation">|-&gt;</span></a> <a class="idref" href="bedrock.lang.cpp.logic.heap_pred.html#blockR"><span class="id" title="definition">blockR</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz':129"><span class="id" title="variable">sz'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#sz:128"><span class="id" title="variable">sz</span></a>) 1 <a class="idref" href="bedrock.lang.bi.prelude.html#1ceed28b6e47de516f82862d053216fa"><span class="id" title="notation">-*</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;v----&nbsp;Calling&nbsp;deallocator&nbsp;with&nbsp;storage&nbsp;pointer.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Note:&nbsp;we&nbsp;rely&nbsp;on&nbsp;the&nbsp;AST&nbsp;to&nbsp;have&nbsp;correctly&nbsp;resolved&nbsp;this&nbsp;since&nbsp;the&nbsp;dispatch&nbsp;is&nbsp;statically&nbsp;known.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.prelude.base.html#Reduce"><span class="id" title="abbreviation">Reduce</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.alloc_pointer"><span class="id" title="definition">alloc_pointer</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#storage_ptr:127"><span class="id" title="variable">storage_ptr</span></a> (<span class="id" title="keyword">fun</span> <a id="p:130" class="idref" href="#p:130"><span class="id" title="binder">p</span></a> <a id="FR:131" class="idref" href="#FR:131"><span class="id" title="binder">FR</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.fspec"><span class="id" title="abbreviation">fspec</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:117"><span class="id" title="variable">delete_fn</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#:::x_'.2'"><span class="id" title="notation">.2</span></a> (<a class="idref" href="bedrock.lang.cpp.logic.path_pred.html#_global"><span class="id" title="definition">_global</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:117"><span class="id" title="variable">delete_fn</span></a><a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#:::x_'.1'"><span class="id" title="notation">.1</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:130"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>) (<span class="id" title="keyword">fun</span> <a id="p:132" class="idref" href="#p:132"><span class="id" title="binder">p</span></a> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.call.html#operand_receive"><span class="id" title="definition">operand_receive</span></a> <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tvoid"><span class="id" title="constructor">Tvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#p:132"><span class="id" title="variable">p</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.destroy.html#interp"><span class="id" title="definition">interp</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#FR:131"><span class="id" title="variable">FR</span></a> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp//stdpp.base.html#547692780023ef044153bc0c4f871ef7"><span class="id" title="notation">$</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:120"><span class="id" title="variable">Q</span></a> <a class="idref" href="bedrock.lang.cpp.semantics.values.html#VALUES_INTF_AXIOM.Vvoid"><span class="id" title="definition">Vvoid</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#free:123"><span class="id" title="variable">free</span></a>))))<a class="idref" href="bedrock.lang.bi.prelude.html#edd4b90f66987f0e4145840adec59ece"><span class="id" title="notation">)</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.ssr.ssreflect.html#::general_if_scope:'if'_x_'then'_x_'else'_x"><span class="id" title="notation">)</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="bedrock.lang.bi.prelude.html#0582ac70d883d93be3a66ac50f1c9225"><span class="id" title="notation">|--</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.wp_operand"><span class="id" title="abbreviation">wp_operand</span></a> (<a class="idref" href="bedrock.lang.cpp.syntax.expr.html#Edelete"><span class="id" title="constructor">Edelete</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.15.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#delete_fn:117"><span class="id" title="variable">delete_fn</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#e:118"><span class="id" title="variable">e</span></a> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#destroyed_type:119"><span class="id" title="variable">destroyed_type</span></a>) <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Q:120"><span class="id" title="variable">Q</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Expr__newdelete.with_cpp_logic.with_resolve.delete.NOTE_potentially_relaxing_array_delete" class="idref" href="#Expr__newdelete.with_cpp_logic.with_resolve.delete.NOTE_potentially_relaxing_array_delete"><span class="id" title="section">NOTE_potentially_relaxing_array_delete</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;While&nbsp;(we&nbsp;currently&nbsp;think)&nbsp;it&nbsp;is&nbsp;UB&nbsp;to&nbsp;delete&nbsp;<span class="inlinecode"><span class="id" title="tactic">auto</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">new</span></span> <span class="inlinecode"><span class="id" title="var">int</span>[5][6]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;<span class="inlinecode"><span class="id" title="var">delete</span>[]</span> <span class="inlinecode">&amp;(<span class="id" title="var">p</span>[0][0])</span>,&nbsp;it&nbsp;seems&nbsp;like&nbsp;clang&nbsp;still&nbsp;does&nbsp;something<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sensible&nbsp;for&nbsp;this.&nbsp;If&nbsp;we&nbsp;want&nbsp;to&nbsp;relax&nbsp;our&nbsp;axioms&nbsp;in&nbsp;the&nbsp;future&nbsp;to<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allow&nbsp;for&nbsp;this&nbsp;sort&nbsp;of&nbsp;behavior,&nbsp;we&nbsp;could&nbsp;relate&nbsp;the&nbsp;"carrier&nbsp;type"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;the&nbsp;"dynamic&nbsp;type"&nbsp;of&nbsp;the&nbsp;array&nbsp;which&nbsp;was&nbsp;allocated&nbsp;(which&nbsp;is&nbsp;stored<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">new_token</span></span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In&nbsp;particular,&nbsp;so&nbsp;long&nbsp;as&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">obj_ptr</span></span>&nbsp;<span class="inlinecode"><span class="id" title="var">p'</span></span>&nbsp;we&nbsp;delete&nbsp;is&nbsp;syntactically<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;identical&nbsp;to&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">obj_ptr</span></span>&nbsp;<span class="inlinecode"><span class="id" title="var">p</span></span>&nbsp;returned&nbsp;by&nbsp;our&nbsp;array-new&nbsp;call&nbsp;/and/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;"carrier&nbsp;type"&nbsp;of&nbsp;the&nbsp;delete&nbsp;is&nbsp;_similar_<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;https://eel.is/c++draft/conv.qual&gt;&nbsp;to&nbsp;the&nbsp;"carrier&nbsp;type"&nbsp;of<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;array,&nbsp;we&nbsp;can&nbsp;use&nbsp;<span class="inlinecode"><span class="id" title="var">p'</span></span>&nbsp;to&nbsp;delete&nbsp;the&nbsp;object&nbsp;rooted&nbsp;at&nbsp;<span class="inlinecode"><span class="id" title="var">p</span></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOTE:&nbsp;we&nbsp;might&nbsp;need&nbsp;to&nbsp;insert&nbsp;<span class="inlinecode"><span class="id" title="var">erase_qualifiers</span></span>/<span class="inlinecode"><span class="id" title="var">normalize_type</span></span>&nbsp;calls&nbsp;to<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reflect&nbsp;that&nbsp;the&nbsp;standard&nbsp;only&nbsp;calls&nbsp;for&nbsp;"similarity"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(which&nbsp;has&nbsp;a&nbsp;more&nbsp;nuanced&nbsp;consideration&nbsp;of&nbsp;cv-qualifiers).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;we&nbsp;have&nbsp;<span class="inlinecode"><span class="id" title="var">Tarray</span></span> <span class="inlinecode"><span class="id" title="var">ty</span></span> <span class="inlinecode"><span class="id" title="var">sz</span></span>,&nbsp;<span class="inlinecode"><span class="id" title="var">array_carrier_type</span></span> <span class="inlinecode"><span class="id" title="var">ty</span></span>&nbsp;strips&nbsp;all&nbsp;of&nbsp;the&nbsp;outermost<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">Tarray</span></span>s&nbsp;off&nbsp;and&nbsp;returns&nbsp;the&nbsp;"carrier&nbsp;type"&nbsp;of&nbsp;the&nbsp;array.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <a id="Expr__newdelete.array_carrier_type" class="idref" href="#Expr__newdelete.array_carrier_type"><span class="id" title="definition">array_carrier_type</span></a> (<a id="ty:134" class="idref" href="#ty:134"><span class="id" title="binder">ty</span></a> : <a class="idref" href="bedrock.lang.cpp.syntax.types.html#type"><span class="id" title="inductive">type</span></a>) : <a class="idref" href="bedrock.lang.cpp.syntax.types.html#type"><span class="id" title="inductive">type</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:134"><span class="id" title="variable">ty</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="bedrock.lang.cpp.syntax.types.html#Tarray"><span class="id" title="constructor">Tarray</span></a> <span class="id" title="var">ty'</span> <span class="id" title="var">_</span> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#array_carrier_type:135"><span class="id" title="definition">array_carrier_type</span></a> <span class="id" title="var">ty'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#ty:134"><span class="id" title="variable">ty</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.delete.NOTE_potentially_relaxing_array_delete"><span class="id" title="section">NOTE_potentially_relaxing_array_delete</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve.delete"><span class="id" title="section">delete</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic.with_resolve"><span class="id" title="section">with_resolve</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete.with_cpp_logic"><span class="id" title="section">with_cpp_logic</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete"><span class="id" title="module">Expr__newdelete</span></a>.<br/>

<br/>
<span class="id" title="keyword">Declare Module</span> <a id="E__newdelete" class="idref" href="#E__newdelete"><span class="id" title="module">E__newdelete</span></a> : <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#Expr__newdelete"><span class="id" title="module">Expr__newdelete</span></a>.<br/>

<br/>
<span class="id" title="keyword">Export</span> <a class="idref" href="bedrock.lang.cpp.logic.new_delete.html#E__newdelete"><span class="id" title="module">E__newdelete</span></a>.<br/>
</div>
<!--
-- Copyright (c) 2020 BedRock Systems, Inc.
-- This software is distributed under the terms of the BedRock Open-Source License.
-- See the LICENSE-BedRock file in the repository root for details.
-->

<!--
-- SPDX-LIcense-Identifier:BSD-2-Clause
-->
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
